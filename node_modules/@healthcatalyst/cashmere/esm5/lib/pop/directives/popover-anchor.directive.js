/**
 * @fileoverview added by tsickle
 * Generated from: lib/pop/directives/popover-anchor.directive.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, ElementRef, EventEmitter, Input, Output, ViewContainerRef, HostListener, HostBinding } from '@angular/core';
import { Subject, merge } from 'rxjs';
import { tap, takeUntil } from 'rxjs/operators';
import { HcPopComponent } from '../popover.component';
import { getInvalidPopoverError, getInvalidTriggerError } from '../popover.errors';
import { HcPopoverAnchoringService } from '../popover-anchoring.service';
import { VALID_TRIGGER } from '../types';
import { PopoverNotification, NotificationAction } from '../notification.service';
import { HcPopoverAccessibilityService, KEY_CODE } from '../popover-accessibility.service';
var HcPopoverAnchorDirective = /** @class */ (function () {
    function HcPopoverAnchorDirective(_elementRef, _viewContainerRef, _anchoring, _accessibility) {
        this._elementRef = _elementRef;
        this._viewContainerRef = _viewContainerRef;
        this._anchoring = _anchoring;
        this._accessibility = _accessibility;
        this._trigger = 'click';
        this._hasSubmenu = false;
        /**
         * Emits when the popover is opened.
         */
        this.popoverOpened = new EventEmitter();
        /**
         * Emits when the popover is closed.
         */
        this.popoverClosed = new EventEmitter();
        /**
         * Emits when the directive is destroyed.
         */
        this._onDestroy = new Subject();
    }
    Object.defineProperty(HcPopoverAnchorDirective.prototype, "attachedPopover", {
        /** Reference to the popover instance. */
        get: /**
         * Reference to the popover instance.
         * @return {?}
         */
        function () {
            return this._attachedPopover;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._validateAttachedPopover(value);
            this._attachedPopover = value;
            // Anchor the popover to the element ref
            this._anchoring.anchor(this.attachedPopover, this._viewContainerRef, this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HcPopoverAnchorDirective.prototype, "trigger", {
        /** Trigger event to toggle the popover. *Defaults to `"click"`.*
         * Accepts `click`, `mousedown`, `hover`, `rightclick`, or `none`.
         * Note: if "hover" is selected, the backdrop for the popover will be disabled. */
        get: /**
         * Trigger event to toggle the popover. *Defaults to `"click"`.*
         * Accepts `click`, `mousedown`, `hover`, `rightclick`, or `none`.
         * Note: if "hover" is selected, the backdrop for the popover will be disabled.
         * @return {?}
         */
        function () {
            return this._trigger;
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            this._validateTrigger(val);
            if (this._trigger !== val) {
                this._trigger = val;
            }
            this._dispatchConfigNotification(new PopoverNotification(NotificationAction.UPDATE_CONFIG));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HcPopoverAnchorDirective.prototype, "context", {
        /** Object or value that can be passed into the popover to customize its content */
        get: /**
         * Object or value that can be passed into the popover to customize its content
         * @return {?}
         */
        function () {
            return this._anchoring._context;
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            this._anchoring._context = val;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    HcPopoverAnchorDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // Re-emit open and close events
        /** @type {?} */
        var opened$ = this._anchoring.popoverOpened.pipe(tap((/**
         * @return {?}
         */
        function () { return _this.popoverOpened.emit(); })));
        /** @type {?} */
        var closed$ = this._anchoring.popoverClosed.pipe(tap((/**
         * @param {?} value
         * @return {?}
         */
        function (value) { return _this.popoverClosed.emit(value); })));
        merge(opened$, closed$)
            .pipe(takeUntil(this._onDestroy))
            .subscribe();
    };
    /**
     * @return {?}
     */
    HcPopoverAnchorDirective.prototype.ngAfterContentInit = /**
     * @return {?}
     */
    function () {
        this._setupKeyboardEvents();
    };
    /**
     * @return {?}
     */
    HcPopoverAnchorDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this._onDestroy.next();
        this._onDestroy.complete();
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    HcPopoverAnchorDirective.prototype._showOrHideOnClick = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        if (this._hasSubmenu && event) {
            // Prevent the popover component from auto closing on click if a submenu was selected
            event.stopPropagation();
            event.preventDefault();
        }
        if (this.trigger !== 'click') {
            return;
        }
        this._attachedPopover._offsetPos[0] = this._attachedPopover.horizontalAlign === 'mouse' ? $event.offsetX : 0;
        this._attachedPopover._offsetPos[1] = this._attachedPopover.verticalAlign === 'mouse' ? $event.offsetY : 0;
        this.togglePopover();
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    HcPopoverAnchorDirective.prototype._showOrHideOnMouseOver = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        if (this.trigger !== 'mousedown') {
            return;
        }
        this._attachedPopover._offsetPos[0] = this._attachedPopover.horizontalAlign === 'mouse' ? $event.offsetX : 0;
        this._attachedPopover._offsetPos[1] = this._attachedPopover.verticalAlign === 'mouse' ? $event.offsetY : 0;
        this.togglePopover();
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    HcPopoverAnchorDirective.prototype._showOrHideRightClick = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        if (this.trigger !== 'rightclick') {
            return true;
        }
        else {
            this._attachedPopover._offsetPos[0] = this._attachedPopover.horizontalAlign === 'mouse' ? $event.offsetX : 0;
            this._attachedPopover._offsetPos[1] = this._attachedPopover.verticalAlign === 'mouse' ? $event.offsetY : 0;
            this.togglePopover();
            return false;
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    HcPopoverAnchorDirective.prototype._showOnHover = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        if (this.trigger !== 'hover') {
            return;
        }
        this._attachedPopover._offsetPos[0] = this._attachedPopover.horizontalAlign === 'mouse' ? $event.offsetX : 0;
        this._attachedPopover._offsetPos[1] = this._attachedPopover.verticalAlign === 'mouse' ? $event.offsetY : 0;
        this.openPopover();
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    HcPopoverAnchorDirective.prototype._hideOnLeave = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        if (this.trigger !== 'hover') {
            return;
        }
        this.closePopover();
    };
    /** Handle keyboard navigation of a hcMenu using the arrow or tab keys */
    /**
     * Handle keyboard navigation of a hcMenu using the arrow or tab keys
     * @param {?} event
     * @return {?}
     */
    HcPopoverAnchorDirective.prototype._keyEvent = /**
     * Handle keyboard navigation of a hcMenu using the arrow or tab keys
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (this.attachedPopover.isOpen() && this.attachedPopover._menuItems.length > 0 && !this.attachedPopover._subMenuOpen) {
            if (event.keyCode === KEY_CODE.UP_ARROW || (event.keyCode === KEY_CODE.TAB && event.shiftKey)) {
                event.stopPropagation();
                event.preventDefault();
                this.attachedPopover._keyFocus(false);
            }
            else if (event.keyCode === KEY_CODE.DOWN_ARROW || (event.keyCode === KEY_CODE.TAB && !event.shiftKey)) {
                event.stopPropagation();
                event.preventDefault();
                this.attachedPopover._keyFocus(true);
            }
            else if (this.attachedPopover.parent && this.attachedPopover.parent.isOpen() && event.keyCode === KEY_CODE.LEFT_ARROW) {
                event.stopPropagation();
                event.preventDefault();
                this.closePopover();
            }
        }
        if (this._hasSubmenu && this._elementRef.nativeElement === document.activeElement && event.keyCode === KEY_CODE.RIGHT_ARROW) {
            event.stopPropagation();
            event.preventDefault();
            this.openPopover();
            this.attachedPopover._keyFocus(true);
        }
    };
    /** Gets whether the popover is presently open. */
    /**
     * Gets whether the popover is presently open.
     * @return {?}
     */
    HcPopoverAnchorDirective.prototype.isPopoverOpen = /**
     * Gets whether the popover is presently open.
     * @return {?}
     */
    function () {
        return this._anchoring.isPopoverOpen();
    };
    /** Toggles the popover between the open and closed states. */
    /**
     * Toggles the popover between the open and closed states.
     * @return {?}
     */
    HcPopoverAnchorDirective.prototype.togglePopover = /**
     * Toggles the popover between the open and closed states.
     * @return {?}
     */
    function () {
        this._anchoring.togglePopover();
    };
    /** Opens the popover. */
    /**
     * Opens the popover.
     * @param {?=} options
     * @return {?}
     */
    HcPopoverAnchorDirective.prototype.openPopover = /**
     * Opens the popover.
     * @param {?=} options
     * @return {?}
     */
    function (options) {
        if (options === void 0) { options = {}; }
        this._anchoring.openPopover(options);
    };
    /** Closes the popover. */
    /**
     * Closes the popover.
     * @param {?=} value
     * @param {?=} neighborSubMenusAreOpen
     * @return {?}
     */
    HcPopoverAnchorDirective.prototype.closePopover = /**
     * Closes the popover.
     * @param {?=} value
     * @param {?=} neighborSubMenusAreOpen
     * @return {?}
     */
    function (value, neighborSubMenusAreOpen) {
        if (neighborSubMenusAreOpen === void 0) { neighborSubMenusAreOpen = false; }
        this._anchoring.closePopover(value, neighborSubMenusAreOpen);
    };
    /** Realign the popover to the anchor. */
    /**
     * Realign the popover to the anchor.
     * @return {?}
     */
    HcPopoverAnchorDirective.prototype.realignPopover = /**
     * Realign the popover to the anchor.
     * @return {?}
     */
    function () {
        this._anchoring.realignPopoverToAnchor();
    };
    /** Get a reference to the anchor element. */
    /**
     * Get a reference to the anchor element.
     * @return {?}
     */
    HcPopoverAnchorDirective.prototype.getElement = /**
     * Get a reference to the anchor element.
     * @return {?}
     */
    function () {
        return this._elementRef;
    };
    /** Throws an error if the popover instance is not provided. */
    /**
     * Throws an error if the popover instance is not provided.
     * @private
     * @param {?} popover
     * @return {?}
     */
    HcPopoverAnchorDirective.prototype._validateAttachedPopover = /**
     * Throws an error if the popover instance is not provided.
     * @private
     * @param {?} popover
     * @return {?}
     */
    function (popover) {
        if (!popover || !(popover instanceof HcPopComponent)) {
            throw getInvalidPopoverError();
        }
    };
    /** Throws an error if the trigger is not a valid HcPopoverTrigger. */
    /**
     * Throws an error if the trigger is not a valid HcPopoverTrigger.
     * @private
     * @param {?} trig
     * @return {?}
     */
    HcPopoverAnchorDirective.prototype._validateTrigger = /**
     * Throws an error if the trigger is not a valid HcPopoverTrigger.
     * @private
     * @param {?} trig
     * @return {?}
     */
    function (trig) {
        if (VALID_TRIGGER.indexOf(trig) === -1) {
            throw getInvalidTriggerError(trig);
        }
    };
    /** Dispatch a notification to the notification service, if possible. */
    /**
     * Dispatch a notification to the notification service, if possible.
     * @private
     * @param {?} notification
     * @return {?}
     */
    HcPopoverAnchorDirective.prototype._dispatchConfigNotification = /**
     * Dispatch a notification to the notification service, if possible.
     * @private
     * @param {?} notification
     * @return {?}
     */
    function (notification) {
        if (this._notifications) {
            this._notifications.dispatch(notification);
        }
    };
    /**
     * @private
     * @return {?}
     */
    HcPopoverAnchorDirective.prototype._setupKeyboardEvents = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var notifier = {
            isOpen: false,
            nativeElement: this._elementRef.nativeElement,
            hasSubmenu: (/**
             * @return {?}
             */
            function () { return _this._hasSubmenu; }),
            onKeyDown: (/**
             * @param {?} event
             * @return {?}
             */
            function (event) { return _this._keyEvent(event); })
        };
        this.popoverClosed.asObservable().subscribe((/**
         * @return {?}
         */
        function () { return (notifier.isOpen = false); }));
        this.popoverOpened.asObservable().subscribe((/**
         * @return {?}
         */
        function () { return (notifier.isOpen = true); }));
        this._accessibility.registerNotifier(notifier);
    };
    HcPopoverAnchorDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[hcPop]',
                    exportAs: 'hcPopAnchor',
                    providers: [HcPopoverAnchoringService]
                },] }
    ];
    /** @nocollapse */
    HcPopoverAnchorDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: ViewContainerRef },
        { type: HcPopoverAnchoringService },
        { type: HcPopoverAccessibilityService }
    ]; };
    HcPopoverAnchorDirective.propDecorators = {
        attachedPopover: [{ type: Input, args: ['hcPop',] }],
        trigger: [{ type: Input }],
        context: [{ type: Input }],
        _hasSubmenu: [{ type: HostBinding, args: ['class.hc-menu-item-submenu',] }],
        popoverOpened: [{ type: Output }],
        popoverClosed: [{ type: Output }],
        _showOrHideOnClick: [{ type: HostListener, args: ['click', ['$event'],] }],
        _showOrHideOnMouseOver: [{ type: HostListener, args: ['touchstart', ['$event'],] }, { type: HostListener, args: ['mousedown', ['$event'],] }],
        _showOrHideRightClick: [{ type: HostListener, args: ['contextmenu', ['$event'],] }],
        _showOnHover: [{ type: HostListener, args: ['mouseenter', ['$event'],] }],
        _hideOnLeave: [{ type: HostListener, args: ['touchend', ['$event'],] }, { type: HostListener, args: ['touchcancel', ['$event'],] }, { type: HostListener, args: ['mouseleave', ['$event'],] }]
    };
    return HcPopoverAnchorDirective;
}());
export { HcPopoverAnchorDirective };
if (false) {
    /**
     * @type {?}
     * @private
     */
    HcPopoverAnchorDirective.prototype._attachedPopover;
    /**
     * @type {?}
     * @private
     */
    HcPopoverAnchorDirective.prototype._trigger;
    /** @type {?} */
    HcPopoverAnchorDirective.prototype._hasSubmenu;
    /**
     * Emits when the popover is opened.
     * @type {?}
     */
    HcPopoverAnchorDirective.prototype.popoverOpened;
    /**
     * Emits when the popover is closed.
     * @type {?}
     */
    HcPopoverAnchorDirective.prototype.popoverClosed;
    /**
     * Instance of notification service. Will be undefined until attached to a popover.
     * @type {?}
     */
    HcPopoverAnchorDirective.prototype._notifications;
    /**
     * Emits when the directive is destroyed.
     * @type {?}
     * @private
     */
    HcPopoverAnchorDirective.prototype._onDestroy;
    /** @type {?} */
    HcPopoverAnchorDirective.prototype._elementRef;
    /**
     * @type {?}
     * @private
     */
    HcPopoverAnchorDirective.prototype._viewContainerRef;
    /** @type {?} */
    HcPopoverAnchorDirective.prototype._anchoring;
    /**
     * @type {?}
     * @private
     */
    HcPopoverAnchorDirective.prototype._accessibility;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wb3Zlci1hbmNob3IuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGhlYWx0aGNhdGFseXN0L2Nhc2htZXJlLyIsInNvdXJjZXMiOlsibGliL3BvcC9kaXJlY3RpdmVzL3BvcG92ZXItYW5jaG9yLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFDSCxTQUFTLEVBQ1QsVUFBVSxFQUNWLFlBQVksRUFDWixLQUFLLEVBR0wsTUFBTSxFQUNOLGdCQUFnQixFQUNoQixZQUFZLEVBQ1osV0FBVyxFQUVkLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBQyxPQUFPLEVBQUUsS0FBSyxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBQ3BDLE9BQU8sRUFBQyxHQUFHLEVBQUUsU0FBUyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFFOUMsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLHNCQUFzQixDQUFDO0FBQ3BELE9BQU8sRUFBQyxzQkFBc0IsRUFBRSxzQkFBc0IsRUFBQyxNQUFNLG1CQUFtQixDQUFDO0FBQ2pGLE9BQU8sRUFBQyx5QkFBeUIsRUFBQyxNQUFNLDhCQUE4QixDQUFDO0FBQ3ZFLE9BQU8sRUFBeUMsYUFBYSxFQUFDLE1BQU0sVUFBVSxDQUFDO0FBQy9FLE9BQU8sRUFBQyxtQkFBbUIsRUFBOEIsa0JBQWtCLEVBQUMsTUFBTSx5QkFBeUIsQ0FBQztBQUM1RyxPQUFPLEVBQUMsNkJBQTZCLEVBQXlCLFFBQVEsRUFBQyxNQUFNLGtDQUFrQyxDQUFDO0FBRWhIO0lBMkRJLGtDQUNXLFdBQXVCLEVBQ3RCLGlCQUFtQyxFQUNwQyxVQUFxQyxFQUNwQyxjQUE2QztRQUg5QyxnQkFBVyxHQUFYLFdBQVcsQ0FBWTtRQUN0QixzQkFBaUIsR0FBakIsaUJBQWlCLENBQWtCO1FBQ3BDLGVBQVUsR0FBVixVQUFVLENBQTJCO1FBQ3BDLG1CQUFjLEdBQWQsY0FBYyxDQUErQjtRQTlCakQsYUFBUSxHQUFxQixPQUFP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QUE4Qjs7Ozs7SUFDOUIscURBQTJDOztJQUMzQyw4Q0FBNEM7Ozs7O0lBQzVDLGtEQUFxRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gICAgRGlyZWN0aXZlLFxuICAgIEVsZW1lbnRSZWYsXG4gICAgRXZlbnRFbWl0dGVyLFxuICAgIElucHV0LFxuICAgIE9uSW5pdCxcbiAgICBPbkRlc3Ryb3ksXG4gICAgT3V0cHV0LFxuICAgIFZpZXdDb250YWluZXJSZWYsXG4gICAgSG9zdExpc3RlbmVyLFxuICAgIEhvc3RCaW5kaW5nLFxuICAgIEFmdGVyQ29udGVudEluaXRcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1N1YmplY3QsIG1lcmdlfSBmcm9tICdyeGpzJztcbmltcG9ydCB7dGFwLCB0YWtlVW50aWx9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuaW1wb3J0IHtIY1BvcENvbXBvbmVudH0gZnJvbSAnLi4vcG9wb3Zlci5jb21wb25lbnQnO1xuaW1wb3J0IHtnZXRJbnZhbGlkUG9wb3ZlckVycm9yLCBnZXRJbnZhbGlkVHJpZ2dlckVycm9yfSBmcm9tICcuLi9wb3BvdmVyLmVycm9ycyc7XG5pbXBvcnQge0hjUG9wb3ZlckFuY2hvcmluZ1NlcnZpY2V9IGZyb20gJy4uL3BvcG92ZXItYW5jaG9yaW5nLnNlcnZpY2UnO1xuaW1wb3J0IHtIY1BvcG92ZXJPcGVuT3B0aW9ucywgSGNQb3BvdmVyVHJpZ2dlciwgVkFMSURfVFJJR0dFUn0gZnJvbSAnLi4vdHlwZXMnO1xuaW1wb3J0IHtQb3BvdmVyTm90aWZpY2F0aW9uLCBQb3BvdmVyTm90aWZpY2F0aW9uU2VydmljZSwgTm90aWZpY2F0aW9uQWN0aW9ufSBmcm9tICcuLi9ub3RpZmljYXRpb24uc2VydmljZSc7XG5pbXBvcnQge0hjUG9wb3ZlckFjY2Vzc2liaWxpdHlTZXJ2aWNlLCBIY1BvcEtleWJvYXJkTm90aWZpZXIsIEtFWV9DT0RFfSBmcm9tICcuLi9wb3BvdmVyLWFjY2Vzc2liaWxpdHkuc2VydmljZSc7XG5cbkBEaXJlY3RpdmUoe1xuICAgIHNlbGVjdG9yOiAnW2hjUG9wXScsXG4gICAgZXhwb3J0QXM6ICdoY1BvcEFuY2hvcicsXG4gICAgcHJvdmlkZXJzOiBbSGNQb3BvdmVyQW5jaG9yaW5nU2VydmljZV1cbn0pXG5leHBvcnQgY2xhc3MgSGNQb3BvdmVyQW5jaG9yRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBBZnRlckNvbnRlbnRJbml0LCBPbkRlc3Ryb3kge1xuICAgIC8qKiBSZWZlcmVuY2UgdG8gdGhlIHBvcG92ZXIgaW5zdGFuY2UuICovXG4gICAgQElucHV0KCdoY1BvcCcpXG4gICAgZ2V0IGF0dGFjaGVkUG9wb3ZlcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2F0dGFjaGVkUG9wb3ZlcjtcbiAgICB9XG4gICAgc2V0IGF0dGFjaGVkUG9wb3Zlcih2YWx1ZTogSGNQb3BDb21wb25lbnQpIHtcbiAgICAgICAgdGhpcy5fdmFsaWRhdGVBdHRhY2hlZFBvcG92ZXIodmFsdWUpO1xuICAgICAgICB0aGlzLl9hdHRhY2hlZFBvcG92ZXIgPSB2YWx1ZTtcbiAgICAgICAgLy8gQW5jaG9yIHRoZSBwb3BvdmVyIHRvIHRoZSBlbGVtZW50IHJlZlxuICAgICAgICB0aGlzLl9hbmNob3JpbmcuYW5jaG9yKHRoaXMuYXR0YWNoZWRQb3BvdmVyLCB0aGlzLl92aWV3Q29udGFpbmVyUmVmLCB0aGlzKTtcbiAgICB9XG4gICAgcHJpdmF0ZSBfYXR0YWNoZWRQb3BvdmVyOiBIY1BvcENvbXBvbmVudDtcblxuICAgIC8qKiBUcmlnZ2VyIGV2ZW50IHRvIHRvZ2dsZSB0aGUgcG9wb3Zlci4gKkRlZmF1bHRzIHRvIGBcImNsaWNrXCJgLipcbiAgICAgKiBBY2NlcHRzIGBjbGlja2AsIGBtb3VzZWRvd25gLCBgaG92ZXJgLCBgcmlnaHRjbGlja2AsIG9yIGBub25lYC5cbiAgICAgKiBOb3RlOiBpZiBcImhvdmVyXCIgaXMgc2VsZWN0ZWQsIHRoZSBiYWNrZHJvcCBmb3IgdGhlIHBvcG92ZXIgd2lsbCBiZSBkaXNhYmxlZC4gKi9cbiAgICBASW5wdXQoKVxuICAgIGdldCB0cmlnZ2VyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdHJpZ2dlcjtcbiAgICB9XG4gICAgc2V0IHRyaWdnZXIodmFsOiBIY1BvcG92ZXJUcmlnZ2VyKSB7XG4gICAgICAgIHRoaXMuX3ZhbGlkYXRlVHJpZ2dlcih2YWwpO1xuICAgICAgICBpZiAodGhpcy5fdHJpZ2dlciAhPT0gdmFsKSB7XG4gICAgICAgICAgICB0aGlzLl90cmlnZ2VyID0gdmFsO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2Rpc3BhdGNoQ29uZmlnTm90aWZpY2F0aW9uKG5ldyBQb3BvdmVyTm90aWZpY2F0aW9uKE5vdGlmaWNhdGlvbkFjdGlvbi5VUERBVEVfQ09ORklHKSk7XG4gICAgfVxuICAgIHByaXZhdGUgX3RyaWdnZXI6IEhjUG9wb3ZlclRyaWdnZXIgPSAnY2xpY2snO1xuXG4gICAgLyoqIE9iamVjdCBvciB2YWx1ZSB0aGF0IGNhbiBiZSBwYXNzZWQgaW50byB0aGUgcG9wb3ZlciB0byBjdXN0b21pemUgaXRzIGNvbnRlbnQgKi9cbiAgICBASW5wdXQoKVxuICAgIGdldCBjb250ZXh0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYW5jaG9yaW5nLl9jb250ZXh0O1xuICAgIH1cbiAgICBzZXQgY29udGV4dCh2YWw6IGFueSkge1xuICAgICAgICB0aGlzLl9hbmNob3JpbmcuX2NvbnRleHQgPSB2YWw7XG4gICAgfVxuXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy5oYy1tZW51LWl0ZW0tc3VibWVudScpXG4gICAgX2hhc1N1Ym1lbnUgPSBmYWxzZTtcblxuICAgIC8qKiBFbWl0cyB3aGVuIHRoZSBwb3BvdmVyIGlzIG9wZW5lZC4gKi9cbiAgICBAT3V0cHV0KCkgcG9wb3Zlck9wZW5lZCA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblxuICAgIC8qKiBFbWl0cyB3aGVuIHRoZSBwb3BvdmVyIGlzIGNsb3NlZC4gKi9cbiAgICBAT3V0cHV0KCkgcG9wb3ZlckNsb3NlZCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICAgLyoqIEluc3RhbmNlIG9mIG5vdGlmaWNhdGlvbiBzZXJ2aWNlLiBXaWxsIGJlIHVuZGVmaW5lZCB1bnRpbCBhdHRhY2hlZCB0byBhIHBvcG92ZXIuICovXG4gICAgX25vdGlmaWNhdGlvbnM6IFBvcG92ZXJOb3RpZmljYXRpb25TZXJ2aWNlO1xuXG4gICAgLyoqIEVtaXRzIHdoZW4gdGhlIGRpcmVjdGl2ZSBpcyBkZXN0cm95ZWQuICovXG4gICAgcHJpdmF0ZSBfb25EZXN0cm95ID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwdWJsaWMgX2VsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXG4gICAgICAgIHByaXZhdGUgX3ZpZXdDb250YWluZXJSZWY6IFZpZXdDb250YWluZXJSZWYsXG4gICAgICAgIHB1YmxpYyBfYW5jaG9yaW5nOiBIY1BvcG92ZXJBbmNob3JpbmdTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIF9hY2Nlc3NpYmlsaXR5OiBIY1BvcG92ZXJBY2Nlc3NpYmlsaXR5U2VydmljZVxuICAgICkge31cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICAvLyBSZS1lbWl0IG9wZW4gYW5kIGNsb3NlIGV2ZW50c1xuICAgICAgICBjb25zdCBvcGVuZWQkID0gdGhpcy5fYW5jaG9yaW5nLnBvcG92ZXJPcGVuZWQucGlwZSh0YXAoKCkgPT4gdGhpcy5wb3BvdmVyT3BlbmVkLmVtaXQoKSkpO1xuICAgICAgICBjb25zdCBjbG9zZWQkID0gdGhpcy5fYW5jaG9yaW5nLnBvcG92ZXJDbG9zZWQucGlwZSh0YXAodmFsdWUgPT4gdGhpcy5wb3BvdmVyQ2xvc2VkLmVtaXQodmFsdWUpKSk7XG4gICAgICAgIG1lcmdlKG9wZW5lZCQsIGNsb3NlZCQpXG4gICAgICAgICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5fb25EZXN0cm95KSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKTtcbiAgICB9XG5cbiAgICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgICAgIHRoaXMuX3NldHVwS2V5Ym9hcmRFdmVudHMoKTtcbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5fb25EZXN0cm95Lm5leHQoKTtcbiAgICAgICAgdGhpcy5fb25EZXN0cm95LmNvbXBsZXRlKCk7XG4gICAgfVxuXG4gICAgQEhvc3RMaXN0ZW5lcignY2xpY2snLCBbJyRldmVudCddKVxuICAgIF9zaG93T3JIaWRlT25DbGljaygkZXZlbnQ6IE1vdXNlRXZlbnQpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuX2hhc1N1Ym1lbnUgJiYgZXZlbnQpIHtcbiAgICAgICAgICAgIC8vIFByZXZlbnQgdGhlIHBvcG92ZXIgY29tcG9uZW50IGZyb20gYXV0byBjbG9zaW5nIG9uIGNsaWNrIGlmIGEgc3VibWVudSB3YXMgc2VsZWN0ZWRcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy50cmlnZ2VyICE9PSAnY2xpY2snKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fYXR0YWNoZWRQb3BvdmVyLl9vZmZzZXRQb3NbMF0gPSB0aGlzLl9hdHRhY2hlZFBvcG92ZXIuaG9yaXpvbnRhbEFsaWduID09PSAnbW91c2UnID8gJGV2ZW50Lm9mZnNldFggOiAwO1xuICAgICAgICB0aGlzLl9hdHRhY2hlZFBvcG92ZXIuX29mZnNldFBvc1sxXSA9IHRoaXMuX2F0dGFjaGVkUG9wb3Zlci52ZXJ0aWNhbEFsaWduID09PSAnbW91c2UnID8gJGV2ZW50Lm9mZnNldFkgOiAwO1xuICAgICAgICB0aGlzLnRvZ2dsZVBvcG92ZXIoKTtcbiAgICB9XG5cbiAgICBASG9zdExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgWyckZXZlbnQnXSlcbiAgICBASG9zdExpc3RlbmVyKCdtb3VzZWRvd24nLCBbJyRldmVudCddKVxuICAgIF9zaG93T3JIaWRlT25Nb3VzZU92ZXIoJGV2ZW50OiBNb3VzZUV2ZW50KTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLnRyaWdnZXIgIT09ICdtb3VzZWRvd24nKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fYXR0YWNoZWRQb3BvdmVyLl9vZmZzZXRQb3NbMF0gPSB0aGlzLl9hdHRhY2hlZFBvcG92ZXIuaG9yaXpvbnRhbEFsaWduID09PSAnbW91c2UnID8gJGV2ZW50Lm9mZnNldFggOiAwO1xuICAgICAgICB0aGlzLl9hdHRhY2hlZFBvcG92ZXIuX29mZnNldFBvc1sxXSA9IHRoaXMuX2F0dGFjaGVkUG9wb3Zlci52ZXJ0aWNhbEFsaWduID09PSAnbW91c2UnID8gJGV2ZW50Lm9mZnNldFkgOiAwO1xuICAgICAgICB0aGlzLnRvZ2dsZVBvcG92ZXIoKTtcbiAgICB9XG5cbiAgICBASG9zdExpc3RlbmVyKCdjb250ZXh0bWVudScsIFsnJGV2ZW50J10pXG4gICAgX3Nob3dPckhpZGVSaWdodENsaWNrKCRldmVudDogTW91c2VFdmVudCk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAodGhpcy50cmlnZ2VyICE9PSAncmlnaHRjbGljaycpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fYXR0YWNoZWRQb3BvdmVyLl9vZmZzZXRQb3NbMF0gPSB0aGlzLl9hdHRhY2hlZFBvcG92ZXIuaG9yaXpvbnRhbEFsaWduID09PSAnbW91c2UnID8gJGV2ZW50Lm9mZnNldFggOiAwO1xuICAgICAgICAgICAgdGhpcy5fYXR0YWNoZWRQb3BvdmVyLl9vZmZzZXRQb3NbMV0gPSB0aGlzLl9hdHRhY2hlZFBvcG92ZXIudmVydGljYWxBbGlnbiA9PT0gJ21vdXNlJyA/ICRldmVudC5vZmZzZXRZIDogMDtcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlUG9wb3ZlcigpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgQEhvc3RMaXN0ZW5lcignbW91c2VlbnRlcicsIFsnJGV2ZW50J10pXG4gICAgX3Nob3dPbkhvdmVyKCRldmVudDogTW91c2VFdmVudCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy50cmlnZ2VyICE9PSAnaG92ZXInKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fYXR0YWNoZWRQb3BvdmVyLl9vZmZzZXRQb3NbMF0gPSB0aGlzLl9hdHRhY2hlZFBvcG92ZXIuaG9yaXpvbnRhbEFsaWduID09PSAnbW91c2UnID8gJGV2ZW50Lm9mZnNldFggOiAwO1xuICAgICAgICB0aGlzLl9hdHRhY2hlZFBvcG92ZXIuX29mZnNldFBvc1sxXSA9IHRoaXMuX2F0dGFjaGVkUG9wb3Zlci52ZXJ0aWNhbEFsaWduID09PSAnbW91c2UnID8gJGV2ZW50Lm9mZnNldFkgOiAwO1xuICAgICAgICB0aGlzLm9wZW5Qb3BvdmVyKCk7XG4gICAgfVxuXG4gICAgQEhvc3RMaXN0ZW5lcigndG91Y2hlbmQnLCBbJyRldmVudCddKVxuICAgIEBIb3N0TGlzdGVuZXIoJ3RvdWNoY2FuY2VsJywgWyckZXZlbnQnXSlcbiAgICBASG9zdExpc3RlbmVyKCdtb3VzZWxlYXZlJywgWyckZXZlbnQnXSlcbiAgICBfaGlkZU9uTGVhdmUoJGV2ZW50OiBNb3VzZUV2ZW50KTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLnRyaWdnZXIgIT09ICdob3ZlcicpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNsb3NlUG9wb3ZlcigpO1xuICAgIH1cblxuICAgIC8qKiBIYW5kbGUga2V5Ym9hcmQgbmF2aWdhdGlvbiBvZiBhIGhjTWVudSB1c2luZyB0aGUgYXJyb3cgb3IgdGFiIGtleXMgKi9cbiAgICBfa2V5RXZlbnQoZXZlbnQ6IEtleWJvYXJkRXZlbnQpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuYXR0YWNoZWRQb3BvdmVyLmlzT3BlbigpICYmIHRoaXMuYXR0YWNoZWRQb3BvdmVyLl9tZW51SXRlbXMubGVuZ3RoID4gMCAmJiAhdGhpcy5hdHRhY2hlZFBvcG92ZXIuX3N1Yk1lbnVPcGVuKSB7XG4gICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gS0VZX0NPREUuVVBfQVJST1cgfHwgKGV2ZW50LmtleUNvZGUgPT09IEtFWV9DT0RFLlRBQiAmJiBldmVudC5zaGlmdEtleSkpIHtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNoZWRQb3BvdmVyLl9rZXlGb2N1cyhmYWxzZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleUNvZGUgPT09IEtFWV9DT0RFLkRPV05fQVJST1cgfHwgKGV2ZW50LmtleUNvZGUgPT09IEtFWV9DT0RFLlRBQiAmJiAhZXZlbnQuc2hpZnRLZXkpKSB7XG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmF0dGFjaGVkUG9wb3Zlci5fa2V5Rm9jdXModHJ1ZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXR0YWNoZWRQb3BvdmVyLnBhcmVudCAmJiB0aGlzLmF0dGFjaGVkUG9wb3Zlci5wYXJlbnQuaXNPcGVuKCkgJiYgZXZlbnQua2V5Q29kZSA9PT0gS0VZX0NPREUuTEVGVF9BUlJPVykge1xuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZVBvcG92ZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5faGFzU3VibWVudSAmJiB0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQgPT09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgJiYgZXZlbnQua2V5Q29kZSA9PT0gS0VZX0NPREUuUklHSFRfQVJST1cpIHtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHRoaXMub3BlblBvcG92ZXIoKTtcbiAgICAgICAgICAgIHRoaXMuYXR0YWNoZWRQb3BvdmVyLl9rZXlGb2N1cyh0cnVlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKiBHZXRzIHdoZXRoZXIgdGhlIHBvcG92ZXIgaXMgcHJlc2VudGx5IG9wZW4uICovXG4gICAgaXNQb3BvdmVyT3BlbigpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FuY2hvcmluZy5pc1BvcG92ZXJPcGVuKCk7XG4gICAgfVxuXG4gICAgLyoqIFRvZ2dsZXMgdGhlIHBvcG92ZXIgYmV0d2VlbiB0aGUgb3BlbiBhbmQgY2xvc2VkIHN0YXRlcy4gKi9cbiAgICB0b2dnbGVQb3BvdmVyKCk6IHZvaWQge1xuICAgICAgICB0aGlzLl9hbmNob3JpbmcudG9nZ2xlUG9wb3ZlcigpO1xuICAgIH1cblxuICAgIC8qKiBPcGVucyB0aGUgcG9wb3Zlci4gKi9cbiAgICBvcGVuUG9wb3ZlcihvcHRpb25zOiBIY1BvcG92ZXJPcGVuT3B0aW9ucyA9IHt9KTogdm9pZCB7XG4gICAgICAgIHRoaXMuX2FuY2hvcmluZy5vcGVuUG9wb3ZlcihvcHRpb25zKTtcbiAgICB9XG5cbiAgICAvKiogQ2xvc2VzIHRoZSBwb3BvdmVyLiAqL1xuICAgIGNsb3NlUG9wb3Zlcih2YWx1ZT86IGFueSwgbmVpZ2hib3JTdWJNZW51c0FyZU9wZW46IGJvb2xlYW4gPSBmYWxzZSk6IHZvaWQge1xuICAgICAgICB0aGlzLl9hbmNob3JpbmcuY2xvc2VQb3BvdmVyKHZhbHVlLCBuZWlnaGJvclN1Yk1lbnVzQXJlT3Blbik7XG4gICAgfVxuXG4gICAgLyoqIFJlYWxpZ24gdGhlIHBvcG92ZXIgdG8gdGhlIGFuY2hvci4gKi9cbiAgICByZWFsaWduUG9wb3ZlcigpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5fYW5jaG9yaW5nLnJlYWxpZ25Qb3BvdmVyVG9BbmNob3IoKTtcbiAgICB9XG5cbiAgICAvKiogR2V0IGEgcmVmZXJlbmNlIHRvIHRoZSBhbmNob3IgZWxlbWVudC4gKi9cbiAgICBnZXRFbGVtZW50KCk6IEVsZW1lbnRSZWYge1xuICAgICAgICByZXR1cm4gdGhpcy5fZWxlbWVudFJlZjtcbiAgICB9XG5cbiAgICAvKiogVGhyb3dzIGFuIGVycm9yIGlmIHRoZSBwb3BvdmVyIGluc3RhbmNlIGlzIG5vdCBwcm92aWRlZC4gKi9cbiAgICBwcml2YXRlIF92YWxpZGF0ZUF0dGFjaGVkUG9wb3Zlcihwb3BvdmVyOiBIY1BvcENvbXBvbmVudCk6IHZvaWQge1xuICAgICAgICBpZiAoIXBvcG92ZXIgfHwgIShwb3BvdmVyIGluc3RhbmNlb2YgSGNQb3BDb21wb25lbnQpKSB7XG4gICAgICAgICAgICB0aHJvdyBnZXRJbnZhbGlkUG9wb3ZlckVycm9yKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogVGhyb3dzIGFuIGVycm9yIGlmIHRoZSB0cmlnZ2VyIGlzIG5vdCBhIHZhbGlkIEhjUG9wb3ZlclRyaWdnZXIuICovXG4gICAgcHJpdmF0ZSBfdmFsaWRhdGVUcmlnZ2VyKHRyaWc6IEhjUG9wb3ZlclRyaWdnZXIpOiB2b2lkIHtcbiAgICAgICAgaWYgKFZBTElEX1RSSUdHRVIuaW5kZXhPZih0cmlnKSA9PT0gLTEpIHtcbiAgICAgICAgICAgIHRocm93IGdldEludmFsaWRUcmlnZ2VyRXJyb3IodHJpZyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogRGlzcGF0Y2ggYSBub3RpZmljYXRpb24gdG8gdGhlIG5vdGlmaWNhdGlvbiBzZXJ2aWNlLCBpZiBwb3NzaWJsZS4gKi9cbiAgICBwcml2YXRlIF9kaXNwYXRjaENvbmZpZ05vdGlmaWNhdGlvbihub3RpZmljYXRpb246IFBvcG92ZXJOb3RpZmljYXRpb24pIHtcbiAgICAgICAgaWYgKHRoaXMuX25vdGlmaWNhdGlvbnMpIHtcbiAgICAgICAgICAgIHRoaXMuX25vdGlmaWNhdGlvbnMuZGlzcGF0Y2gobm90aWZpY2F0aW9uKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgX3NldHVwS2V5Ym9hcmRFdmVudHMoKSB7XG4gICAgICAgIGNvbnN0IG5vdGlmaWVyOiBIY1BvcEtleWJvYXJkTm90aWZpZXIgPSB7XG4gICAgICAgICAgICBpc09wZW46IGZhbHNlLFxuICAgICAgICAgICAgbmF0aXZlRWxlbWVudDogdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LFxuICAgICAgICAgICAgaGFzU3VibWVudTogKCkgPT4gdGhpcy5faGFzU3VibWVudSxcbiAgICAgICAgICAgIG9uS2V5RG93bjogZXZlbnQgPT4gdGhpcy5fa2V5RXZlbnQoZXZlbnQpXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucG9wb3ZlckNsb3NlZC5hc09ic2VydmFibGUoKS5zdWJzY3JpYmUoKCkgPT4gKG5vdGlmaWVyLmlzT3BlbiA9IGZhbHNlKSk7XG4gICAgICAgIHRoaXMucG9wb3Zlck9wZW5lZC5hc09ic2VydmFibGUoKS5zdWJzY3JpYmUoKCkgPT4gKG5vdGlmaWVyLmlzT3BlbiA9IHRydWUpKTtcbiAgICAgICAgdGhpcy5fYWNjZXNzaWJpbGl0eS5yZWdpc3Rlck5vdGlmaWVyKG5vdGlmaWVyKTtcbiAgICB9XG59XG4iXX0=