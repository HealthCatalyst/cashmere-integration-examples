/**
 * @fileoverview added by tsickle
 * Generated from: lib/drawer/drawer-container.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ChangeDetectorRef, Component, ContentChildren, ElementRef, HostBinding, NgZone, QueryList, Renderer2, ViewEncapsulation } from '@angular/core';
import { Drawer } from './drawer.component';
import { debounceTime, filter, startWith, takeUntil } from 'rxjs/operators';
import { Subject } from 'rxjs';
/**
 * @param {?} align
 * @return {?}
 */
function throwDrawerContainerError(align) {
    throw new Error("A drawer was already declared for 'align=\"" + align + "\"'");
}
/**
 * Parent component that houses one or two `<hc-drawer>` that applies content styling
 */
var DrawerContainer = /** @class */ (function () {
    function DrawerContainer(_elementRef, _renderer, _ngZone, _changeDetector) {
        this._elementRef = _elementRef;
        this._renderer = _renderer;
        this._ngZone = _ngZone;
        this._changeDetector = _changeDetector;
        this._contentMargins = { left: 0, right: 0 };
        this._doCheckSubject = new Subject();
        this._destroyed = new Subject();
        this._hostClass = true;
    }
    // If drawer size changes through some async action this will cause it to resize the margins
    // If drawer size changes through some async action this will cause it to resize the margins
    /**
     * @return {?}
     */
    DrawerContainer.prototype.ngDoCheck = 
    // If drawer size changes through some async action this will cause it to resize the margins
    /**
     * @return {?}
     */
    function () {
        var _this = this;
        // Run outside of angular's scope because debounceTime will cause infinite loop
        this._ngZone.runOutsideAngular((/**
         * @return {?}
         */
        function () { return _this._doCheckSubject.next(); }));
    };
    /**
     * @return {?}
     */
    DrawerContainer.prototype.ngAfterContentInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // debounceTime allows the component to render before the margins are calculated
        this._doCheckSubject
            .pipe(debounceTime(10), // arbitrarily small value is used to quickly render the component so incorrect margins aren't shown
        takeUntil(this._destroyed))
            .subscribe((/**
         * @return {?}
         */
        function () { return _this._calculateContentMargins(); }));
        // startWith used to cause first iteration
        this._drawers.changes.pipe(startWith(null)).subscribe((/**
         * @return {?}
         */
        function () {
            _this._validateDrawers();
            _this._drawers.forEach((/**
             * @param {?} drawer
             * @return {?}
             */
            function (drawer) {
                drawer._animationStarted
                    .pipe(takeUntil(_this._drawers.changes), filter((/**
                 * @param {?} event
                 * @return {?}
                 */
                function (event) { return event.fromState !== event.toState; })))
                    .subscribe((/**
                 * @return {?}
                 */
                function () {
                    _this._calculateContentMargins();
                }));
                drawer._openChange.pipe(takeUntil(_this._drawers.changes)).subscribe((/**
                 * @param {?} isOpen
                 * @return {?}
                 */
                function (isOpen) {
                    if (isOpen) {
                        _this._setContainerClass(true);
                    }
                    else {
                        _this._setContainerClass(false);
                    }
                }));
            }));
            if (!_this._drawers.length || _this._isDrawerOpen(_this._leftDrawer) || _this._isDrawerOpen(_this._rightDrawer)) {
                _this._calculateContentMargins();
            }
        }));
    };
    /**
     * @private
     * @param {?} drawer
     * @return {?}
     */
    DrawerContainer.prototype._isDrawerOpen = /**
     * @private
     * @param {?} drawer
     * @return {?}
     */
    function (drawer) {
        return drawer != null && drawer.opened;
    };
    /** Open all drawers */
    /**
     * Open all drawers
     * @return {?}
     */
    DrawerContainer.prototype.open = /**
     * Open all drawers
     * @return {?}
     */
    function () {
        return Promise.all([this._leftDrawer, this._rightDrawer].map((/**
         * @param {?} drawer
         * @return {?}
         */
        function (drawer) { return drawer && drawer.toggleOpen(); })));
    };
    /** Close all drawers */
    /**
     * Close all drawers
     * @return {?}
     */
    DrawerContainer.prototype.close = /**
     * Close all drawers
     * @return {?}
     */
    function () {
        return Promise.all([this._leftDrawer, this._rightDrawer].map((/**
         * @param {?} drawer
         * @return {?}
         */
        function (drawer) { return drawer && drawer.toggleClose(); })));
    };
    /**
     * @private
     * @return {?}
     */
    DrawerContainer.prototype._calculateContentMargins = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var left = 0;
        /** @type {?} */
        var right = 0;
        if (this._leftDrawer && this._leftDrawer.opened) {
            if (this._leftDrawer.mode === 'side') {
                left += this._leftDrawer._width;
            }
            else if (this._leftDrawer.mode === 'push') {
                left += this._leftDrawer._width;
                right -= this._leftDrawer._width;
            }
        }
        if (this._rightDrawer && this._rightDrawer.opened) {
            if (this._rightDrawer.mode === 'side') {
                right += this._rightDrawer._width;
            }
            else if (this._rightDrawer.mode === 'push') {
                right += this._rightDrawer._width;
                left -= this._rightDrawer._width;
            }
        }
        if (left !== this._contentMargins.left || right !== this._contentMargins.right) {
            this._contentMargins = { left: left, right: right };
            this._ngZone.run((/**
             * @return {?}
             */
            function () { return _this._changeDetector.markForCheck(); }));
        }
    };
    /**
     * @private
     * @return {?}
     */
    DrawerContainer.prototype._validateDrawers = /**
     * @private
     * @return {?}
     */
    function () {
        var e_1, _a;
        try {
            for (var _b = tslib_1.__values(this._drawers.toArray()), _c = _b.next(); !_c.done; _c = _b.next()) {
                var drawer = _c.value;
                if (drawer.align === 'right') {
                    if (this._rightDrawer != null) {
                        throwDrawerContainerError('right');
                    }
                    this._rightDrawer = drawer;
                }
                else {
                    if (this._leftDrawer != null) {
                        throwDrawerContainerError('left');
                    }
                    this._leftDrawer = drawer;
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
    };
    /**
     * @private
     * @param {?} isOpen
     * @return {?}
     */
    DrawerContainer.prototype._setContainerClass = /**
     * @private
     * @param {?} isOpen
     * @return {?}
     */
    function (isOpen) {
        if (isOpen) {
            this._renderer.addClass(this._elementRef.nativeElement, 'hc-drawer-opened');
        }
        else {
            this._renderer.removeClass(this._elementRef.nativeElement, 'hc-drawer-opened');
        }
    };
    /**
     * @return {?}
     */
    DrawerContainer.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this._destroyed.next();
        this._destroyed.complete();
        this._doCheckSubject.complete();
    };
    DrawerContainer.decorators = [
        { type: Component, args: [{
                    selector: 'hc-drawer-container',
                    template: "<ng-content select=\"hc-drawer,hc-menu-drawer\"></ng-content>\n\n<div class=\"hc-drawer-content\"\n     [style.margin-left.px]=\"_contentMargins.left\"\n     [style.margin-right.px]=\"_contentMargins.right\">\n    <ng-content></ng-content>\n</div>\n",
                    encapsulation: ViewEncapsulation.None,
                    styles: [".hc-drawer,.hc-menu-drawer{bottom:0;box-sizing:border-box;display:block;height:100%;outline:0;overflow-y:auto;position:absolute;top:0;z-index:3}.hc-drawer.hc-drawer-opened:not(.drawer-side),.hc-drawer.hc-drawer-opening:not(.drawer-side),.hc-menu-drawer.hc-drawer-opened:not(.drawer-side),.hc-menu-drawer.hc-drawer-opening:not(.drawer-side){box-shadow:0 8px 10px -5px rgba(0,0,0,.2),0 16px 24px 2px rgba(0,0,0,.14),0 6px 30px 5px rgba(0,0,0,.12)}.hc-drawer-right{right:0}.hc-drawer-container{position:relative;z-index:1;box-sizing:border-box;display:block;overflow:hidden}.hc-drawer-content{position:relative;z-index:1;display:block;height:100%;left:0;overflow:auto;padding:10px 20px;right:0;-webkit-transition-duration:.4s;transition-duration:.4s;-webkit-transition-property:margin-left,margin-right,-webkit-transform;transition-property:transform,margin-left,margin-right,-webkit-transform;-webkit-transition-timing-function:cubic-bezier(.25,.8,.25,1);transition-timing-function:cubic-bezier(.25,.8,.25,1)}"]
                }] }
    ];
    /** @nocollapse */
    DrawerContainer.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Renderer2 },
        { type: NgZone },
        { type: ChangeDetectorRef }
    ]; };
    DrawerContainer.propDecorators = {
        _drawers: [{ type: ContentChildren, args: [Drawer,] }],
        _hostClass: [{ type: HostBinding, args: ['class.hc-drawer-container',] }]
    };
    return DrawerContainer;
}());
export { DrawerContainer };
if (false) {
    /** @type {?} */
    DrawerContainer.prototype._drawers;
    /**
     * @type {?}
     * @private
     */
    DrawerContainer.prototype._leftDrawer;
    /**
     * @type {?}
     * @private
     */
    DrawerContainer.prototype._rightDrawer;
    /** @type {?} */
    DrawerContainer.prototype._contentMargins;
    /**
     * @type {?}
     * @private
     */
    DrawerContainer.prototype._doCheckSubject;
    /**
     * @type {?}
     * @private
     */
    DrawerContainer.prototype._destroyed;
    /** @type {?} */
    DrawerContainer.prototype._hostClass;
    /**
     * @type {?}
     * @private
     */
    DrawerContainer.prototype._elementRef;
    /**
     * @type {?}
     * @private
     */
    DrawerContainer.prototype._renderer;
    /**
     * @type {?}
     * @private
     */
    DrawerContainer.prototype._ngZone;
    /**
     * @type {?}
     * @private
     */
    DrawerContainer.prototype._changeDetector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhd2VyLWNvbnRhaW5lci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AaGVhbHRoY2F0YWx5c3QvY2FzaG1lcmUvIiwic291cmNlcyI6WyJsaWIvZHJhd2VyL2RyYXdlci1jb250YWluZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLE9BQU8sRUFFSCxpQkFBaUIsRUFDakIsU0FBUyxFQUNULGVBQWUsRUFFZixVQUFVLEVBQ1YsV0FBVyxFQUNYLE1BQU0sRUFFTixTQUFTLEVBQ1QsU0FBUyxFQUNULGlCQUFpQixFQUNwQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUMsTUFBTSxFQUFzQixNQUFNLG9CQUFvQixDQUFDO0FBQy9ELE9BQU8sRUFBQyxZQUFZLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUUxRSxPQUFPLEVBQUMsT0FBTyxFQUFDLE1BQU0sTUFBTSxDQUFDOzs7OztBQUU3QixTQUFTLHlCQUF5QixDQUFDLEtBQWE7SUFDNUMsTUFBTSxJQUFJLEtBQUssQ0FBQyxnREFBNkMsS0FBSyxRQUFJLENBQUMsQ0FBQztBQUM1RSxDQUFDOzs7O0FBR0Q7SUFxQkkseUJBQ1ksV0FBdUIsRUFDdkIsU0FBb0IsRUFDcEIsT0FBZSxFQUNmLGVBQWtDO1FBSGxDLGdCQUFXLEdBQVgsV0FBVyxDQUFZO1FBQ3ZCLGNBQVMsR0FBVCxTQUFTLENBQVc7UUFDcEIsWUFBTyxHQUFQLE9BQU8sQ0FBUTtRQUNmLG9CQUFlLEdBQWYsZUFBZSxDQUFtQjtRQVo5QyxvQkFBZSxHQUFHLEVBQUMsSUFBSSxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFDLENBQUM7UUFFckIsb0JBQWUsR0FBRyxJQUFJLE9BQU8sRUFBUSxDQUFDO1FBQ3RDLGVBQVUsR0FBRyxJQUFJLE9BQU8sRUFBUSxDQUFDO1FBR2xELGVBQVUsR0FBRyxJQUFJLENBQUM7SUFPZixD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RSxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDM0IsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUNwQyxDQUFDOztnQkE5SUosU0FBUyxTQUFDO29CQUNQLFFBQVEsRUFBRSxxQkFBcUI7b0JBQy9CLHFRQUE4QztvQkFFOUMsYUFBYSxFQUFFLGlCQUFpQixDQUFDLElBQUk7O2lCQUN4Qzs7OztnQkF2QkcsVUFBVTtnQkFLVixTQUFTO2dCQUhULE1BQU07Z0JBTk4saUJBQWlCOzs7MkJBNkJoQixlQUFlLFNBQUMsTUFBTTs2QkFXdEIsV0FBVyxTQUFDLDJCQUEyQjs7SUE2SDVDLHNCQUFDO0NBQUEsQUEvSUQsSUErSUM7U0F6SVksZUFBZTs7O0lBQ3hCLG1DQUM0Qjs7Ozs7SUFFNUIsc0NBQTRCOzs7OztJQUM1Qix1Q0FBNkI7O0lBRTdCLDBDQUFzQzs7Ozs7SUFFdEMsMENBQXVEOzs7OztJQUN2RCxxQ0FBa0Q7O0lBRWxELHFDQUNrQjs7Ozs7SUFHZCxzQ0FBK0I7Ozs7O0lBQy9CLG9DQUE0Qjs7Ozs7SUFDNUIsa0NBQXVCOzs7OztJQUN2QiwwQ0FBMEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICAgIEFmdGVyQ29udGVudEluaXQsXG4gICAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgQ29tcG9uZW50LFxuICAgIENvbnRlbnRDaGlsZHJlbixcbiAgICBEb0NoZWNrLFxuICAgIEVsZW1lbnRSZWYsXG4gICAgSG9zdEJpbmRpbmcsXG4gICAgTmdab25lLFxuICAgIE9uRGVzdHJveSxcbiAgICBRdWVyeUxpc3QsXG4gICAgUmVuZGVyZXIyLFxuICAgIFZpZXdFbmNhcHN1bGF0aW9uXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtEcmF3ZXIsIERyYXdlclByb21pc2VSZXN1bHR9IGZyb20gJy4vZHJhd2VyLmNvbXBvbmVudCc7XG5pbXBvcnQge2RlYm91bmNlVGltZSwgZmlsdGVyLCBzdGFydFdpdGgsIHRha2VVbnRpbH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHtBbmltYXRpb25FdmVudH0gZnJvbSAnQGFuZ3VsYXIvYW5pbWF0aW9ucyc7XG5pbXBvcnQge1N1YmplY3R9IGZyb20gJ3J4anMnO1xuXG5mdW5jdGlvbiB0aHJvd0RyYXdlckNvbnRhaW5lckVycm9yKGFsaWduOiBzdHJpbmcpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEEgZHJhd2VyIHdhcyBhbHJlYWR5IGRlY2xhcmVkIGZvciAnYWxpZ249XCIke2FsaWdufVwiJ2ApO1xufVxuXG4vKiogUGFyZW50IGNvbXBvbmVudCB0aGF0IGhvdXNlcyBvbmUgb3IgdHdvIGA8aGMtZHJhd2VyPmAgdGhhdCBhcHBsaWVzIGNvbnRlbnQgc3R5bGluZyAqL1xuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdoYy1kcmF3ZXItY29udGFpbmVyJyxcbiAgICB0ZW1wbGF0ZVVybDogJ2RyYXdlci1jb250YWluZXIuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWydkcmF3ZXIuY29tcG9uZW50LnNjc3MnXSxcbiAgICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXG59KVxuZXhwb3J0IGNsYXNzIERyYXdlckNvbnRhaW5lciBpbXBsZW1lbnRzIEFmdGVyQ29udGVudEluaXQsIERvQ2hlY2ssIE9uRGVzdHJveSB7XG4gICAgQENvbnRlbnRDaGlsZHJlbihEcmF3ZXIpXG4gICAgX2RyYXdlcnM6IFF1ZXJ5TGlzdDxEcmF3ZXI+O1xuXG4gICAgcHJpdmF0ZSBfbGVmdERyYXdlcjogRHJhd2VyO1xuICAgIHByaXZhdGUgX3JpZ2h0RHJhd2VyOiBEcmF3ZXI7XG5cbiAgICBfY29udGVudE1hcmdpbnMgPSB7bGVmdDogMCwgcmlnaHQ6IDB9O1xuXG4gICAgcHJpdmF0ZSByZWFkb25seSBfZG9DaGVja1N1YmplY3QgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgX2Rlc3Ryb3llZCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG5cbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmhjLWRyYXdlci1jb250YWluZXInKVxuICAgIF9ob3N0Q2xhc3MgPSB0cnVlO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgX2VsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXG4gICAgICAgIHByaXZhdGUgX3JlbmRlcmVyOiBSZW5kZXJlcjIsXG4gICAgICAgIHByaXZhdGUgX25nWm9uZTogTmdab25lLFxuICAgICAgICBwcml2YXRlIF9jaGFuZ2VEZXRlY3RvcjogQ2hhbmdlRGV0ZWN0b3JSZWZcbiAgICApIHt9XG5cbiAgICAvLyBJZiBkcmF3ZXIgc2l6ZSBjaGFuZ2VzIHRocm91Z2ggc29tZSBhc3luYyBhY3Rpb24gdGhpcyB3aWxsIGNhdXNlIGl0IHRvIHJlc2l6ZSB0aGUgbWFyZ2luc1xuICAgIG5nRG9DaGVjaygpOiB2b2lkIHtcbiAgICAgICAgLy8gUnVuIG91dHNpZGUgb2YgYW5ndWxhcidzIHNjb3BlIGJlY2F1c2UgZGVib3VuY2VUaW1lIHdpbGwgY2F1c2UgaW5maW5pdGUgbG9vcFxuICAgICAgICB0aGlzLl9uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4gdGhpcy5fZG9DaGVja1N1YmplY3QubmV4dCgpKTtcbiAgICB9XG5cbiAgICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgICAgIC8vIGRlYm91bmNlVGltZSBhbGxvd3MgdGhlIGNvbXBvbmVudCB0byByZW5kZXIgYmVmb3JlIHRoZSBtYXJnaW5zIGFyZSBjYWxjdWxhdGVkXG4gICAgICAgIHRoaXMuX2RvQ2hlY2tTdWJqZWN0XG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBkZWJvdW5jZVRpbWUoMTApLCAvLyBhcmJpdHJhcmlseSBzbWFsbCB2YWx1ZSBpcyB1c2VkIHRvIHF1aWNrbHkgcmVuZGVyIHRoZSBjb21wb25lbnQgc28gaW5jb3JyZWN0IG1hcmdpbnMgYXJlbid0IHNob3duXG4gICAgICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3llZClcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKCkgPT4gdGhpcy5fY2FsY3VsYXRlQ29udGVudE1hcmdpbnMoKSk7XG5cbiAgICAgICAgLy8gc3RhcnRXaXRoIHVzZWQgdG8gY2F1c2UgZmlyc3QgaXRlcmF0aW9uXG4gICAgICAgIHRoaXMuX2RyYXdlcnMuY2hhbmdlcy5waXBlKHN0YXJ0V2l0aChudWxsKSkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX3ZhbGlkYXRlRHJhd2VycygpO1xuXG4gICAgICAgICAgICB0aGlzLl9kcmF3ZXJzLmZvckVhY2goKGRyYXdlcjogRHJhd2VyKSA9PiB7XG4gICAgICAgICAgICAgICAgZHJhd2VyLl9hbmltYXRpb25TdGFydGVkXG4gICAgICAgICAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMuX2RyYXdlcnMuY2hhbmdlcyksXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIoKGV2ZW50OiBBbmltYXRpb25FdmVudCkgPT4gZXZlbnQuZnJvbVN0YXRlICE9PSBldmVudC50b1N0YXRlKVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2FsY3VsYXRlQ29udGVudE1hcmdpbnMoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZHJhd2VyLl9vcGVuQ2hhbmdlLnBpcGUodGFrZVVudGlsKHRoaXMuX2RyYXdlcnMuY2hhbmdlcykpLnN1YnNjcmliZShpc09wZW4gPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNPcGVuKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRDb250YWluZXJDbGFzcyh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldENvbnRhaW5lckNsYXNzKGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICghdGhpcy5fZHJhd2Vycy5sZW5ndGggfHwgdGhpcy5faXNEcmF3ZXJPcGVuKHRoaXMuX2xlZnREcmF3ZXIpIHx8IHRoaXMuX2lzRHJhd2VyT3Blbih0aGlzLl9yaWdodERyYXdlcikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jYWxjdWxhdGVDb250ZW50TWFyZ2lucygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9pc0RyYXdlck9wZW4oZHJhd2VyOiBEcmF3ZXIpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGRyYXdlciAhPSBudWxsICYmIGRyYXdlci5vcGVuZWQ7XG4gICAgfVxuXG4gICAgLyoqIE9wZW4gYWxsIGRyYXdlcnMgKi9cbiAgICBvcGVuKCk6IFByb21pc2U8RHJhd2VyUHJvbWlzZVJlc3VsdFtdPiB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5fbGVmdERyYXdlciwgdGhpcy5fcmlnaHREcmF3ZXJdLm1hcChkcmF3ZXIgPT4gZHJhd2VyICYmIGRyYXdlci50b2dnbGVPcGVuKCkpKTtcbiAgICB9XG5cbiAgICAvKiogQ2xvc2UgYWxsIGRyYXdlcnMgKi9cbiAgICBjbG9zZSgpOiBQcm9taXNlPERyYXdlclByb21pc2VSZXN1bHRbXT4ge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuX2xlZnREcmF3ZXIsIHRoaXMuX3JpZ2h0RHJhd2VyXS5tYXAoZHJhd2VyID0+IGRyYXdlciAmJiBkcmF3ZXIudG9nZ2xlQ2xvc2UoKSkpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2NhbGN1bGF0ZUNvbnRlbnRNYXJnaW5zKCk6IHZvaWQge1xuICAgICAgICBsZXQgbGVmdCA9IDA7XG4gICAgICAgIGxldCByaWdodCA9IDA7XG5cbiAgICAgICAgaWYgKHRoaXMuX2xlZnREcmF3ZXIgJiYgdGhpcy5fbGVmdERyYXdlci5vcGVuZWQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9sZWZ0RHJhd2VyLm1vZGUgPT09ICdzaWRlJykge1xuICAgICAgICAgICAgICAgIGxlZnQgKz0gdGhpcy5fbGVmdERyYXdlci5fd2lkdGg7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2xlZnREcmF3ZXIubW9kZSA9PT0gJ3B1c2gnKSB7XG4gICAgICAgICAgICAgICAgbGVmdCArPSB0aGlzLl9sZWZ0RHJhd2VyLl93aWR0aDtcbiAgICAgICAgICAgICAgICByaWdodCAtPSB0aGlzLl9sZWZ0RHJhd2VyLl93aWR0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLl9yaWdodERyYXdlciAmJiB0aGlzLl9yaWdodERyYXdlci5vcGVuZWQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9yaWdodERyYXdlci5tb2RlID09PSAnc2lkZScpIHtcbiAgICAgICAgICAgICAgICByaWdodCArPSB0aGlzLl9yaWdodERyYXdlci5fd2lkdGg7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX3JpZ2h0RHJhd2VyLm1vZGUgPT09ICdwdXNoJykge1xuICAgICAgICAgICAgICAgIHJpZ2h0ICs9IHRoaXMuX3JpZ2h0RHJhd2VyLl93aWR0aDtcbiAgICAgICAgICAgICAgICBsZWZ0IC09IHRoaXMuX3JpZ2h0RHJhd2VyLl93aWR0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChsZWZ0ICE9PSB0aGlzLl9jb250ZW50TWFyZ2lucy5sZWZ0IHx8IHJpZ2h0ICE9PSB0aGlzLl9jb250ZW50TWFyZ2lucy5yaWdodCkge1xuICAgICAgICAgICAgdGhpcy5fY29udGVudE1hcmdpbnMgPSB7bGVmdCwgcmlnaHR9O1xuXG4gICAgICAgICAgICB0aGlzLl9uZ1pvbmUucnVuKCgpID0+IHRoaXMuX2NoYW5nZURldGVjdG9yLm1hcmtGb3JDaGVjaygpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgX3ZhbGlkYXRlRHJhd2VycygpOiB2b2lkIHtcbiAgICAgICAgZm9yIChsZXQgZHJhd2VyIG9mIHRoaXMuX2RyYXdlcnMudG9BcnJheSgpKSB7XG4gICAgICAgICAgICBpZiAoZHJhd2VyLmFsaWduID09PSAncmlnaHQnKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3JpZ2h0RHJhd2VyICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3dEcmF3ZXJDb250YWluZXJFcnJvcigncmlnaHQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fcmlnaHREcmF3ZXIgPSBkcmF3ZXI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9sZWZ0RHJhd2VyICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3dEcmF3ZXJDb250YWluZXJFcnJvcignbGVmdCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLl9sZWZ0RHJhd2VyID0gZHJhd2VyO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfc2V0Q29udGFpbmVyQ2xhc3MoaXNPcGVuOiBib29sZWFuKTogdm9pZCB7XG4gICAgICAgIGlmIChpc09wZW4pIHtcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVyLmFkZENsYXNzKHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgJ2hjLWRyYXdlci1vcGVuZWQnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVyLnJlbW92ZUNsYXNzKHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgJ2hjLWRyYXdlci1vcGVuZWQnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgICAgICB0aGlzLl9kZXN0cm95ZWQubmV4dCgpO1xuICAgICAgICB0aGlzLl9kZXN0cm95ZWQuY29tcGxldGUoKTtcbiAgICAgICAgdGhpcy5fZG9DaGVja1N1YmplY3QuY29tcGxldGUoKTtcbiAgICB9XG59XG4iXX0=