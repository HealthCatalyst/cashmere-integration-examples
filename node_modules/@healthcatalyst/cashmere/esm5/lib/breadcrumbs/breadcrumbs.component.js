/**
 * @fileoverview added by tsickle
 * Generated from: lib/breadcrumbs/breadcrumbs.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, ViewEncapsulation } from '@angular/core';
import { ActivatedRoute, NavigationEnd, PRIMARY_OUTLET, Router } from '@angular/router';
/**
 * IBreadcrumb interface is used to store all required data for each breadcrumb element
 * \@docs-private
 * @record
 */
export function IBreadcrumb() { }
if (false) {
    /** @type {?} */
    IBreadcrumb.prototype.label;
    /** @type {?|undefined} */
    IBreadcrumb.prototype.params;
    /** @type {?} */
    IBreadcrumb.prototype.url;
}
/**
 * A navigational aid that allows users to keep track of their location within the current application
 */
var BreadcrumbsComponent = /** @class */ (function () {
    function BreadcrumbsComponent(activatedRoute, router) {
        this.activatedRoute = activatedRoute;
        this.router = router;
        this._breadcrumbs = [];
        this._backURL = '';
        this._backShow = 'none';
        this._locationLabel = '';
        this._queryParamsHandling = '';
    }
    Object.defineProperty(BreadcrumbsComponent.prototype, "queryParamsHandling", {
        /** Sets the handling of the query parameters for the breadcrumb. Choose from: `'preserve' | 'merge' | '' (default)` */
        get: /**
         * Sets the handling of the query parameters for the breadcrumb. Choose from: `'preserve' | 'merge' | '' (default)`
         * @return {?}
         */
        function () {
            return this._queryParamsHandling;
        },
        set: /**
         * @param {?} queryParamsHandling
         * @return {?}
         */
        function (queryParamsHandling) {
            this._queryParamsHandling = queryParamsHandling;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    BreadcrumbsComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var ROUTE_DATA_BREADCRUMB = 'breadcrumb';
        // Add the first breadcrumb for the base page
        /** @type {?} */
        var root = this.activatedRoute.root;
        this._breadcrumbs = this.getBreadcrumbs(root);
        // subscribe to the NavigationEnd event
        this._routerSubscription = this.router.events.subscribe((/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            if (event instanceof NavigationEnd) {
                _this.setBreadcrumbs();
            }
        }));
        // set initial breadcrumb state
        this.setBreadcrumbs();
    };
    /**
     * @private
     * @return {?}
     */
    BreadcrumbsComponent.prototype.setBreadcrumbs = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var root = this.activatedRoute.root;
        this._breadcrumbs = this.getBreadcrumbs(root);
        if (this._breadcrumbs.length > 1) {
            this._backURL = this._breadcrumbs[this._breadcrumbs.length - 2].url;
            this._backShow = 'inline';
            this._locationLabel = '';
        }
        else if (this._breadcrumbs.length === 1) {
            this._backShow = 'none';
            this._locationLabel = this._breadcrumbs[this._breadcrumbs.length - 1].label;
        }
        else {
            this._backShow = 'none';
            this._locationLabel = '';
        }
    };
    /**
     * @private
     * @param {?} route
     * @param {?=} url
     * @param {?=} breadcrumbs
     * @return {?}
     */
    BreadcrumbsComponent.prototype.getBreadcrumbs = /**
     * @private
     * @param {?} route
     * @param {?=} url
     * @param {?=} breadcrumbs
     * @return {?}
     */
    function (route, url, breadcrumbs) {
        var e_1, _a;
        if (url === void 0) { url = ''; }
        if (breadcrumbs === void 0) { breadcrumbs = []; }
        /** @type {?} */
        var ROUTE_DATA_BREADCRUMB = 'breadcrumb';
        // get the child routes
        /** @type {?} */
        var children = route.children;
        // return if there are no more children
        if (children.length === 0) {
            return breadcrumbs;
        }
        try {
            // iterate over each children
            for (var children_1 = tslib_1.__values(children), children_1_1 = children_1.next(); !children_1_1.done; children_1_1 = children_1.next()) {
                var child = children_1_1.value;
                // verify primary route
                if (child.outlet !== PRIMARY_OUTLET) {
                    continue;
                }
                // verify the custom data property "breadcrumb" is specified on the route
                if (!child.snapshot.data.hasOwnProperty(ROUTE_DATA_BREADCRUMB)) {
                    return this.getBreadcrumbs(child, url, breadcrumbs);
                }
                // get the route's URL segment
                /** @type {?} */
                var routeURL = child.snapshot.url.map((/**
                 * @param {?} segment
                 * @return {?}
                 */
                function (segment) { return segment.path; })).join('/');
                // append route URL to URL
                url += "/" + routeURL;
                // add breadcrumb
                /** @type {?} */
                var parent_1 = this.activatedRoute.parent;
                /** @type {?} */
                var fullURL = '';
                if (parent_1 !== null) {
                    fullURL += '/' + parent_1.snapshot.url.map((/**
                     * @param {?} segment
                     * @return {?}
                     */
                    function (segment) { return segment.path; })).join('/');
                }
                fullURL += "" + url;
                /** @type {?} */
                var breadcrumb = {
                    label: child.snapshot.data[ROUTE_DATA_BREADCRUMB],
                    params: child.snapshot.params,
                    url: fullURL
                };
                breadcrumbs.push(breadcrumb);
                // recursive
                return this.getBreadcrumbs(child, url, breadcrumbs);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (children_1_1 && !children_1_1.done && (_a = children_1.return)) _a.call(children_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        // we should never get here, but just in case
        return breadcrumbs;
    };
    /**
     * @return {?}
     */
    BreadcrumbsComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this._routerSubscription.unsubscribe();
    };
    BreadcrumbsComponent.decorators = [
        { type: Component, args: [{
                    selector: 'hc-breadcrumbs',
                    template: "<ol class=\"breadcrumb\">\n    <li *ngFor=\"let breadcrumb of _breadcrumbs; let last = last\" class=\"breadcrumb-item\">\n        <a *ngIf=\"!last\" [routerLink]=\"[breadcrumb.url]\" queryParamsHandling=\"{{queryParamsHandling}}\" [innerText]=\"breadcrumb.label\"></a>\n        <span *ngIf=\"last\" [innerText]=\"breadcrumb.label\"></span>\n        <i class=\"fa fa-chevron-right breadcrumb-arrow\"></i>\n    </li>\n</ol>\n<div class=\"breadcrumb-responsive-container\">\n    <a [style.display]=\"_backShow\" class=\"breadcrumb-back-button\" [routerLink]=\"_backURL\" queryParamsHandling=\"{{queryParamsHandling}}\">\n        <i class=\"fa fa-chevron-left\"></i>\n        <span>&nbsp;Back</span>\n    </a>\n    <span [innerText]=\"_locationLabel\"></span>\n</div>\n",
                    encapsulation: ViewEncapsulation.None
                }] }
    ];
    /** @nocollapse */
    BreadcrumbsComponent.ctorParameters = function () { return [
        { type: ActivatedRoute },
        { type: Router }
    ]; };
    BreadcrumbsComponent.propDecorators = {
        queryParamsHandling: [{ type: Input }]
    };
    return BreadcrumbsComponent;
}());
export { BreadcrumbsComponent };
if (false) {
    /** @type {?} */
    BreadcrumbsComponent.prototype._breadcrumbs;
    /** @type {?} */
    BreadcrumbsComponent.prototype._routerSubscription;
    /** @type {?} */
    BreadcrumbsComponent.prototype._backURL;
    /** @type {?} */
    BreadcrumbsComponent.prototype._backShow;
    /** @type {?} */
    BreadcrumbsComponent.prototype._locationLabel;
    /** @type {?} */
    BreadcrumbsComponent.prototype._queryParamsHandling;
    /**
     * @type {?}
     * @private
     */
    BreadcrumbsComponent.prototype.activatedRoute;
    /**
     * @type {?}
     * @private
     */
    BreadcrumbsComponent.prototype.router;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnJlYWRjcnVtYnMuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGhlYWx0aGNhdGFseXN0L2Nhc2htZXJlLyIsInNvdXJjZXMiOlsibGliL2JyZWFkY3J1bWJzL2JyZWFkY3J1bWJzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFxQixLQUFLLEVBQUUsaUJBQWlCLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDckYsT0FBTyxFQUFDLGNBQWMsRUFBUyxhQUFhLEVBQVUsY0FBYyxFQUFFLE1BQU0sRUFBQyxNQUFNLGlCQUFpQixDQUFDOzs7Ozs7QUFNckcsaUNBSUM7OztJQUhHLDRCQUFjOztJQUNkLDZCQUFnQjs7SUFDaEIsMEJBQVk7Ozs7O0FBVWhCO0lBdUJJLDhCQUFvQixjQUE4QixFQUFVLE1BQWM7UUFBdEQsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQWpCbkUsaUJBQVksR0FBa0IsRUFBRSxDQUFDO1FBRXhDLGFBQVEsR0FBVyxFQUFFLENBQUM7UUFDdEIsY0FBUyxHQUFXLE1BQU0sQ0FBQztRQUMzQixtQkFBYyxHQUFXLEVBQUUsQ0FBQztRQUM1Qix5QkFBb0IsR0FBd0IsRUFBRSxDQUFDO0lBWThCLENBQUM7SUFUOUUsc0JBQ0kscURBQW1CO1FBRnZCLHVIQUF1SDs7Ozs7UUFDdkg7WUFFSSxPQUFPLElBQUksQ0FBQyxvQkFBb0IsQ0FBQztRQUNyQyxDQUFDOzs7OztRQUVELFVBQXdCLG1CQUF3QztZQUM1RCxJQUFJLENBQUMsb0JBQW9CLEdBQUcsbUJBQW1CLENBQUM7UUFDcEQsQ0FBQzs7O09BSkE7Ozs7SUFRRCx1Q0FBUTs7O0lBQVI7UUFBQSxpQkFlQzs7WUFkUyxxQkFBcUIsR0FBVyxZQUFZOzs7WUFFOUMsSUFBSSxHQUFtQixJQUFJLENBQUMsY0FBYyxDQUFDLElBQUk7UUFDbkQsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRTlDLHVDQUF1QztRQUN2QyxJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUzs7OztRQUFDLFVBQUMsS0FBWTtZQUNqRSxJQUFJLEtBQUssWUFBWSxhQUFhLEVBQUU7Z0JBQ2hDLEtBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQzthQUN6QjtRQUNMLENBQUMsRUFBQyxDQUFDO1FBRUgsK0JBQStCO1FBQy9CLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztJQUMxQixDQUFDOzs7OztJQUVPLDZDQUFjOzs7O0lBQXRCOztZQUNVLElBQUksR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUk7UUFDckMsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzlDLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQzlCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUM7WUFDcEUsSUFBSSxDQUFDLFNBQVMsR0FBRyxRQUFRLENBQUM7WUFDMUIsSUFBSSxDQUFDLGNBQWMsR0FBRyxFQUFFLENBQUM7U0FDNUI7YUFBTSxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUN2QyxJQUFJLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQztZQUN4QixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1NBQy9FO2FBQU07WUFDSCxJQUFJLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQztZQUN4QixJQUFJLENBQUMsY0FBYyxHQUFHLEVBQUUsQ0FBQztTQUM1QjtJQUNMLENBQUM7Ozs7Ozs7O0lBRU8sNkNBQWM7Ozs7Ozs7SUFBdEIsVUFBdUIsS0FBcUIsRUFBRSxHQUFnQixFQUFFLFdBQStCOztRQUFqRCxvQkFBQSxFQUFBLFFBQWdCO1FBQUUsNEJBQUEsRUFBQSxnQkFBK0I7O1lBQ3JGLHFCQUFxQixHQUFXLFlBQVk7OztZQUc5QyxRQUFRLEdBQXFCLEtBQUssQ0FBQyxRQUFRO1FBRS9DLHVDQUF1QztRQUN2QyxJQUFJLFFBQVEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQ3ZCLE9BQU8sV0FBVyxDQUFDO1NBQ3RCOztZQUVELDZCQUE2QjtZQUM3QixLQUFrQixJQUFBLGFBQUEsaUJBQUEsUUFBUSxDQUFBLGtDQUFBLHdEQUFFO2dCQUF2QixJQUFJLEtBQUsscUJBQUE7Z0JBQ1YsdUJBQXVCO2dCQUN2QixJQUFJLEtBQUssQ0FBQyxNQUFNLEtBQUssY0FBYyxFQUFFO29CQUNqQyxTQUFTO2lCQUNaO2dCQUVELHlFQUF5RTtnQkFDekUsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxxQkFBcUIsQ0FBQyxFQUFFO29CQUM1RCxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxXQUFXLENBQUMsQ0FBQztpQkFDdkQ7OztvQkFHRyxRQUFRLEdBQVcsS0FBSyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsR0FBRzs7OztnQkFBQyxVQUFBLE9BQU8sSUFBSSxPQUFBLE9BQU8sQ0FBQyxJQUFJLEVBQVosQ0FBWSxFQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQztnQkFFaEYsMEJBQTBCO2dCQUMxQixHQUFHLElBQUksTUFBSSxRQUFVLENBQUM7OztvQkFHbEIsUUFBTSxHQUEwQixJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU07O29CQUMxRCxPQUFPLEdBQVcsRUFBRTtnQkFDeEIsSUFBSSxRQUFNLEtBQUssSUFBSSxFQUFFO29CQUNqQixPQUFPLElBQUksR0FBRyxHQUFHLFFBQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEdBQUc7Ozs7b0JBQUMsVUFBQSxPQUFPLElBQUksT0FBQSxPQUFPLENBQUMsSUFBSSxFQUFaLENBQVksRUFBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztpQkFDL0U7Z0JBQ0QsT0FBTyxJQUFJLEtBQUcsR0FBSyxDQUFDOztvQkFDaEIsVUFBVSxHQUFnQjtvQkFDMUIsS0FBSyxFQUFFLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDO29CQUNqRCxNQUFNLEVBQUUsS0FBSyxDQUFDLFFBQVEsQ0FBQyxNQUFNO29CQUM3QixHQUFHLEVBQUUsT0FBTztpQkFDZjtnQkFFRCxXQUFXLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2dCQUU3QixZQUFZO2dCQUNaLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLFdBQVcsQ0FBQyxDQUFDO2FBQ3ZEOzs7Ozs7Ozs7UUFFRCw2Q0FBNkM7UUFDN0MsT0FBTyxXQUFXLENBQUM7SUFDdkIsQ0FBQzs7OztJQUVELDBDQUFXOzs7SUFBWDtRQUNJLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUMzQyxDQUFDOztnQkFoSEosU0FBUyxTQUFDO29CQUNQLFFBQVEsRUFBRSxnQkFBZ0I7b0JBQzFCLHl3QkFBMkM7b0JBQzNDLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO2lCQUN4Qzs7OztnQkF2Qk8sY0FBYztnQkFBZ0QsTUFBTTs7O3NDQWlDdkUsS0FBSzs7SUFtR1YsMkJBQUM7Q0FBQSxBQWpIRCxJQWlIQztTQTVHWSxvQkFBb0I7OztJQUM3Qiw0Q0FBd0M7O0lBQ3hDLG1EQUFnQzs7SUFDaEMsd0NBQXNCOztJQUN0Qix5Q0FBMkI7O0lBQzNCLDhDQUE0Qjs7SUFDNUIsb0RBQStDOzs7OztJQVluQyw4Q0FBc0M7Ozs7O0lBQUUsc0NBQXNCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIE9uRGVzdHJveSwgT25Jbml0LCBJbnB1dCwgVmlld0VuY2Fwc3VsYXRpb259IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtBY3RpdmF0ZWRSb3V0ZSwgRXZlbnQsIE5hdmlnYXRpb25FbmQsIFBhcmFtcywgUFJJTUFSWV9PVVRMRVQsIFJvdXRlcn0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcblxuLyoqXG4gKiBJQnJlYWRjcnVtYiBpbnRlcmZhY2UgaXMgdXNlZCB0byBzdG9yZSBhbGwgcmVxdWlyZWQgZGF0YSBmb3IgZWFjaCBicmVhZGNydW1iIGVsZW1lbnRcbiAqIEBkb2NzLXByaXZhdGVcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBJQnJlYWRjcnVtYiB7XG4gICAgbGFiZWw6IHN0cmluZztcbiAgICBwYXJhbXM/OiBQYXJhbXM7XG4gICAgdXJsOiBzdHJpbmc7XG59XG5cbi8qXG4gIFRoaXMgdHlwZSBpcyBmcm9tIEBhbmd1bGFyL3JvdXRlciwgYnV0IHRoZSBpbXBvcnQgbG9jYXRpb24gdmFyaWVzIGJ5IEFuZ3VsYXIgdmVyc2lvblxuICBJbmNsdWRpbmcgaGVyZSB0byBhbGxvdyBDYXNobWVyZSB0byB3b3JrIHJlZ2FyZGxlc3Mgb2YgQW5ndWxhciB2ZXJzaW9uXG4qL1xuZXhwb3J0IHR5cGUgUXVlcnlQYXJhbXNIYW5kbGluZyA9ICdtZXJnZScgfCAncHJlc2VydmUnIHwgJyc7XG5cbi8qKiBBIG5hdmlnYXRpb25hbCBhaWQgdGhhdCBhbGxvd3MgdXNlcnMgdG8ga2VlcCB0cmFjayBvZiB0aGVpciBsb2NhdGlvbiB3aXRoaW4gdGhlIGN1cnJlbnQgYXBwbGljYXRpb24gICovXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2hjLWJyZWFkY3J1bWJzJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vYnJlYWRjcnVtYnMuY29tcG9uZW50Lmh0bWwnLFxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcbn0pXG5leHBvcnQgY2xhc3MgQnJlYWRjcnVtYnNDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG4gICAgcHVibGljIF9icmVhZGNydW1iczogSUJyZWFkY3J1bWJbXSA9IFtdO1xuICAgIHB1YmxpYyBfcm91dGVyU3Vic2NyaXB0aW9uOiBhbnk7XG4gICAgX2JhY2tVUkw6IHN0cmluZyA9ICcnO1xuICAgIF9iYWNrU2hvdzogc3RyaW5nID0gJ25vbmUnO1xuICAgIF9sb2NhdGlvbkxhYmVsOiBzdHJpbmcgPSAnJztcbiAgICBfcXVlcnlQYXJhbXNIYW5kbGluZzogUXVlcnlQYXJhbXNIYW5kbGluZyA9ICcnO1xuXG4gICAgLyoqIFNldHMgdGhlIGhhbmRsaW5nIG9mIHRoZSBxdWVyeSBwYXJhbWV0ZXJzIGZvciB0aGUgYnJlYWRjcnVtYi4gQ2hvb3NlIGZyb206IGAncHJlc2VydmUnIHwgJ21lcmdlJyB8ICcnIChkZWZhdWx0KWAgKi9cbiAgICBASW5wdXQoKVxuICAgIGdldCBxdWVyeVBhcmFtc0hhbmRsaW5nKCk6IFF1ZXJ5UGFyYW1zSGFuZGxpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5fcXVlcnlQYXJhbXNIYW5kbGluZztcbiAgICB9XG5cbiAgICBzZXQgcXVlcnlQYXJhbXNIYW5kbGluZyhxdWVyeVBhcmFtc0hhbmRsaW5nOiBRdWVyeVBhcmFtc0hhbmRsaW5nKSB7XG4gICAgICAgIHRoaXMuX3F1ZXJ5UGFyYW1zSGFuZGxpbmcgPSBxdWVyeVBhcmFtc0hhbmRsaW5nO1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgYWN0aXZhdGVkUm91dGU6IEFjdGl2YXRlZFJvdXRlLCBwcml2YXRlIHJvdXRlcjogUm91dGVyKSB7fVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIGNvbnN0IFJPVVRFX0RBVEFfQlJFQURDUlVNQjogc3RyaW5nID0gJ2JyZWFkY3J1bWInO1xuICAgICAgICAvLyBBZGQgdGhlIGZpcnN0IGJyZWFkY3J1bWIgZm9yIHRoZSBiYXNlIHBhZ2VcbiAgICAgICAgbGV0IHJvb3Q6IEFjdGl2YXRlZFJvdXRlID0gdGhpcy5hY3RpdmF0ZWRSb3V0ZS5yb290O1xuICAgICAgICB0aGlzLl9icmVhZGNydW1icyA9IHRoaXMuZ2V0QnJlYWRjcnVtYnMocm9vdCk7XG5cbiAgICAgICAgLy8gc3Vic2NyaWJlIHRvIHRoZSBOYXZpZ2F0aW9uRW5kIGV2ZW50XG4gICAgICAgIHRoaXMuX3JvdXRlclN1YnNjcmlwdGlvbiA9IHRoaXMucm91dGVyLmV2ZW50cy5zdWJzY3JpYmUoKGV2ZW50OiBFdmVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKGV2ZW50IGluc3RhbmNlb2YgTmF2aWdhdGlvbkVuZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0QnJlYWRjcnVtYnMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gc2V0IGluaXRpYWwgYnJlYWRjcnVtYiBzdGF0ZVxuICAgICAgICB0aGlzLnNldEJyZWFkY3J1bWJzKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXRCcmVhZGNydW1icygpIHtcbiAgICAgICAgY29uc3Qgcm9vdCA9IHRoaXMuYWN0aXZhdGVkUm91dGUucm9vdDtcbiAgICAgICAgdGhpcy5fYnJlYWRjcnVtYnMgPSB0aGlzLmdldEJyZWFkY3J1bWJzKHJvb3QpO1xuICAgICAgICBpZiAodGhpcy5fYnJlYWRjcnVtYnMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgdGhpcy5fYmFja1VSTCA9IHRoaXMuX2JyZWFkY3J1bWJzW3RoaXMuX2JyZWFkY3J1bWJzLmxlbmd0aCAtIDJdLnVybDtcbiAgICAgICAgICAgIHRoaXMuX2JhY2tTaG93ID0gJ2lubGluZSc7XG4gICAgICAgICAgICB0aGlzLl9sb2NhdGlvbkxhYmVsID0gJyc7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5fYnJlYWRjcnVtYnMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICB0aGlzLl9iYWNrU2hvdyA9ICdub25lJztcbiAgICAgICAgICAgIHRoaXMuX2xvY2F0aW9uTGFiZWwgPSB0aGlzLl9icmVhZGNydW1ic1t0aGlzLl9icmVhZGNydW1icy5sZW5ndGggLSAxXS5sYWJlbDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX2JhY2tTaG93ID0gJ25vbmUnO1xuICAgICAgICAgICAgdGhpcy5fbG9jYXRpb25MYWJlbCA9ICcnO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRCcmVhZGNydW1icyhyb3V0ZTogQWN0aXZhdGVkUm91dGUsIHVybDogc3RyaW5nID0gJycsIGJyZWFkY3J1bWJzOiBJQnJlYWRjcnVtYltdID0gW10pOiBJQnJlYWRjcnVtYltdIHtcbiAgICAgICAgY29uc3QgUk9VVEVfREFUQV9CUkVBRENSVU1COiBzdHJpbmcgPSAnYnJlYWRjcnVtYic7XG5cbiAgICAgICAgLy8gZ2V0IHRoZSBjaGlsZCByb3V0ZXNcbiAgICAgICAgbGV0IGNoaWxkcmVuOiBBY3RpdmF0ZWRSb3V0ZVtdID0gcm91dGUuY2hpbGRyZW47XG5cbiAgICAgICAgLy8gcmV0dXJuIGlmIHRoZXJlIGFyZSBubyBtb3JlIGNoaWxkcmVuXG4gICAgICAgIGlmIChjaGlsZHJlbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBicmVhZGNydW1icztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGl0ZXJhdGUgb3ZlciBlYWNoIGNoaWxkcmVuXG4gICAgICAgIGZvciAobGV0IGNoaWxkIG9mIGNoaWxkcmVuKSB7XG4gICAgICAgICAgICAvLyB2ZXJpZnkgcHJpbWFyeSByb3V0ZVxuICAgICAgICAgICAgaWYgKGNoaWxkLm91dGxldCAhPT0gUFJJTUFSWV9PVVRMRVQpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gdmVyaWZ5IHRoZSBjdXN0b20gZGF0YSBwcm9wZXJ0eSBcImJyZWFkY3J1bWJcIiBpcyBzcGVjaWZpZWQgb24gdGhlIHJvdXRlXG4gICAgICAgICAgICBpZiAoIWNoaWxkLnNuYXBzaG90LmRhdGEuaGFzT3duUHJvcGVydHkoUk9VVEVfREFUQV9CUkVBRENSVU1CKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEJyZWFkY3J1bWJzKGNoaWxkLCB1cmwsIGJyZWFkY3J1bWJzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gZ2V0IHRoZSByb3V0ZSdzIFVSTCBzZWdtZW50XG4gICAgICAgICAgICBsZXQgcm91dGVVUkw6IHN0cmluZyA9IGNoaWxkLnNuYXBzaG90LnVybC5tYXAoc2VnbWVudCA9PiBzZWdtZW50LnBhdGgpLmpvaW4oJy8nKTtcblxuICAgICAgICAgICAgLy8gYXBwZW5kIHJvdXRlIFVSTCB0byBVUkxcbiAgICAgICAgICAgIHVybCArPSBgLyR7cm91dGVVUkx9YDtcblxuICAgICAgICAgICAgLy8gYWRkIGJyZWFkY3J1bWJcbiAgICAgICAgICAgIGxldCBwYXJlbnQ6IEFjdGl2YXRlZFJvdXRlIHwgbnVsbCA9IHRoaXMuYWN0aXZhdGVkUm91dGUucGFyZW50O1xuICAgICAgICAgICAgbGV0IGZ1bGxVUkw6IHN0cmluZyA9ICcnO1xuICAgICAgICAgICAgaWYgKHBhcmVudCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGZ1bGxVUkwgKz0gJy8nICsgcGFyZW50LnNuYXBzaG90LnVybC5tYXAoc2VnbWVudCA9PiBzZWdtZW50LnBhdGgpLmpvaW4oJy8nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZ1bGxVUkwgKz0gYCR7dXJsfWA7XG4gICAgICAgICAgICBsZXQgYnJlYWRjcnVtYjogSUJyZWFkY3J1bWIgPSB7XG4gICAgICAgICAgICAgICAgbGFiZWw6IGNoaWxkLnNuYXBzaG90LmRhdGFbUk9VVEVfREFUQV9CUkVBRENSVU1CXSxcbiAgICAgICAgICAgICAgICBwYXJhbXM6IGNoaWxkLnNuYXBzaG90LnBhcmFtcyxcbiAgICAgICAgICAgICAgICB1cmw6IGZ1bGxVUkxcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGJyZWFkY3J1bWJzLnB1c2goYnJlYWRjcnVtYik7XG5cbiAgICAgICAgICAgIC8vIHJlY3Vyc2l2ZVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QnJlYWRjcnVtYnMoY2hpbGQsIHVybCwgYnJlYWRjcnVtYnMpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gd2Ugc2hvdWxkIG5ldmVyIGdldCBoZXJlLCBidXQganVzdCBpbiBjYXNlXG4gICAgICAgIHJldHVybiBicmVhZGNydW1icztcbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5fcm91dGVyU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxufVxuIl19