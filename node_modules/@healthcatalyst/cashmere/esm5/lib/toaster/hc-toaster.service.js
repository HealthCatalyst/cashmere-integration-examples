/**
 * @fileoverview added by tsickle
 * Generated from: lib/toaster/hc-toaster.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable, Injector, TemplateRef } from '@angular/core';
import { Overlay, OverlayConfig } from '@angular/cdk/overlay';
import { ComponentPortal, PortalInjector, TemplatePortal } from '@angular/cdk/portal';
import { HcToastComponent } from './hc-toast.component';
import { HcToastRef } from './hc-toast-ref';
import { filter, take } from 'rxjs/operators';
/**
 * Toasts provide users with instant feedback on actions they've taken. For more general information,
 * use a `hc-banner`.
 */
var HcToasterService = /** @class */ (function () {
    // Inject overlay service
    function HcToasterService(injector, _overlay) {
        this.injector = injector;
        this._overlay = _overlay;
        this._toasts = [];
    }
    /** Displays a new toaster message with the settings included in `toastOptions`. `toastContent` can be used to
     * create entirely custom toasts, but only if the type in toastOptions is set to `custom`. Be sure to set `border-radius: 5px`
     * in the style of your custom content template so it matches the toast container. If your custom toast is
     * using a component, the `componentSetup` parameter accepts an object or function to configure that component. */
    /**
     * Displays a new toaster message with the settings included in `toastOptions`. `toastContent` can be used to
     * create entirely custom toasts, but only if the type in toastOptions is set to `custom`. Be sure to set `border-radius: 5px`
     * in the style of your custom content template so it matches the toast container. If your custom toast is
     * using a component, the `componentSetup` parameter accepts an object or function to configure that component.
     * @template T
     * @param {?=} toastOptions
     * @param {?=} toastContent
     * @param {?=} componentSetup
     * @return {?}
     */
    HcToasterService.prototype.addToast = /**
     * Displays a new toaster message with the settings included in `toastOptions`. `toastContent` can be used to
     * create entirely custom toasts, but only if the type in toastOptions is set to `custom`. Be sure to set `border-radius: 5px`
     * in the style of your custom content template so it matches the toast container. If your custom toast is
     * using a component, the `componentSetup` parameter accepts an object or function to configure that component.
     * @template T
     * @param {?=} toastOptions
     * @param {?=} toastContent
     * @param {?=} componentSetup
     * @return {?}
     */
    function (toastOptions, toastContent, componentSetup) {
        var _this = this;
        /** @type {?} */
        var defaultOptions = {
            type: 'success',
            position: 'bottom-right',
            timeout: 5000,
            clickDismiss: false
        };
        /** @type {?} */
        var options = tslib_1.__assign({}, defaultOptions, toastOptions);
        // Returns an OverlayRef (which is a PortalHost)
        /** @type {?} */
        var _overlayRef = this._createOverlay(options);
        // Instantiate remote control
        /** @type {?} */
        var _toastRef = new HcToastRef(_overlayRef);
        /** @type {?} */
        var overlayComponent = this._attachToastContainer(_overlayRef, _toastRef);
        _toastRef.componentInstance = overlayComponent;
        if (options.type === 'custom' && toastContent) {
            if (toastContent instanceof TemplateRef) {
                _toastRef.componentInstance._toastPortal = new TemplatePortal(toastContent, _toastRef.componentInstance._viewContainerRef);
            }
            else {
                _toastRef.componentInstance._toastPortal = new ComponentPortal(toastContent);
                if (componentSetup) {
                    _toastRef.componentInstance._componentInstance.pipe(filter((/**
                     * @param {?} c
                     * @return {?}
                     */
                    function (c) { return !!c; }))).subscribe((/**
                     * @param {?} c
                     * @return {?}
                     */
                    function (c) {
                        if (componentSetup instanceof Function) {
                            componentSetup(c);
                        }
                        else {
                            Object.keys(componentSetup).forEach((/**
                             * @param {?} k
                             * @return {?}
                             */
                            function (k) { return (c[k] = componentSetup[k]); }));
                        }
                    }));
                }
            }
        }
        // Listen for click events to close the toast if the option is set
        if (options.clickDismiss) {
            _toastRef.componentInstance._canDismiss = options.clickDismiss;
            _toastRef.componentInstance._closeClick.subscribe((/**
             * @return {?}
             */
            function () {
                _toastRef.close();
            }));
        }
        // Set the class for the type set in options
        if (options.type) {
            if (options.type === 'success' ||
                options.type === 'info' ||
                options.type === 'warning' ||
                options.type === 'alert' ||
                options.type === 'custom') {
                _toastRef.componentInstance._styleType = options.type;
            }
            else {
                throw Error('Unsupported toaster type: ' + options.type);
            }
        }
        // Set the header text
        if (options.header) {
            _toastRef.componentInstance._headerText = options.header;
        }
        // Set the toast width
        if (options.width || options.width === 0) {
            _toastRef.componentInstance._width = options.width;
        }
        // Set the body text
        if (options.body) {
            _toastRef.componentInstance._bodyText = options.body;
        }
        // Store the positioning of the toast
        _toastRef._toastPosition = String(options.position);
        // Set progress bar
        if (options.hasProgressBar) {
            _toastRef.componentInstance._hasProgressBar = options.hasProgressBar;
        }
        // Set the timeout interval to close the toast if non-zero
        if (options.timeout !== 0) {
            setTimeout((/**
             * @return {?}
             */
            function () {
                if (_toastRef.componentInstance) {
                    _toastRef.close();
                }
            }), options.timeout);
        }
        // Cleanup functions called when the toast close animation is triggered
        _toastRef.componentInstance._animationStateChanged
            .pipe(filter((/**
         * @param {?} event
         * @return {?}
         */
        function (event) { return event.phaseName === 'done' && event.toState === 'leave'; })), take(1))
            .subscribe((/**
         * @return {?}
         */
        function () {
            _this._removeToastPointer(_toastRef);
            if (options.toastClosed) {
                options.toastClosed();
            }
            _this._updateToastPositions();
            _toastRef.componentInstance._closeClick.unsubscribe();
        }));
        _toastRef.componentInstance._changeRef.detectChanges();
        this._toasts.push(_toastRef);
        return _toastRef;
    };
    /** Closes the most recent toast displayed */
    /**
     * Closes the most recent toast displayed
     * @return {?}
     */
    HcToasterService.prototype.closeLastToast = /**
     * Closes the most recent toast displayed
     * @return {?}
     */
    function () {
        if (this._toasts.length > 0) {
            /** @type {?} */
            var element = this._toasts[this._toasts.length - 1];
            if (element) {
                element.close();
            }
        }
    };
    /** Closes currently visible toasts */
    /**
     * Closes currently visible toasts
     * @return {?}
     */
    HcToasterService.prototype.closeAllToasts = /**
     * Closes currently visible toasts
     * @return {?}
     */
    function () {
        /** @type {?} */
        var len = this._toasts.length;
        for (var index = 0; index < len; index++) {
            /** @type {?} */
            var element = this._toasts[index];
            if (element) {
                element.close();
            }
        }
    };
    /**
     * @private
     * @param {?} config
     * @return {?}
     */
    HcToasterService.prototype._createOverlay = /**
     * @private
     * @param {?} config
     * @return {?}
     */
    function (config) {
        /** @type {?} */
        var overlayConfig = this._getOverlayConfig(config);
        return this._overlay.create(overlayConfig);
    };
    /**
     * @private
     * @param {?} overlayRef
     * @param {?} toastRef
     * @return {?}
     */
    HcToasterService.prototype._attachToastContainer = /**
     * @private
     * @param {?} overlayRef
     * @param {?} toastRef
     * @return {?}
     */
    function (overlayRef, toastRef) {
        /** @type {?} */
        var injector = this._createInjector(toastRef);
        /** @type {?} */
        var containerPortal = new ComponentPortal(HcToastComponent, null, injector);
        /** @type {?} */
        var containerRef = overlayRef.attach(containerPortal);
        return containerRef.instance;
    };
    /**
     * @private
     * @param {?} toastRef
     * @return {?}
     */
    HcToasterService.prototype._createInjector = /**
     * @private
     * @param {?} toastRef
     * @return {?}
     */
    function (toastRef) {
        /** @type {?} */
        var injectionTokens = new WeakMap();
        injectionTokens.set(HcToastRef, toastRef);
        return new PortalInjector(this.injector, injectionTokens);
    };
    /**
     * @private
     * @param {?} config
     * @return {?}
     */
    HcToasterService.prototype._getOverlayConfig = /**
     * @private
     * @param {?} config
     * @return {?}
     */
    function (config) {
        /** @type {?} */
        var overlayConfig;
        /** @type {?} */
        var positionStrategy = this._getPositionStrategy(String(config.position), this._toasts.length);
        if (config.position === 'top-full-width' || config.position === 'bottom-full-width') {
            overlayConfig = new OverlayConfig({ positionStrategy: positionStrategy, width: '96%', panelClass: 'overlay-pointer-events' });
        }
        else {
            overlayConfig = new OverlayConfig({ positionStrategy: positionStrategy, panelClass: 'overlay-pointer-events' });
        }
        return overlayConfig;
    };
    /**
     * @private
     * @param {?} position
     * @param {?} index
     * @return {?}
     */
    HcToasterService.prototype._getPositionStrategy = /**
     * @private
     * @param {?} position
     * @param {?} index
     * @return {?}
     */
    function (position, index) {
        /** @type {?} */
        var positionStrategy;
        /** @type {?} */
        var toastIndex = this._getLastToast(position, index);
        switch (position) {
            case 'top-right':
                if (toastIndex !== -1) {
                    positionStrategy = this._overlay
                        .position()
                        .flexibleConnectedTo(this._toasts[toastIndex].componentInstance._el.nativeElement.children[0])
                        .withPositions([
                        {
                            overlayX: 'end',
                            overlayY: 'top',
                            originX: 'end',
                            originY: 'bottom'
                        }
                    ]);
                }
                else {
                    positionStrategy = this._overlay
                        .position()
                        .global()
                        .right('10px');
                }
                break;
            case 'top-center':
                if (toastIndex !== -1) {
                    positionStrategy = this._overlay
                        .position()
                        .flexibleConnectedTo(this._toasts[toastIndex].componentInstance._el.nativeElement.children[0])
                        .withPositions([
                        {
                            overlayX: 'center',
                            overlayY: 'top',
                            originX: 'center',
                            originY: 'bottom'
                        }
                    ]);
                }
                else {
                    positionStrategy = this._overlay
                        .position()
                        .global()
                        .centerHorizontally();
                }
                break;
            case 'top-left':
                if (toastIndex !== -1) {
                    positionStrategy = this._overlay
                        .position()
                        .flexibleConnectedTo(this._toasts[toastIndex].componentInstance._el.nativeElement.children[0])
                        .withPositions([
                        {
                            overlayX: 'start',
                            overlayY: 'top',
                            originX: 'start',
                            originY: 'bottom'
                        }
                    ]);
                }
                else {
                    positionStrategy = this._overlay
                        .position()
                        .global()
                        .left('10px');
                }
                break;
            case 'top-full-width':
                if (toastIndex !== -1) {
                    positionStrategy = this._overlay
                        .position()
                        .flexibleConnectedTo(this._toasts[toastIndex].componentInstance._el.nativeElement.children[0])
                        .withFlexibleDimensions(false)
                        .withPositions([
                        {
                            overlayX: 'center',
                            overlayY: 'top',
                            originX: 'center',
                            originY: 'bottom'
                        }
                    ]);
                }
                else {
                    positionStrategy = this._overlay
                        .position()
                        .global()
                        .centerHorizontally();
                }
                break;
            case 'bottom-right':
                if (toastIndex !== -1) {
                    positionStrategy = this._overlay
                        .position()
                        .flexibleConnectedTo(this._toasts[toastIndex].componentInstance._el.nativeElement.children[0])
                        .withPositions([
                        {
                            overlayX: 'end',
                            overlayY: 'bottom',
                            originX: 'end',
                            originY: 'top'
                        }
                    ]);
                }
                else {
                    positionStrategy = this._overlay
                        .position()
                        .global()
                        .bottom()
                        .right('10px');
                }
                break;
            case 'bottom-center':
                if (toastIndex !== -1) {
                    positionStrategy = this._overlay
                        .position()
                        .flexibleConnectedTo(this._toasts[toastIndex].componentInstance._el.nativeElement.children[0])
                        .withPositions([
                        {
                            overlayX: 'center',
                            overlayY: 'bottom',
                            originX: 'center',
                            originY: 'top'
                        }
                    ]);
                }
                else {
                    positionStrategy = this._overlay
                        .position()
                        .global()
                        .bottom()
                        .centerHorizontally();
                }
                break;
            case 'bottom-left':
                if (toastIndex !== -1) {
                    positionStrategy = this._overlay
                        .position()
                        .flexibleConnectedTo(this._toasts[toastIndex].componentInstance._el.nativeElement.children[0])
                        .withPositions([
                        {
                            overlayX: 'start',
                            overlayY: 'bottom',
                            originX: 'start',
                            originY: 'top'
                        }
                    ]);
                }
                else {
                    positionStrategy = this._overlay
                        .position()
                        .global()
                        .bottom()
                        .left('10px');
                }
                break;
            case 'bottom-full-width':
                if (toastIndex !== -1) {
                    positionStrategy = this._overlay
                        .position()
                        .flexibleConnectedTo(this._toasts[toastIndex].componentInstance._el.nativeElement.children[0])
                        .withFlexibleDimensions(false)
                        .withPositions([
                        {
                            overlayX: 'center',
                            overlayY: 'bottom',
                            originX: 'center',
                            originY: 'top'
                        }
                    ]);
                }
                else {
                    positionStrategy = this._overlay
                        .position()
                        .global()
                        .bottom()
                        .centerHorizontally();
                }
                break;
            default:
                throw Error('Unsupported toaster message position: ' + position);
        }
        return positionStrategy;
    };
    // Removes the toast that was closed from the storage array
    // Removes the toast that was closed from the storage array
    /**
     * @private
     * @param {?} toastRef
     * @return {?}
     */
    HcToasterService.prototype._removeToastPointer = 
    // Removes the toast that was closed from the storage array
    /**
     * @private
     * @param {?} toastRef
     * @return {?}
     */
    function (toastRef) {
        for (var index = 0; index < this._toasts.length; index++) {
            if (this._toasts[index] === toastRef) {
                this._toasts.splice(index, 1);
            }
        }
    };
    // Returns one toast back from the index provided in the position provided
    // Returns one toast back from the index provided in the position provided
    /**
     * @private
     * @param {?} toastPos
     * @param {?} startIndex
     * @return {?}
     */
    HcToasterService.prototype._getLastToast = 
    // Returns one toast back from the index provided in the position provided
    /**
     * @private
     * @param {?} toastPos
     * @param {?} startIndex
     * @return {?}
     */
    function (toastPos, startIndex) {
        /** @type {?} */
        var toastIndex = -1;
        for (var index = startIndex - 1; index >= 0; index--) {
            if (this._toasts[index]._toastPosition === toastPos) {
                toastIndex = index;
                break;
            }
        }
        return toastIndex;
    };
    // Updates the position strategy for what toasts are connected after one is closed
    // Updates the position strategy for what toasts are connected after one is closed
    /**
     * @private
     * @return {?}
     */
    HcToasterService.prototype._updateToastPositions = 
    // Updates the position strategy for what toasts are connected after one is closed
    /**
     * @private
     * @return {?}
     */
    function () {
        for (var index = 0; index < this._toasts.length; index++) {
            this._toasts[index]._overlayRef.updatePositionStrategy(this._getPositionStrategy(this._toasts[index]._toastPosition, index));
        }
    };
    HcToasterService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    HcToasterService.ctorParameters = function () { return [
        { type: Injector },
        { type: Overlay }
    ]; };
    return HcToasterService;
}());
export { HcToasterService };
if (false) {
    /** @type {?} */
    HcToasterService.prototype._toasts;
    /**
     * @type {?}
     * @private
     */
    HcToasterService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    HcToasterService.prototype._overlay;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGMtdG9hc3Rlci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGhlYWx0aGNhdGFseXN0L2Nhc2htZXJlLyIsInNvdXJjZXMiOlsibGliL3RvYXN0ZXIvaGMtdG9hc3Rlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLE9BQU8sRUFBQyxVQUFVLEVBQWdCLFFBQVEsRUFBRSxXQUFXLEVBQXlCLE1BQU0sZUFBZSxDQUFDO0FBQ3RHLE9BQU8sRUFBQyxPQUFPLEVBQUUsYUFBYSxFQUErQixNQUFNLHNCQUFzQixDQUFDO0FBQzFGLE9BQU8sRUFBQyxlQUFlLEVBQUUsY0FBYyxFQUFFLGNBQWMsRUFBQyxNQUFNLHFCQUFxQixDQUFDO0FBQ3BGLE9BQU8sRUFBQyxnQkFBZ0IsRUFBQyxNQUFNLHNCQUFzQixDQUFDO0FBRXRELE9BQU8sRUFBQyxVQUFVLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUMxQyxPQUFPLEVBQUMsTUFBTSxFQUFFLElBQUksRUFBWSxNQUFNLGdCQUFnQixDQUFDOzs7OztBQVF2RDtJQUlJLHlCQUF5QjtJQUN6QiwwQkFBb0IsUUFBa0IsRUFBVSxRQUFpQjtRQUE3QyxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBUztRQUhqRSxZQUFPLEdBQWlCLEVBQUUsQ0FBQztJQUd5QyxDQUFDO0lBRXJFOzs7c0hBR2tIOzs7Ozs7Ozs7Ozs7SUFDbEgsbUNBQVE7Ozs7Ozs7Ozs7O0lBQVIsVUFBa0IsWUFBNkIsRUFBRSxZQUFrQyxFQUFFLGNBQWtDO1FBQXZILGlCQTZHQzs7WUE1R1MsY0FBYyxHQUFtQjtZQUNuQyxJQUFJLEVBQUUsU0FBUztZQUNmLFFBQVEsRUFBRSxjQUFjO1lBQ3hCLE9BQU8sRUFBRSxJQUFJO1lBQ2IsWUFBWSxFQUFFLEtBQUs7U0FDdEI7O1lBQ0ssT0FBTyx3QkFBTyxjQUFjLEVBQUssWUFBWSxDQUFDOzs7WUFHOUMsV0FBVyxHQUFHLElBQUksQ0FBQyxj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QztJQUVELGtGQUFrRjs7Ozs7O0lBQzFFLGdEQUFxQjs7Ozs7O0lBQTdCO1FBQ0ksS0FBSyxJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUUsS0FBSyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxFQUFFO1lBQ3RELElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsV0FBVyxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLGNBQWMsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO1NBQ2hJO0lBQ0wsQ0FBQzs7Z0JBL1hKLFVBQVU7Ozs7Z0JBZHVCLFFBQVE7Z0JBQ2xDLE9BQU87O0lBNllmLHVCQUFDO0NBQUEsQUFoWUQsSUFnWUM7U0EvWFksZ0JBQWdCOzs7SUFDekIsbUNBQTJCOzs7OztJQUdmLG9DQUEwQjs7Ozs7SUFBRSxvQ0FBeUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0luamVjdGFibGUsIENvbXBvbmVudFJlZiwgSW5qZWN0b3IsIFRlbXBsYXRlUmVmLCBUeXBlLCBDb21wb25lbnRGYWN0b3J5fSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7T3ZlcmxheSwgT3ZlcmxheUNvbmZpZywgT3ZlcmxheVJlZiwgUG9zaXRpb25TdHJhdGVneX0gZnJvbSAnQGFuZ3VsYXIvY2RrL292ZXJsYXknO1xuaW1wb3J0IHtDb21wb25lbnRQb3J0YWwsIFBvcnRhbEluamVjdG9yLCBUZW1wbGF0ZVBvcnRhbH0gZnJvbSAnQGFuZ3VsYXIvY2RrL3BvcnRhbCc7XG5pbXBvcnQge0hjVG9hc3RDb21wb25lbnR9IGZyb20gJy4vaGMtdG9hc3QuY29tcG9uZW50JztcbmltcG9ydCB7SGNUb2FzdE9wdGlvbnN9IGZyb20gJy4vaGMtdG9hc3Qtb3B0aW9ucyc7XG5pbXBvcnQge0hjVG9hc3RSZWZ9IGZyb20gJy4vaGMtdG9hc3QtcmVmJztcbmltcG9ydCB7ZmlsdGVyLCB0YWtlLCB0YWtlVW50aWx9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7U3ViamVjdCwgT2JzZXJ2YWJsZX0gZnJvbSAncnhqcyc7XG5cbmV4cG9ydCB0eXBlIENvbXBvbmVudFNldHVwPFQ+ID0gUGFydGlhbDxUPiB8ICgoaW5zdGFuY2U6IFQpID0+IHZvaWQpO1xuZXhwb3J0IHR5cGUgVG9hc3RDb250ZW50VHlwZTxUPiA9IFR5cGU8VD4gfCBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4vKiogVG9hc3RzIHByb3ZpZGUgdXNlcnMgd2l0aCBpbnN0YW50IGZlZWRiYWNrIG9uIGFjdGlvbnMgdGhleSd2ZSB0YWtlbi4gRm9yIG1vcmUgZ2VuZXJhbCBpbmZvcm1hdGlvbixcbiAqIHVzZSBhIGBoYy1iYW5uZXJgLiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEhjVG9hc3RlclNlcnZpY2Uge1xuICAgIF90b2FzdHM6IEhjVG9hc3RSZWZbXSA9IFtdO1xuXG4gICAgLy8gSW5qZWN0IG92ZXJsYXkgc2VydmljZVxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLCBwcml2YXRlIF9vdmVybGF5OiBPdmVybGF5KSB7fVxuXG4gICAgLyoqIERpc3BsYXlzIGEgbmV3IHRvYXN0ZXIgbWVzc2FnZSB3aXRoIHRoZSBzZXR0aW5ncyBpbmNsdWRlZCBpbiBgdG9hc3RPcHRpb25zYC4gYHRvYXN0Q29udGVudGAgY2FuIGJlIHVzZWQgdG9cbiAgICAgKiBjcmVhdGUgZW50aXJlbHkgY3VzdG9tIHRvYXN0cywgYnV0IG9ubHkgaWYgdGhlIHR5cGUgaW4gdG9hc3RPcHRpb25zIGlzIHNldCB0byBgY3VzdG9tYC4gQmUgc3VyZSB0byBzZXQgYGJvcmRlci1yYWRpdXM6IDVweGBcbiAgICAgKiBpbiB0aGUgc3R5bGUgb2YgeW91ciBjdXN0b20gY29udGVudCB0ZW1wbGF0ZSBzbyBpdCBtYXRjaGVzIHRoZSB0b2FzdCBjb250YWluZXIuIElmIHlvdXIgY3VzdG9tIHRvYXN0IGlzXG4gICAgICogdXNpbmcgYSBjb21wb25lbnQsIHRoZSBgY29tcG9uZW50U2V0dXBgIHBhcmFtZXRlciBhY2NlcHRzIGFuIG9iamVjdCBvciBmdW5jdGlvbiB0byBjb25maWd1cmUgdGhhdCBjb21wb25lbnQuICovXG4gICAgYWRkVG9hc3Q8VCA9IGFueT4odG9hc3RPcHRpb25zPzogSGNUb2FzdE9wdGlvbnMsIHRvYXN0Q29udGVudD86IFRvYXN0Q29udGVudFR5cGU8VD4sIGNvbXBvbmVudFNldHVwPzogQ29tcG9uZW50U2V0dXA8VD4pOiBIY1RvYXN0UmVmIHtcbiAgICAgICAgY29uc3QgZGVmYXVsdE9wdGlvbnM6IEhjVG9hc3RPcHRpb25zID0ge1xuICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLFxuICAgICAgICAgICAgcG9zaXRpb246ICdib3R0b20tcmlnaHQnLFxuICAgICAgICAgICAgdGltZW91dDogNTAwMCxcbiAgICAgICAgICAgIGNsaWNrRGlzbWlzczogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHsuLi5kZWZhdWx0T3B0aW9ucywgLi4udG9hc3RPcHRpb25zfTtcblxuICAgICAgICAvLyBSZXR1cm5zIGFuIE92ZXJsYXlSZWYgKHdoaWNoIGlzIGEgUG9ydGFsSG9zdClcbiAgICAgICAgY29uc3QgX292ZXJsYXlSZWYgPSB0aGlzLl9jcmVhdGVPdmVybGF5KG9wdGlvbnMpO1xuXG4gICAgICAgIC8vIEluc3RhbnRpYXRlIHJlbW90ZSBjb250cm9sXG4gICAgICAgIGNvbnN0IF90b2FzdFJlZiA9IG5ldyBIY1RvYXN0UmVmKF9vdmVybGF5UmVmKTtcblxuICAgICAgICBjb25zdCBvdmVybGF5Q29tcG9uZW50ID0gdGhpcy5fYXR0YWNoVG9hc3RDb250YWluZXIoX292ZXJsYXlSZWYsIF90b2FzdFJlZik7XG5cbiAgICAgICAgX3RvYXN0UmVmLmNvbXBvbmVudEluc3RhbmNlID0gb3ZlcmxheUNvbXBvbmVudDtcblxuICAgICAgICBpZiAob3B0aW9ucy50eXBlID09PSAnY3VzdG9tJyAmJiB0b2FzdENvbnRlbnQpIHtcbiAgICAgICAgICAgIGlmICh0b2FzdENvbnRlbnQgaW5zdGFuY2VvZiBUZW1wbGF0ZVJlZikge1xuICAgICAgICAgICAgICAgIF90b2FzdFJlZi5jb21wb25lbnRJbnN0YW5jZS5fdG9hc3RQb3J0YWwgPSBuZXcgVGVtcGxhdGVQb3J0YWwodG9hc3RDb250ZW50LCBfdG9hc3RSZWYuY29tcG9uZW50SW5zdGFuY2UuX3ZpZXdDb250YWluZXJSZWYpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBfdG9hc3RSZWYuY29tcG9uZW50SW5zdGFuY2UuX3RvYXN0UG9ydGFsID0gbmV3IENvbXBvbmVudFBvcnRhbCh0b2FzdENvbnRlbnQpO1xuICAgICAgICAgICAgICAgIGlmIChjb21wb25lbnRTZXR1cCkge1xuICAgICAgICAgICAgICAgICAgICBfdG9hc3RSZWYuY29tcG9uZW50SW5zdGFuY2UuX2NvbXBvbmVudEluc3RhbmNlLnBpcGUoZmlsdGVyKGMgPT4gISFjKSkuc3Vic2NyaWJlKGMgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudFNldHVwIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wb25lbnRTZXR1cChjKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoY29tcG9uZW50U2V0dXApLmZvckVhY2goayA9PiAoY1trXSA9IGNvbXBvbmVudFNldHVwW2tdKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIExpc3RlbiBmb3IgY2xpY2sgZXZlbnRzIHRvIGNsb3NlIHRoZSB0b2FzdCBpZiB0aGUgb3B0aW9uIGlzIHNldFxuICAgICAgICBpZiAob3B0aW9ucy5jbGlja0Rpc21pc3MpIHtcbiAgICAgICAgICAgIF90b2FzdFJlZi5jb21wb25lbnRJbnN0YW5jZS5fY2FuRGlzbWlzcyA9IG9wdGlvbnMuY2xpY2tEaXNtaXNzO1xuICAgICAgICAgICAgX3RvYXN0UmVmLmNvbXBvbmVudEluc3RhbmNlLl9jbG9zZUNsaWNrLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgX3RvYXN0UmVmLmNsb3NlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNldCB0aGUgY2xhc3MgZm9yIHRoZSB0eXBlIHNldCBpbiBvcHRpb25zXG4gICAgICAgIGlmIChvcHRpb25zLnR5cGUpIHtcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICBvcHRpb25zLnR5cGUgPT09ICdzdWNjZXNzJyB8fFxuICAgICAgICAgICAgICAgIG9wdGlvbnMudHlwZSA9PT0gJ2luZm8nIHx8XG4gICAgICAgICAgICAgICAgb3B0aW9ucy50eXBlID09PSAnd2FybmluZycgfHxcbiAgICAgICAgICAgICAgICBvcHRpb25zLnR5cGUgPT09ICdhbGVydCcgfHxcbiAgICAgICAgICAgICAgICBvcHRpb25zLnR5cGUgPT09ICdjdXN0b20nXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBfdG9hc3RSZWYuY29tcG9uZW50SW5zdGFuY2UuX3N0eWxlVHlwZSA9IG9wdGlvbnMudHlwZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1Vuc3VwcG9ydGVkIHRvYXN0ZXIgdHlwZTogJyArIG9wdGlvbnMudHlwZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTZXQgdGhlIGhlYWRlciB0ZXh0XG4gICAgICAgIGlmIChvcHRpb25zLmhlYWRlcikge1xuICAgICAgICAgICAgX3RvYXN0UmVmLmNvbXBvbmVudEluc3RhbmNlLl9oZWFkZXJUZXh0ID0gb3B0aW9ucy5oZWFkZXI7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTZXQgdGhlIHRvYXN0IHdpZHRoXG4gICAgICAgIGlmIChvcHRpb25zLndpZHRoIHx8IG9wdGlvbnMud2lkdGggPT09IDApIHtcbiAgICAgICAgICAgIF90b2FzdFJlZi5jb21wb25lbnRJbnN0YW5jZS5fd2lkdGggPSBvcHRpb25zLndpZHRoO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2V0IHRoZSBib2R5IHRleHRcbiAgICAgICAgaWYgKG9wdGlvbnMuYm9keSkge1xuICAgICAgICAgICAgX3RvYXN0UmVmLmNvbXBvbmVudEluc3RhbmNlLl9ib2R5VGV4dCA9IG9wdGlvbnMuYm9keTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFN0b3JlIHRoZSBwb3NpdGlvbmluZyBvZiB0aGUgdG9hc3RcbiAgICAgICAgX3RvYXN0UmVmLl90b2FzdFBvc2l0aW9uID0gU3RyaW5nKG9wdGlvbnMucG9zaXRpb24pO1xuXG4gICAgICAgIC8vIFNldCBwcm9ncmVzcyBiYXJcbiAgICAgICAgaWYgKG9wdGlvbnMuaGFzUHJvZ3Jlc3NCYXIpIHtcbiAgICAgICAgICAgIF90b2FzdFJlZi5jb21wb25lbnRJbnN0YW5jZS5faGFzUHJvZ3Jlc3NCYXIgPSBvcHRpb25zLmhhc1Byb2dyZXNzQmFyO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2V0IHRoZSB0aW1lb3V0IGludGVydmFsIHRvIGNsb3NlIHRoZSB0b2FzdCBpZiBub24temVyb1xuICAgICAgICBpZiAob3B0aW9ucy50aW1lb3V0ICE9PSAwKSB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoX3RvYXN0UmVmLmNvbXBvbmVudEluc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgICAgIF90b2FzdFJlZi5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIG9wdGlvbnMudGltZW91dCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDbGVhbnVwIGZ1bmN0aW9ucyBjYWxsZWQgd2hlbiB0aGUgdG9hc3QgY2xvc2UgYW5pbWF0aW9uIGlzIHRyaWdnZXJlZFxuICAgICAgICBfdG9hc3RSZWYuY29tcG9uZW50SW5zdGFuY2UuX2FuaW1hdGlvblN0YXRlQ2hhbmdlZFxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgZmlsdGVyKGV2ZW50ID0+IGV2ZW50LnBoYXNlTmFtZSA9PT0gJ2RvbmUnICYmIGV2ZW50LnRvU3RhdGUgPT09ICdsZWF2ZScpLFxuICAgICAgICAgICAgICAgIHRha2UoMSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZVRvYXN0UG9pbnRlcihfdG9hc3RSZWYpO1xuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnRvYXN0Q2xvc2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMudG9hc3RDbG9zZWQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlVG9hc3RQb3NpdGlvbnMoKTtcbiAgICAgICAgICAgICAgICBfdG9hc3RSZWYuY29tcG9uZW50SW5zdGFuY2UuX2Nsb3NlQ2xpY2sudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIF90b2FzdFJlZi5jb21wb25lbnRJbnN0YW5jZS5fY2hhbmdlUmVmLmRldGVjdENoYW5nZXMoKTtcbiAgICAgICAgdGhpcy5fdG9hc3RzLnB1c2goX3RvYXN0UmVmKTtcbiAgICAgICAgcmV0dXJuIF90b2FzdFJlZjtcbiAgICB9XG5cbiAgICAvKiogQ2xvc2VzIHRoZSBtb3N0IHJlY2VudCB0b2FzdCBkaXNwbGF5ZWQgKi9cbiAgICBjbG9zZUxhc3RUb2FzdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuX3RvYXN0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5fdG9hc3RzW3RoaXMuX3RvYXN0cy5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgIGlmIChlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIENsb3NlcyBjdXJyZW50bHkgdmlzaWJsZSB0b2FzdHMgKi9cbiAgICBjbG9zZUFsbFRvYXN0cygpIHtcbiAgICAgICAgbGV0IGxlbiA9IHRoaXMuX3RvYXN0cy5sZW5ndGg7XG4gICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBsZW47IGluZGV4KyspIHtcbiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLl90b2FzdHNbaW5kZXhdO1xuICAgICAgICAgICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmNsb3NlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIF9jcmVhdGVPdmVybGF5KGNvbmZpZzogSGNUb2FzdE9wdGlvbnMpIHtcbiAgICAgICAgY29uc3Qgb3ZlcmxheUNvbmZpZyA9IHRoaXMuX2dldE92ZXJsYXlDb25maWcoY29uZmlnKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX292ZXJsYXkuY3JlYXRlKG92ZXJsYXlDb25maWcpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2F0dGFjaFRvYXN0Q29udGFpbmVyKG92ZXJsYXlSZWY6IE92ZXJsYXlSZWYsIHRvYXN0UmVmOiBIY1RvYXN0UmVmKSB7XG4gICAgICAgIGNvbnN0IGluamVjdG9yID0gdGhpcy5fY3JlYXRlSW5qZWN0b3IodG9hc3RSZWYpO1xuXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lclBvcnRhbCA9IG5ldyBDb21wb25lbnRQb3J0YWwoSGNUb2FzdENvbXBvbmVudCwgbnVsbCwgaW5qZWN0b3IpO1xuICAgICAgICBjb25zdCBjb250YWluZXJSZWY6IENvbXBvbmVudFJlZjxIY1RvYXN0Q29tcG9uZW50PiA9IG92ZXJsYXlSZWYuYXR0YWNoKGNvbnRhaW5lclBvcnRhbCk7XG5cbiAgICAgICAgcmV0dXJuIGNvbnRhaW5lclJlZi5pbnN0YW5jZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9jcmVhdGVJbmplY3Rvcih0b2FzdFJlZjogSGNUb2FzdFJlZik6IFBvcnRhbEluamVjdG9yIHtcbiAgICAgICAgY29uc3QgaW5qZWN0aW9uVG9rZW5zID0gbmV3IFdlYWtNYXAoKTtcblxuICAgICAgICBpbmplY3Rpb25Ub2tlbnMuc2V0KEhjVG9hc3RSZWYsIHRvYXN0UmVmKTtcblxuICAgICAgICByZXR1cm4gbmV3IFBvcnRhbEluamVjdG9yKHRoaXMuaW5qZWN0b3IsIGluamVjdGlvblRva2Vucyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfZ2V0T3ZlcmxheUNvbmZpZyhjb25maWc6IEhjVG9hc3RPcHRpb25zKTogT3ZlcmxheUNvbmZpZyB7XG4gICAgICAgIGxldCBvdmVybGF5Q29uZmlnO1xuICAgICAgICBsZXQgcG9zaXRpb25TdHJhdGVneSA9IHRoaXMuX2dldFBvc2l0aW9uU3RyYXRlZ3koU3RyaW5nKGNvbmZpZy5wb3NpdGlvbiksIHRoaXMuX3RvYXN0cy5sZW5ndGgpO1xuXG4gICAgICAgIGlmIChjb25maWcucG9zaXRpb24gPT09ICd0b3AtZnVsbC13aWR0aCcgfHwgY29uZmlnLnBvc2l0aW9uID09PSAnYm90dG9tLWZ1bGwtd2lkdGgnKSB7XG4gICAgICAgICAgICBvdmVybGF5Q29uZmlnID0gbmV3IE92ZXJsYXlDb25maWcoe3Bvc2l0aW9uU3RyYXRlZ3ksIHdpZHRoOiAnOTYlJywgcGFuZWxDbGFzczogJ292ZXJsYXktcG9pbnRlci1ldmVudHMnfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvdmVybGF5Q29uZmlnID0gbmV3IE92ZXJsYXlDb25maWcoe3Bvc2l0aW9uU3RyYXRlZ3ksIHBhbmVsQ2xhc3M6ICdvdmVybGF5LXBvaW50ZXItZXZlbnRzJ30pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG92ZXJsYXlDb25maWc7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfZ2V0UG9zaXRpb25TdHJhdGVneShwb3NpdGlvbjogc3RyaW5nLCBpbmRleDogbnVtYmVyKTogUG9zaXRpb25TdHJhdGVneSB7XG4gICAgICAgIGxldCBwb3NpdGlvblN0cmF0ZWd5OiBQb3NpdGlvblN0cmF0ZWd5O1xuICAgICAgICBsZXQgdG9hc3RJbmRleDogbnVtYmVyID0gdGhpcy5fZ2V0TGFzdFRvYXN0KHBvc2l0aW9uLCBpbmRleCk7XG5cbiAgICAgICAgc3dpdGNoIChwb3NpdGlvbikge1xuICAgICAgICAgICAgY2FzZSAndG9wLXJpZ2h0JzpcbiAgICAgICAgICAgICAgICBpZiAodG9hc3RJbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25TdHJhdGVneSA9IHRoaXMuX292ZXJsYXlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5wb3NpdGlvbigpXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmxleGlibGVDb25uZWN0ZWRUbyh0aGlzLl90b2FzdHNbdG9hc3RJbmRleF0uY29tcG9uZW50SW5zdGFuY2UuX2VsLm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW5bMF0pXG4gICAgICAgICAgICAgICAgICAgICAgICAud2l0aFBvc2l0aW9ucyhbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVybGF5WDogJ2VuZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJsYXlZOiAndG9wJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luWDogJ2VuZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpblk6ICdib3R0b20nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25TdHJhdGVneSA9IHRoaXMuX292ZXJsYXlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5wb3NpdGlvbigpXG4gICAgICAgICAgICAgICAgICAgICAgICAuZ2xvYmFsKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yaWdodCgnMTBweCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3RvcC1jZW50ZXInOlxuICAgICAgICAgICAgICAgIGlmICh0b2FzdEluZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblN0cmF0ZWd5ID0gdGhpcy5fb3ZlcmxheVxuICAgICAgICAgICAgICAgICAgICAgICAgLnBvc2l0aW9uKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5mbGV4aWJsZUNvbm5lY3RlZFRvKHRoaXMuX3RvYXN0c1t0b2FzdEluZGV4XS5jb21wb25lbnRJbnN0YW5jZS5fZWwubmF0aXZlRWxlbWVudC5jaGlsZHJlblswXSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC53aXRoUG9zaXRpb25zKFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJsYXlYOiAnY2VudGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcmxheVk6ICd0b3AnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5YOiAnY2VudGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luWTogJ2JvdHRvbSdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblN0cmF0ZWd5ID0gdGhpcy5fb3ZlcmxheVxuICAgICAgICAgICAgICAgICAgICAgICAgLnBvc2l0aW9uKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5nbG9iYWwoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNlbnRlckhvcml6b250YWxseSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3RvcC1sZWZ0JzpcbiAgICAgICAgICAgICAgICBpZiAodG9hc3RJbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25TdHJhdGVneSA9IHRoaXMuX292ZXJsYXlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5wb3NpdGlvbigpXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmxleGlibGVDb25uZWN0ZWRUbyh0aGlzLl90b2FzdHNbdG9hc3RJbmRleF0uY29tcG9uZW50SW5zdGFuY2UuX2VsLm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW5bMF0pXG4gICAgICAgICAgICAgICAgICAgICAgICAud2l0aFBvc2l0aW9ucyhbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVybGF5WDogJ3N0YXJ0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcmxheVk6ICd0b3AnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5YOiAnc3RhcnQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5ZOiAnYm90dG9tJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uU3RyYXRlZ3kgPSB0aGlzLl9vdmVybGF5XG4gICAgICAgICAgICAgICAgICAgICAgICAucG9zaXRpb24oKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmdsb2JhbCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAubGVmdCgnMTBweCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3RvcC1mdWxsLXdpZHRoJzpcbiAgICAgICAgICAgICAgICBpZiAodG9hc3RJbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25TdHJhdGVneSA9IHRoaXMuX292ZXJsYXlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5wb3NpdGlvbigpXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmxleGlibGVDb25uZWN0ZWRUbyh0aGlzLl90b2FzdHNbdG9hc3RJbmRleF0uY29tcG9uZW50SW5zdGFuY2UuX2VsLm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW5bMF0pXG4gICAgICAgICAgICAgICAgICAgICAgICAud2l0aEZsZXhpYmxlRGltZW5zaW9ucyhmYWxzZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC53aXRoUG9zaXRpb25zKFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJsYXlYOiAnY2VudGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcmxheVk6ICd0b3AnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5YOiAnY2VudGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luWTogJ2JvdHRvbSdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblN0cmF0ZWd5ID0gdGhpcy5fb3ZlcmxheVxuICAgICAgICAgICAgICAgICAgICAgICAgLnBvc2l0aW9uKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5nbG9iYWwoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNlbnRlckhvcml6b250YWxseSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2JvdHRvbS1yaWdodCc6XG4gICAgICAgICAgICAgICAgaWYgKHRvYXN0SW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uU3RyYXRlZ3kgPSB0aGlzLl9vdmVybGF5XG4gICAgICAgICAgICAgICAgICAgICAgICAucG9zaXRpb24oKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZsZXhpYmxlQ29ubmVjdGVkVG8odGhpcy5fdG9hc3RzW3RvYXN0SW5kZXhdLmNvbXBvbmVudEluc3RhbmNlLl9lbC5uYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdKVxuICAgICAgICAgICAgICAgICAgICAgICAgLndpdGhQb3NpdGlvbnMoW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcmxheVg6ICdlbmQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVybGF5WTogJ2JvdHRvbScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpblg6ICdlbmQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5ZOiAndG9wJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uU3RyYXRlZ3kgPSB0aGlzLl9vdmVybGF5XG4gICAgICAgICAgICAgICAgICAgICAgICAucG9zaXRpb24oKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmdsb2JhbCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYm90dG9tKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yaWdodCgnMTBweCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2JvdHRvbS1jZW50ZXInOlxuICAgICAgICAgICAgICAgIGlmICh0b2FzdEluZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblN0cmF0ZWd5ID0gdGhpcy5fb3ZlcmxheVxuICAgICAgICAgICAgICAgICAgICAgICAgLnBvc2l0aW9uKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5mbGV4aWJsZUNvbm5lY3RlZFRvKHRoaXMuX3RvYXN0c1t0b2FzdEluZGV4XS5jb21wb25lbnRJbnN0YW5jZS5fZWwubmF0aXZlRWxlbWVudC5jaGlsZHJlblswXSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC53aXRoUG9zaXRpb25zKFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJsYXlYOiAnY2VudGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcmxheVk6ICdib3R0b20nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5YOiAnY2VudGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luWTogJ3RvcCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblN0cmF0ZWd5ID0gdGhpcy5fb3ZlcmxheVxuICAgICAgICAgICAgICAgICAgICAgICAgLnBvc2l0aW9uKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5nbG9iYWwoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmJvdHRvbSgpXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2VudGVySG9yaXpvbnRhbGx5KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnYm90dG9tLWxlZnQnOlxuICAgICAgICAgICAgICAgIGlmICh0b2FzdEluZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblN0cmF0ZWd5ID0gdGhpcy5fb3ZlcmxheVxuICAgICAgICAgICAgICAgICAgICAgICAgLnBvc2l0aW9uKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5mbGV4aWJsZUNvbm5lY3RlZFRvKHRoaXMuX3RvYXN0c1t0b2FzdEluZGV4XS5jb21wb25lbnRJbnN0YW5jZS5fZWwubmF0aXZlRWxlbWVudC5jaGlsZHJlblswXSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC53aXRoUG9zaXRpb25zKFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJsYXlYOiAnc3RhcnQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVybGF5WTogJ2JvdHRvbScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpblg6ICdzdGFydCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpblk6ICd0b3AnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25TdHJhdGVneSA9IHRoaXMuX292ZXJsYXlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5wb3NpdGlvbigpXG4gICAgICAgICAgICAgICAgICAgICAgICAuZ2xvYmFsKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5ib3R0b20oKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmxlZnQoJzEwcHgnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdib3R0b20tZnVsbC13aWR0aCc6XG4gICAgICAgICAgICAgICAgaWYgKHRvYXN0SW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uU3RyYXRlZ3kgPSB0aGlzLl9vdmVybGF5XG4gICAgICAgICAgICAgICAgICAgICAgICAucG9zaXRpb24oKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZsZXhpYmxlQ29ubmVjdGVkVG8odGhpcy5fdG9hc3RzW3RvYXN0SW5kZXhdLmNvbXBvbmVudEluc3RhbmNlLl9lbC5uYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdKVxuICAgICAgICAgICAgICAgICAgICAgICAgLndpdGhGbGV4aWJsZURpbWVuc2lvbnMoZmFsc2UpXG4gICAgICAgICAgICAgICAgICAgICAgICAud2l0aFBvc2l0aW9ucyhbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVybGF5WDogJ2NlbnRlcicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJsYXlZOiAnYm90dG9tJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luWDogJ2NlbnRlcicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpblk6ICd0b3AnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25TdHJhdGVneSA9IHRoaXMuX292ZXJsYXlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5wb3NpdGlvbigpXG4gICAgICAgICAgICAgICAgICAgICAgICAuZ2xvYmFsKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5ib3R0b20oKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNlbnRlckhvcml6b250YWxseSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1Vuc3VwcG9ydGVkIHRvYXN0ZXIgbWVzc2FnZSBwb3NpdGlvbjogJyArIHBvc2l0aW9uKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBwb3NpdGlvblN0cmF0ZWd5O1xuICAgIH1cblxuICAgIC8vIFJlbW92ZXMgdGhlIHRvYXN0IHRoYXQgd2FzIGNsb3NlZCBmcm9tIHRoZSBzdG9yYWdlIGFycmF5XG4gICAgcHJpdmF0ZSBfcmVtb3ZlVG9hc3RQb2ludGVyKHRvYXN0UmVmOiBIY1RvYXN0UmVmKSB7XG4gICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLl90b2FzdHMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fdG9hc3RzW2luZGV4XSA9PT0gdG9hc3RSZWYpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90b2FzdHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIFJldHVybnMgb25lIHRvYXN0IGJhY2sgZnJvbSB0aGUgaW5kZXggcHJvdmlkZWQgaW4gdGhlIHBvc2l0aW9uIHByb3ZpZGVkXG4gICAgcHJpdmF0ZSBfZ2V0TGFzdFRvYXN0KHRvYXN0UG9zOiBzdHJpbmcsIHN0YXJ0SW5kZXg6IG51bWJlcik6IG51bWJlciB7XG4gICAgICAgIGxldCB0b2FzdEluZGV4OiBudW1iZXIgPSAtMTtcblxuICAgICAgICBmb3IgKGxldCBpbmRleCA9IHN0YXJ0SW5kZXggLSAxOyBpbmRleCA+PSAwOyBpbmRleC0tKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fdG9hc3RzW2luZGV4XS5fdG9hc3RQb3NpdGlvbiA9PT0gdG9hc3RQb3MpIHtcbiAgICAgICAgICAgICAgICB0b2FzdEluZGV4ID0gaW5kZXg7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvYXN0SW5kZXg7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlcyB0aGUgcG9zaXRpb24gc3RyYXRlZ3kgZm9yIHdoYXQgdG9hc3RzIGFyZSBjb25uZWN0ZWQgYWZ0ZXIgb25lIGlzIGNsb3NlZFxuICAgIHByaXZhdGUgX3VwZGF0ZVRvYXN0UG9zaXRpb25zKCkge1xuICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5fdG9hc3RzLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgICAgdGhpcy5fdG9hc3RzW2luZGV4XS5fb3ZlcmxheVJlZi51cGRhdGVQb3NpdGlvblN0cmF0ZWd5KHRoaXMuX2dldFBvc2l0aW9uU3RyYXRlZ3kodGhpcy5fdG9hc3RzW2luZGV4XS5fdG9hc3RQb3NpdGlvbiwgaW5kZXgpKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==