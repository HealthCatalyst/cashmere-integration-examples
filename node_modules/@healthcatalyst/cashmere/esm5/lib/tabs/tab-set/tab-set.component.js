/**
 * @fileoverview added by tsickle
 * Generated from: lib/tabs/tab-set/tab-set.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ContentChildren, Input, QueryList, Output, ViewEncapsulation } from '@angular/core';
import { EventEmitter } from '@angular/core';
import { TabComponent } from '../tab/tab.component';
import { ActivatedRoute, Router } from '@angular/router';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { parseBooleanAttribute } from '../../util';
var TabChangeEvent = /** @class */ (function () {
    function TabChangeEvent(index, tab) {
        this.index = index;
        this.tab = tab;
    }
    return TabChangeEvent;
}());
export { TabChangeEvent };
if (false) {
    /** @type {?} */
    TabChangeEvent.prototype.index;
    /** @type {?} */
    TabChangeEvent.prototype.tab;
}
/**
 * @param {?} tabsWithoutRouterLink
 * @return {?}
 */
export function throwErrorForMissingRouterLink(tabsWithoutRouterLink) {
    /** @type {?} */
    var tabTitles = tabsWithoutRouterLink.map((/**
     * @param {?} tab
     * @return {?}
     */
    function (tab) { return tab.tabTitle; }));
    throw Error("Routerlink missing on " + tabTitles.join(','));
}
/** @type {?} */
var supportedDirections = ['horizontal', 'vertical'];
/**
 * @param {?} inputStr
 * @return {?}
 */
export function validateDirectionInput(inputStr) {
    if (supportedDirections.indexOf(inputStr) < 0) {
        throw Error('Unsupported tab direction value: ' + inputStr);
    }
}
/**
 * @return {?}
 */
export function tabComponentMissing() {
    return new Error("TabSet must contain at least one TabComponent. Make sure to add a hc-tab to the hc-tab-set element.");
}
/**
 * @param {?} tabVal
 * @return {?}
 */
export function invalidDefaultTab(tabVal) {
    throw Error('Invalid default tab value: ' + tabVal + ". Must be 'none' or a value less than the total number of tabs in the set.");
}
var TabSetComponent = /** @class */ (function () {
    function TabSetComponent(router, route) {
        this.router = router;
        this.route = route;
        this._routerEnabled = false;
        this._direction = 'vertical';
        this._defaultTab = 0;
        this._stopTabSubscriptionSubject = new Subject();
        /**
         * Emits when the selected tab is changed
         */
        this.selectedTabChange = new EventEmitter();
        this._addContentContainer = true;
        this._tight = false;
    }
    Object.defineProperty(TabSetComponent.prototype, "direction", {
        /** Specify direction of tabs as either `horizontal` or `vertical`. Defaults to `vertical` */
        get: /**
         * Specify direction of tabs as either `horizontal` or `vertical`. Defaults to `vertical`
         * @return {?}
         */
        function () {
            return this._direction;
        },
        set: /**
         * @param {?} directionType
         * @return {?}
         */
        function (directionType) {
            validateDirectionInput(directionType);
            this._direction = directionType;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TabSetComponent.prototype, "defaultTab", {
        /** Zero-based numerical value specifying which tab to select by default, setting to `none` means no tab
         * will be immediately selected. Defaults to 0 (the first tab). */
        get: /**
         * Zero-based numerical value specifying which tab to select by default, setting to `none` means no tab
         * will be immediately selected. Defaults to 0 (the first tab).
         * @return {?}
         */
        function () {
            return this._defaultTab;
        },
        set: /**
         * @param {?} tabValue
         * @return {?}
         */
        function (tabValue) {
            if (!isNaN(+tabValue) || tabValue === 'none') {
                this._defaultTab = tabValue;
            }
            else {
                invalidDefaultTab(tabValue);
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TabSetComponent.prototype, "addContentContainer", {
        /** Determines whether the tab set will create a router-outlet or ng-container for the tab content.
         * If set to false, the app will need to add its own container.  Defaults to `true`. */
        get: /**
         * Determines whether the tab set will create a router-outlet or ng-container for the tab content.
         * If set to false, the app will need to add its own container.  Defaults to `true`.
         * @return {?}
         */
        function () {
            return this._addContentContainer;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._addContentContainer = parseBooleanAttribute(value);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TabSetComponent.prototype, "tight", {
        /** If true, condense the default padding on all included tabs. *Defaults to `false`.*  */
        get: /**
         * If true, condense the default padding on all included tabs. *Defaults to `false`.*
         * @return {?}
         */
        function () {
            return this._tight;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._tight = parseBooleanAttribute(value);
            this.setTabDirection();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    TabSetComponent.prototype.ngAfterContentInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.setUpTabs();
        this._tabs.changes.subscribe((/**
         * @return {?}
         */
        function () { return _this.setUpTabs(); }));
    };
    /**
     * @private
     * @return {?}
     */
    TabSetComponent.prototype.setUpTabs = /**
     * @private
     * @return {?}
     */
    function () {
        if (this._tabs.length === 0) {
            throw tabComponentMissing();
        }
        if (this.defaultTab !== 'none') {
            this.defaultToFirstTab();
        }
        this.checkForRouterUse();
        this.setTabDirection();
        this.subscribeToTabClicks();
    };
    /**
     * @private
     * @return {?}
     */
    TabSetComponent.prototype.setTabDirection = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        setTimeout((/**
         * @return {?}
         */
        function () {
            return _this._tabs.forEach((/**
             * @param {?} t
             * @return {?}
             */
            function (t) {
                t._direction = _this.direction;
                t._tight = _this.tight;
            }));
        }));
    };
    /**
     * @private
     * @return {?}
     */
    TabSetComponent.prototype.subscribeToTabClicks = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this._stopTabSubscriptionSubject.next();
        this._tabs.forEach((/**
         * @param {?} t
         * @return {?}
         */
        function (t) { return t.tabClick.pipe(takeUntil(_this._stopTabSubscriptionSubject)).subscribe((/**
         * @return {?}
         */
        function () { return _this._setActive(t); })); }));
    };
    /** Sets the currently selected tab by either its numerical index or `TabComponent` object  */
    /**
     * Sets the currently selected tab by either its numerical index or `TabComponent` object
     * @param {?} tab
     * @return {?}
     */
    TabSetComponent.prototype.selectTab = /**
     * Sets the currently selected tab by either its numerical index or `TabComponent` object
     * @param {?} tab
     * @return {?}
     */
    function (tab) {
        /** @type {?} */
        var activeTab = typeof tab === 'number' ? this._tabs.toArray()[tab] : tab;
        this._setActive(activeTab);
    };
    /**
     * @param {?} tab
     * @return {?}
     */
    TabSetComponent.prototype._setActive = /**
     * @param {?} tab
     * @return {?}
     */
    function (tab) {
        /** @type {?} */
        var activeIndex = 0;
        this._tabs.toArray().forEach((/**
         * @param {?} t
         * @param {?} index
         * @return {?}
         */
        function (t, index) {
            t._active = false;
            if (t === tab) {
                activeIndex = index;
            }
        }));
        tab._active = true;
        this.tabContent = tab.tabContent;
        this.selectedTabChange.emit(new TabChangeEvent(activeIndex, tab));
    };
    /**
     * @private
     * @return {?}
     */
    TabSetComponent.prototype.defaultToFirstTab = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this._tabs.find((/**
         * @param {?} tab
         * @return {?}
         */
        function (tab) { return tab._active; }))) {
            // setTimeout to avoid change after checked error
            // when ngFor is used as projected nodes are registered
            // and stored as part of the existing view, not
            // the view in which they are projected
            // embedded views are checked *before* AfterContentInit
            // is triggered
            /** @type {?} */
            var tabArray_1 = this._tabs.toArray();
            if (tabArray_1[Number(this.defaultTab)]) {
                setTimeout((/**
                 * @return {?}
                 */
                function () { return _this._setActive(tabArray_1[Number(_this.defaultTab)]); }));
            }
            else {
                invalidDefaultTab(this.defaultTab);
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    TabSetComponent.prototype.checkForRouterUse = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var countUsingRouter = this._tabs.filter((/**
         * @param {?} tab
         * @return {?}
         */
        function (tab) { return tab.routerLink !== undefined; })).length;
        if (countUsingRouter > 0 && countUsingRouter < this._tabs.length) {
            /** @type {?} */
            var tabsMissingRouterLink = this._tabs.filter((/**
             * @param {?} tab
             * @return {?}
             */
            function (tab) { return tab.routerLink === undefined; }));
            throwErrorForMissingRouterLink(tabsMissingRouterLink);
        }
        if (countUsingRouter === this._tabs.length) {
            this._routerEnabled = true;
            if (this._defaultTab !== 'none') {
                this.defaultToFirstRoute();
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    TabSetComponent.prototype.defaultToFirstRoute = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var foundRoute = this._tabs
            .map((/**
         * @param {?} tab
         * @return {?}
         */
        function (tab) { return tab.routerLink; }))
            .map((/**
         * @param {?} routerLink
         * @return {?}
         */
        function (routerLink) { return _this.mapRouterLinkToString(routerLink); }))
            .find((/**
         * @param {?} routerLink
         * @return {?}
         */
        function (routerLink) {
            /** @type {?} */
            var currentRoute = _this.router.url;
            return currentRoute === routerLink || currentRoute.indexOf(routerLink + "/") > -1;
        }));
        if (foundRoute) {
            return;
        }
        /** @type {?} */
        var tabArray = this._tabs.toArray();
        if (tabArray[Number(this.defaultTab)]) {
            /** @type {?} */
            var firstRoute = this.mapRouterLinkToString(tabArray[Number(this.defaultTab)].routerLink);
            this.router.navigate([firstRoute], { relativeTo: this.route });
        }
    };
    /**
     * @private
     * @param {?} routerLink
     * @return {?}
     */
    TabSetComponent.prototype.mapRouterLinkToString = /**
     * @private
     * @param {?} routerLink
     * @return {?}
     */
    function (routerLink) {
        if (routerLink instanceof Array) {
            routerLink = routerLink.join('/').replace('//', '/');
        }
        return routerLink;
    };
    TabSetComponent.decorators = [
        { type: Component, args: [{
                    selector: "hc-tab-set",
                    template: "<div class=\"hc-{{direction}}-tab-container\">\n    <div class=\"hc-tab-bar-{{direction}}\">\n        <ng-content select=\"hc-tab\"></ng-content>\n        <ng-content></ng-content>\n    </div>\n    <div *ngIf=\"_addContentContainer\" class=\"hc-tab-content-{{direction}}\">\n        <router-outlet *ngIf=\"_routerEnabled\"></router-outlet>\n        <ng-container *ngIf=\"!_routerEnabled\" [ngTemplateOutlet]=\"tabContent\"></ng-container>\n    </div>\n</div>\n",
                    encapsulation: ViewEncapsulation.None,
                    styles: [".hc-horizontal-tab-container{height:auto;width:100%}.hc-tab-bar-horizontal{-webkit-box-align:baseline;align-items:baseline;background-color:inherit;border-bottom:1px solid #c0c5cc;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.hc-tab-content-horizontal{background-color:inherit;height:100%;overflow:auto;width:100%}.hc-vertical-tab-container{display:-webkit-box;display:flex;height:100%;width:100%}.hc-tab-bar-vertical{background-color:#fff;padding:15px 0;width:20%}.hc-tab-content-vertical{background-color:#f0f3f6;width:80%}"]
                }] }
    ];
    /** @nocollapse */
    TabSetComponent.ctorParameters = function () { return [
        { type: Router },
        { type: ActivatedRoute }
    ]; };
    TabSetComponent.propDecorators = {
        _tabs: [{ type: ContentChildren, args: [TabComponent,] }],
        selectedTabChange: [{ type: Output }],
        direction: [{ type: Input }],
        defaultTab: [{ type: Input }],
        addContentContainer: [{ type: Input }],
        tight: [{ type: Input }]
    };
    return TabSetComponent;
}());
export { TabSetComponent };
if (false) {
    /** @type {?} */
    TabSetComponent.prototype._routerEnabled;
    /**
     * @type {?}
     * @private
     */
    TabSetComponent.prototype._direction;
    /**
     * @type {?}
     * @private
     */
    TabSetComponent.prototype._defaultTab;
    /**
     * @type {?}
     * @private
     */
    TabSetComponent.prototype._stopTabSubscriptionSubject;
    /**
     * The content to be displayed for the currently selected tab.
     * This is read from the tab when it is selected.
     * Not used when this component uses routing.
     * @type {?}
     */
    TabSetComponent.prototype.tabContent;
    /** @type {?} */
    TabSetComponent.prototype._tabs;
    /**
     * Emits when the selected tab is changed
     * @type {?}
     */
    TabSetComponent.prototype.selectedTabChange;
    /** @type {?} */
    TabSetComponent.prototype._addContentContainer;
    /**
     * @type {?}
     * @private
     */
    TabSetComponent.prototype._tight;
    /**
     * @type {?}
     * @private
     */
    TabSetComponent.prototype.router;
    /**
     * @type {?}
     * @private
     */
    TabSetComponent.prototype.route;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFiLXNldC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AaGVhbHRoY2F0YWx5c3QvY2FzaG1lcmUvIiwic291cmNlcyI6WyJsaWIvdGFicy90YWItc2V0L3RhYi1zZXQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFtQixTQUFTLEVBQUUsZUFBZSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLGlCQUFpQixFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQ3hILE9BQU8sRUFBQyxZQUFZLEVBQWMsTUFBTSxlQUFlLENBQUM7QUFDeEQsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFBQyxjQUFjLEVBQUUsTUFBTSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFDdkQsT0FBTyxFQUFDLE9BQU8sRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUM3QixPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDekMsT0FBTyxFQUFDLHFCQUFxQixFQUFDLE1BQU0sWUFBWSxDQUFDO0FBRWpEO0lBQ0ksd0JBQW1CLEtBQWEsRUFBUyxHQUFpQjtRQUF2QyxVQUFLLEdBQUwsS0FBSyxDQUFRO1FBQVMsUUFBRyxHQUFILEdBQUcsQ0FBYztJQUFHLENBQUM7SUFDbEUscUJBQUM7QUFBRCxDQUFDLEFBRkQsSUFFQzs7OztJQURlLCtCQUFvQjs7SUFBRSw2QkFBd0I7Ozs7OztBQUc5RCxNQUFNLFVBQVUsOEJBQThCLENBQUMscUJBQXFDOztRQUMxRSxTQUFTLEdBQUcscUJBQXFCLENBQUMsR0FBRzs7OztJQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsR0FBRyxDQUFDLFFBQVEsRUFBWixDQUFZLEVBQUM7SUFDaEUsTUFBTSxLQUFLLENBQUMsMkJBQXlCLFNBQVMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFHLENBQUMsQ0FBQztBQUNoRSxDQUFDOztJQUVLLG1C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MExDO1NBcExZLGVBQWU7OztJQUN4Qix5Q0FBZ0M7Ozs7O0lBQ2hDLHFDQUF3Qzs7Ozs7SUFDeEMsc0NBQXlDOzs7OztJQUN6QyxzREFBa0U7Ozs7Ozs7SUFNbEUscUNBQTZCOztJQUU3QixnQ0FDK0I7Ozs7O0lBRy9CLDRDQUNxRTs7SUF1Q3JFLCtDQUFxQzs7Ozs7SUFXckMsaUNBQXVCOzs7OztJQUVYLGlDQUFzQjs7Ozs7SUFBRSxnQ0FBNkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0FmdGVyQ29udGVudEluaXQsIENvbXBvbmVudCwgQ29udGVudENoaWxkcmVuLCBJbnB1dCwgUXVlcnlMaXN0LCBPdXRwdXQsIFZpZXdFbmNhcHN1bGF0aW9ufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7RXZlbnRFbWl0dGVyLCBUZW1wbGF0ZVJlZn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1RhYkNvbXBvbmVudH0gZnJvbSAnLi4vdGFiL3RhYi5jb21wb25lbnQnO1xuaW1wb3J0IHtBY3RpdmF0ZWRSb3V0ZSwgUm91dGVyfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHtTdWJqZWN0fSBmcm9tICdyeGpzJztcbmltcG9ydCB7dGFrZVVudGlsfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQge3BhcnNlQm9vbGVhbkF0dHJpYnV0ZX0gZnJvbSAnLi4vLi4vdXRpbCc7XG5cbmV4cG9ydCBjbGFzcyBUYWJDaGFuZ2VFdmVudCB7XG4gICAgY29uc3RydWN0b3IocHVibGljIGluZGV4OiBudW1iZXIsIHB1YmxpYyB0YWI6IFRhYkNvbXBvbmVudCkge31cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRocm93RXJyb3JGb3JNaXNzaW5nUm91dGVyTGluayh0YWJzV2l0aG91dFJvdXRlckxpbms6IFRhYkNvbXBvbmVudFtdKSB7XG4gICAgY29uc3QgdGFiVGl0bGVzID0gdGFic1dpdGhvdXRSb3V0ZXJMaW5rLm1hcCh0YWIgPT4gdGFiLnRhYlRpdGxlKTtcbiAgICB0aHJvdyBFcnJvcihgUm91dGVybGluayBtaXNzaW5nIG9uICR7dGFiVGl0bGVzLmpvaW4oJywnKX1gKTtcbn1cblxuY29uc3Qgc3VwcG9ydGVkRGlyZWN0aW9ucyA9IFsnaG9yaXpvbnRhbCcsICd2ZXJ0aWNhbCddO1xuXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVEaXJlY3Rpb25JbnB1dChpbnB1dFN0cjogc3RyaW5nKSB7XG4gICAgaWYgKHN1cHBvcnRlZERpcmVjdGlvbnMuaW5kZXhPZihpbnB1dFN0cikgPCAwKSB7XG4gICAgICAgIHRocm93IEVycm9yKCdVbnN1cHBvcnRlZCB0YWIgZGlyZWN0aW9uIHZhbHVlOiAnICsgaW5wdXRTdHIpO1xuICAgIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRhYkNvbXBvbmVudE1pc3NpbmcoKTogRXJyb3Ige1xuICAgIHJldHVybiBuZXcgRXJyb3IoYFRhYlNldCBtdXN0IGNvbnRhaW4gYXQgbGVhc3Qgb25lIFRhYkNvbXBvbmVudC4gTWFrZSBzdXJlIHRvIGFkZCBhIGhjLXRhYiB0byB0aGUgaGMtdGFiLXNldCBlbGVtZW50LmApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaW52YWxpZERlZmF1bHRUYWIodGFiVmFsOiBzdHJpbmcgfCBudW1iZXIpIHtcbiAgICB0aHJvdyBFcnJvcignSW52YWxpZCBkZWZhdWx0IHRhYiB2YWx1ZTogJyArIHRhYlZhbCArIFwiLiBNdXN0IGJlICdub25lJyBvciBhIHZhbHVlIGxlc3MgdGhhbiB0aGUgdG90YWwgbnVtYmVyIG9mIHRhYnMgaW4gdGhlIHNldC5cIik7XG59XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiBgaGMtdGFiLXNldGAsXG4gICAgdGVtcGxhdGVVcmw6ICcuL3RhYi1zZXQuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL3RhYi1zZXQuY29tcG9uZW50LnNjc3MnXSxcbiAgICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXG59KVxuZXhwb3J0IGNsYXNzIFRhYlNldENvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyQ29udGVudEluaXQge1xuICAgIF9yb3V0ZXJFbmFibGVkOiBib29sZWFuID0gZmFsc2U7XG4gICAgcHJpdmF0ZSBfZGlyZWN0aW9uOiBzdHJpbmcgPSAndmVydGljYWwnO1xuICAgIHByaXZhdGUgX2RlZmF1bHRUYWI6IHN0cmluZyB8IG51bWJlciA9IDA7XG4gICAgcHJpdmF0ZSBfc3RvcFRhYlN1YnNjcmlwdGlvblN1YmplY3Q6IFN1YmplY3Q8YW55PiA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgICAvKiogVGhlIGNvbnRlbnQgdG8gYmUgZGlzcGxheWVkIGZvciB0aGUgY3VycmVudGx5IHNlbGVjdGVkIHRhYi5cbiAgICAgKiBUaGlzIGlzIHJlYWQgZnJvbSB0aGUgdGFiIHdoZW4gaXQgaXMgc2VsZWN0ZWQuXG4gICAgICogTm90IHVzZWQgd2hlbiB0aGlzIGNvbXBvbmVudCB1c2VzIHJvdXRpbmcuXG4gICAgICovXG4gICAgdGFiQ29udGVudDogVGVtcGxhdGVSZWY8YW55PjtcblxuICAgIEBDb250ZW50Q2hpbGRyZW4oVGFiQ29tcG9uZW50KVxuICAgIF90YWJzOiBRdWVyeUxpc3Q8VGFiQ29tcG9uZW50PjtcblxuICAgIC8qKiBFbWl0cyB3aGVuIHRoZSBzZWxlY3RlZCB0YWIgaXMgY2hhbmdlZCAqL1xuICAgIEBPdXRwdXQoKVxuICAgIHNlbGVjdGVkVGFiQ2hhbmdlOiBFdmVudEVtaXR0ZXI8VGFiQ2hhbmdlRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgLyoqIFNwZWNpZnkgZGlyZWN0aW9uIG9mIHRhYnMgYXMgZWl0aGVyIGBob3Jpem9udGFsYCBvciBgdmVydGljYWxgLiBEZWZhdWx0cyB0byBgdmVydGljYWxgICovXG4gICAgQElucHV0KClcbiAgICBnZXQgZGlyZWN0aW9uKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kaXJlY3Rpb247XG4gICAgfVxuXG4gICAgc2V0IGRpcmVjdGlvbihkaXJlY3Rpb25UeXBlOiBzdHJpbmcpIHtcbiAgICAgICAgdmFsaWRhdGVEaXJlY3Rpb25JbnB1dChkaXJlY3Rpb25UeXBlKTtcbiAgICAgICAgdGhpcy5fZGlyZWN0aW9uID0gZGlyZWN0aW9uVHlwZTtcbiAgICB9XG5cbiAgICAvKiogWmVyby1iYXNlZCBudW1lcmljYWwgdmFsdWUgc3BlY2lmeWluZyB3aGljaCB0YWIgdG8gc2VsZWN0IGJ5IGRlZmF1bHQsIHNldHRpbmcgdG8gYG5vbmVgIG1lYW5zIG5vIHRhYlxuICAgICAqIHdpbGwgYmUgaW1tZWRpYXRlbHkgc2VsZWN0ZWQuIERlZmF1bHRzIHRvIDAgKHRoZSBmaXJzdCB0YWIpLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgZ2V0IGRlZmF1bHRUYWIoKTogc3RyaW5nIHwgbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RlZmF1bHRUYWI7XG4gICAgfVxuXG4gICAgc2V0IGRlZmF1bHRUYWIodGFiVmFsdWU6IHN0cmluZyB8IG51bWJlcikge1xuICAgICAgICBpZiAoIWlzTmFOKCt0YWJWYWx1ZSkgfHwgdGFiVmFsdWUgPT09ICdub25lJykge1xuICAgICAgICAgICAgdGhpcy5fZGVmYXVsdFRhYiA9IHRhYlZhbHVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaW52YWxpZERlZmF1bHRUYWIodGFiVmFsdWUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIERldGVybWluZXMgd2hldGhlciB0aGUgdGFiIHNldCB3aWxsIGNyZWF0ZSBhIHJvdXRlci1vdXRsZXQgb3IgbmctY29udGFpbmVyIGZvciB0aGUgdGFiIGNvbnRlbnQuXG4gICAgICogSWYgc2V0IHRvIGZhbHNlLCB0aGUgYXBwIHdpbGwgbmVlZCB0byBhZGQgaXRzIG93biBjb250YWluZXIuICBEZWZhdWx0cyB0byBgdHJ1ZWAuICovXG4gICAgQElucHV0KClcbiAgICBnZXQgYWRkQ29udGVudENvbnRhaW5lcigpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FkZENvbnRlbnRDb250YWluZXI7XG4gICAgfVxuXG4gICAgc2V0IGFkZENvbnRlbnRDb250YWluZXIodmFsdWUpIHtcbiAgICAgICAgdGhpcy5fYWRkQ29udGVudENvbnRhaW5lciA9IHBhcnNlQm9vbGVhbkF0dHJpYnV0ZSh2YWx1ZSk7XG4gICAgfVxuXG4gICAgX2FkZENvbnRlbnRDb250YWluZXI6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgLyoqIElmIHRydWUsIGNvbmRlbnNlIHRoZSBkZWZhdWx0IHBhZGRpbmcgb24gYWxsIGluY2x1ZGVkIHRhYnMuICpEZWZhdWx0cyB0byBgZmFsc2VgLiogICovXG4gICAgQElucHV0KClcbiAgICBnZXQgdGlnaHQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLl90aWdodDtcbiAgICB9XG4gICAgc2V0IHRpZ2h0KHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX3RpZ2h0ID0gcGFyc2VCb29sZWFuQXR0cmlidXRlKHZhbHVlKTtcbiAgICAgICAgdGhpcy5zZXRUYWJEaXJlY3Rpb24oKTtcbiAgICB9XG4gICAgcHJpdmF0ZSBfdGlnaHQgPSBmYWxzZTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsIHByaXZhdGUgcm91dGU6IEFjdGl2YXRlZFJvdXRlKSB7fVxuXG4gICAgbmdBZnRlckNvbnRlbnRJbml0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLnNldFVwVGFicygpO1xuICAgICAgICB0aGlzLl90YWJzLmNoYW5nZXMuc3Vic2NyaWJlKCgpID0+IHRoaXMuc2V0VXBUYWJzKCkpO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2V0VXBUYWJzKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5fdGFicy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRocm93IHRhYkNvbXBvbmVudE1pc3NpbmcoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmRlZmF1bHRUYWIgIT09ICdub25lJykge1xuICAgICAgICAgICAgdGhpcy5kZWZhdWx0VG9GaXJzdFRhYigpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2hlY2tGb3JSb3V0ZXJVc2UoKTtcbiAgICAgICAgdGhpcy5zZXRUYWJEaXJlY3Rpb24oKTtcbiAgICAgICAgdGhpcy5zdWJzY3JpYmVUb1RhYkNsaWNrcygpO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2V0VGFiRGlyZWN0aW9uKCk6IHZvaWQge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+XG4gICAgICAgICAgICB0aGlzLl90YWJzLmZvckVhY2godCA9PiB7XG4gICAgICAgICAgICAgICAgdC5fZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247XG4gICAgICAgICAgICAgICAgdC5fdGlnaHQgPSB0aGlzLnRpZ2h0O1xuICAgICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN1YnNjcmliZVRvVGFiQ2xpY2tzKCk6IHZvaWQge1xuICAgICAgICB0aGlzLl9zdG9wVGFiU3Vic2NyaXB0aW9uU3ViamVjdC5uZXh0KCk7XG4gICAgICAgIHRoaXMuX3RhYnMuZm9yRWFjaCh0ID0+IHQudGFiQ2xpY2sucGlwZSh0YWtlVW50aWwodGhpcy5fc3RvcFRhYlN1YnNjcmlwdGlvblN1YmplY3QpKS5zdWJzY3JpYmUoKCkgPT4gdGhpcy5fc2V0QWN0aXZlKHQpKSk7XG4gICAgfVxuXG4gICAgLyoqIFNldHMgdGhlIGN1cnJlbnRseSBzZWxlY3RlZCB0YWIgYnkgZWl0aGVyIGl0cyBudW1lcmljYWwgaW5kZXggb3IgYFRhYkNvbXBvbmVudGAgb2JqZWN0ICAqL1xuICAgIHNlbGVjdFRhYih0YWI6IG51bWJlciB8IFRhYkNvbXBvbmVudCkge1xuICAgICAgICBjb25zdCBhY3RpdmVUYWIgPSB0eXBlb2YgdGFiID09PSAnbnVtYmVyJyA/IHRoaXMuX3RhYnMudG9BcnJheSgpW3RhYl0gOiB0YWI7XG4gICAgICAgIHRoaXMuX3NldEFjdGl2ZShhY3RpdmVUYWIpO1xuICAgIH1cblxuICAgIF9zZXRBY3RpdmUodGFiOiBUYWJDb21wb25lbnQpIHtcbiAgICAgICAgbGV0IGFjdGl2ZUluZGV4ID0gMDtcbiAgICAgICAgdGhpcy5fdGFicy50b0FycmF5KCkuZm9yRWFjaCgodCwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIHQuX2FjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKHQgPT09IHRhYikge1xuICAgICAgICAgICAgICAgIGFjdGl2ZUluZGV4ID0gaW5kZXg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0YWIuX2FjdGl2ZSA9IHRydWU7XG4gICAgICAgIHRoaXMudGFiQ29udGVudCA9IHRhYi50YWJDb250ZW50O1xuICAgICAgICB0aGlzLnNlbGVjdGVkVGFiQ2hhbmdlLmVtaXQobmV3IFRhYkNoYW5nZUV2ZW50KGFjdGl2ZUluZGV4LCB0YWIpKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGRlZmF1bHRUb0ZpcnN0VGFiKCkge1xuICAgICAgICBpZiAoIXRoaXMuX3RhYnMuZmluZCh0YWIgPT4gdGFiLl9hY3RpdmUpKSB7XG4gICAgICAgICAgICAvLyBzZXRUaW1lb3V0IHRvIGF2b2lkIGNoYW5nZSBhZnRlciBjaGVja2VkIGVycm9yXG4gICAgICAgICAgICAvLyB3aGVuIG5nRm9yIGlzIHVzZWQgYXMgcHJvamVjdGVkIG5vZGVzIGFyZSByZWdpc3RlcmVkXG4gICAgICAgICAgICAvLyBhbmQgc3RvcmVkIGFzIHBhcnQgb2YgdGhlIGV4aXN0aW5nIHZpZXcsIG5vdFxuICAgICAgICAgICAgLy8gdGhlIHZpZXcgaW4gd2hpY2ggdGhleSBhcmUgcHJvamVjdGVkXG4gICAgICAgICAgICAvLyBlbWJlZGRlZCB2aWV3cyBhcmUgY2hlY2tlZCAqYmVmb3JlKiBBZnRlckNvbnRlbnRJbml0XG4gICAgICAgICAgICAvLyBpcyB0cmlnZ2VyZWRcbiAgICAgICAgICAgIGNvbnN0IHRhYkFycmF5ID0gdGhpcy5fdGFicy50b0FycmF5KCk7XG4gICAgICAgICAgICBpZiAodGFiQXJyYXlbTnVtYmVyKHRoaXMuZGVmYXVsdFRhYildKSB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLl9zZXRBY3RpdmUodGFiQXJyYXlbTnVtYmVyKHRoaXMuZGVmYXVsdFRhYildKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGludmFsaWREZWZhdWx0VGFiKHRoaXMuZGVmYXVsdFRhYik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGNoZWNrRm9yUm91dGVyVXNlKCkge1xuICAgICAgICBjb25zdCBjb3VudFVzaW5nUm91dGVyID0gdGhpcy5fdGFicy5maWx0ZXIodGFiID0+IHRhYi5yb3V0ZXJMaW5rICE9PSB1bmRlZmluZWQpLmxlbmd0aDtcbiAgICAgICAgaWYgKGNvdW50VXNpbmdSb3V0ZXIgPiAwICYmIGNvdW50VXNpbmdSb3V0ZXIgPCB0aGlzLl90YWJzLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgdGFic01pc3NpbmdSb3V0ZXJMaW5rID0gdGhpcy5fdGFicy5maWx0ZXIodGFiID0+IHRhYi5yb3V0ZXJMaW5rID09PSB1bmRlZmluZWQpO1xuICAgICAgICAgICAgdGhyb3dFcnJvckZvck1pc3NpbmdSb3V0ZXJMaW5rKHRhYnNNaXNzaW5nUm91dGVyTGluayk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY291bnRVc2luZ1JvdXRlciA9PT0gdGhpcy5fdGFicy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuX3JvdXRlckVuYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKHRoaXMuX2RlZmF1bHRUYWIgIT09ICdub25lJykge1xuICAgICAgICAgICAgICAgIHRoaXMuZGVmYXVsdFRvRmlyc3RSb3V0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkZWZhdWx0VG9GaXJzdFJvdXRlKCkge1xuICAgICAgICBjb25zdCBmb3VuZFJvdXRlID0gdGhpcy5fdGFic1xuICAgICAgICAgICAgLm1hcCh0YWIgPT4gdGFiLnJvdXRlckxpbmspXG4gICAgICAgICAgICAubWFwKHJvdXRlckxpbmsgPT4gdGhpcy5tYXBSb3V0ZXJMaW5rVG9TdHJpbmcocm91dGVyTGluaykpXG4gICAgICAgICAgICAuZmluZChyb3V0ZXJMaW5rID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgY3VycmVudFJvdXRlID0gdGhpcy5yb3V0ZXIudXJsO1xuICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50Um91dGUgPT09IHJvdXRlckxpbmsgfHwgY3VycmVudFJvdXRlLmluZGV4T2YoYCR7cm91dGVyTGlua30vYCkgPiAtMTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChmb3VuZFJvdXRlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB0YWJBcnJheSA9IHRoaXMuX3RhYnMudG9BcnJheSgpO1xuICAgICAgICBpZiAodGFiQXJyYXlbTnVtYmVyKHRoaXMuZGVmYXVsdFRhYildKSB7XG4gICAgICAgICAgICBjb25zdCBmaXJzdFJvdXRlID0gdGhpcy5tYXBSb3V0ZXJMaW5rVG9TdHJpbmcodGFiQXJyYXlbTnVtYmVyKHRoaXMuZGVmYXVsdFRhYildLnJvdXRlckxpbmspO1xuICAgICAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoW2ZpcnN0Um91dGVdLCB7cmVsYXRpdmVUbzogdGhpcy5yb3V0ZX0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBtYXBSb3V0ZXJMaW5rVG9TdHJpbmcocm91dGVyTGluazogc3RyaW5nIHwgYW55W10pOiBzdHJpbmcge1xuICAgICAgICBpZiAocm91dGVyTGluayBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICByb3V0ZXJMaW5rID0gcm91dGVyTGluay5qb2luKCcvJykucmVwbGFjZSgnLy8nLCAnLycpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByb3V0ZXJMaW5rO1xuICAgIH1cbn1cbiJdfQ==