/**
 * @fileoverview added by tsickle
 * Generated from: lib/picklist/services/picklist-action.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { isSubList } from '../pane/picklist-pane.model';
import { PicklistService } from './picklist.service';
var PicklistActionService = /** @class */ (function () {
    function PicklistActionService(listService) {
        this.listService = listService;
    }
    Object.defineProperty(PicklistActionService.prototype, "valueList", {
        get: /**
         * @return {?}
         */
        function () {
            return this.listService.valueList;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PicklistActionService.prototype, "valueSetList", {
        get: /**
         * @return {?}
         */
        function () {
            return this.listService.valueSetList;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @template T
     * @param {?} event
     * @param {?} index
     * @param {?} list
     * @param {?} item
     * @return {?}
     */
    PicklistActionService.prototype.onItemClicked = /**
     * @template T
     * @param {?} event
     * @param {?} index
     * @param {?} list
     * @param {?} item
     * @return {?}
     */
    function (event, index, list, item) {
        if (event.shiftKey && list.lastClickedOption && !(item.code === list.lastClickedOption.code)) {
            this.shiftClick(index, list, item, list.lastClickedOption);
        }
        else if (event.ctrlKey) {
            this.ctrlClick(list, item);
        }
        else {
            // regular click
            this.selectNone();
            this.selectItem(list, item);
            list.lastClickedOption = item;
        }
    };
    /**
     * @template T
     * @param {?} event
     * @param {?} list
     * @param {?} item
     * @return {?}
     */
    PicklistActionService.prototype.onItemDoubleClicked = /**
     * @template T
     * @param {?} event
     * @param {?} list
     * @param {?} item
     * @return {?}
     */
    function (event, list, item) {
        this.selectNone();
        this.selectItem(list, item);
    };
    /**
     * @param {?} event
     * @param {?} valueset
     * @return {?}
     */
    PicklistActionService.prototype.onValuesetCaretClicked = /**
     * @param {?} event
     * @param {?} valueset
     * @return {?}
     */
    function (event, valueset) {
        if (!valueset.showValues && valueset.subValuesSelectList.filteredOptions.length === 0) {
            this.listService.loadValuesForValueset(valueset);
        }
        valueset.showValues = !valueset.showValues;
    };
    /**
     * @return {?}
     */
    PicklistActionService.prototype.selectAll = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.valueSetList.filteredOptions.forEach((/**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            _this.clearListSelection(v.subValuesSelectList);
        })); // deselect sublist items
        this.selectAllInList(this.valueList);
        this.selectAllInList(this.valueSetList);
    };
    /**
     * @return {?}
     */
    PicklistActionService.prototype.selectNone = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.valueSetList.filteredOptions.forEach((/**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            _this.clearListSelection(v.subValuesSelectList);
        }));
        this.clearListSelection(this.valueList);
        this.clearListSelection(this.valueSetList);
    };
    /**
     * @template T
     * @param {?} list
     * @return {?}
     */
    PicklistActionService.prototype.selectAllInList = /**
     * @template T
     * @param {?} list
     * @return {?}
     */
    function (list) {
        if (!list.isActive) {
            return;
        }
        list.selectedOptions.clear();
        list.lastClickedOption = null;
        list.filteredOptions.forEach((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            item.selected = true;
            list.selectedOptions.set(item.code, item);
        }));
    };
    /**
     * @private
     * @template T
     * @param {?} list
     * @return {?}
     */
    PicklistActionService.prototype.clearListSelection = /**
     * @private
     * @template T
     * @param {?} list
     * @return {?}
     */
    function (list) {
        list.selectedOptions.clear();
        list.lastClickedOption = null;
        list.filteredOptions.forEach((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            item.selected = false;
        }));
    };
    /**
     * @private
     * @template T
     * @param {?} index
     * @param {?} list
     * @param {?} item
     * @param {?} lastClickedItem
     * @return {?}
     */
    PicklistActionService.prototype.shiftClick = /**
     * @private
     * @template T
     * @param {?} index
     * @param {?} list
     * @param {?} item
     * @param {?} lastClickedItem
     * @return {?}
     */
    function (index, list, item, lastClickedItem) {
        /** @type {?} */
        var lastIndex = list.filteredOptions.indexOf(lastClickedItem);
        /** @type {?} */
        var largeIndex = Math.max(index, lastIndex);
        /** @type {?} */
        var smallIndex = Math.min(index, lastIndex);
        /** @type {?} */
        var formerLastClicked = list.lastClickedOption;
        this.selectNone();
        list.lastClickedOption = formerLastClicked;
        for (var i = smallIndex; i <= largeIndex; i++) {
            this.selectItem(list, list.filteredOptions[i]);
        }
    };
    /**
     * @private
     * @template T
     * @param {?} list
     * @param {?} item
     * @return {?}
     */
    PicklistActionService.prototype.ctrlClick = /**
     * @private
     * @template T
     * @param {?} list
     * @param {?} item
     * @return {?}
     */
    function (list, item) {
        // if ctrl clicking a sub value of a valueset that is selected (such that all subvalues appear selected)
        if (isSubList(list) && list.parentValueSet.selected) {
            this.selectAllInList(list);
            this.deselectItem(this.valueSetList, list.parentValueSet);
            this.deselectItem(list, item);
        }
        else {
            this.toggleItemSelection(list, item);
        }
        list.lastClickedOption = item;
    };
    /**
     * @private
     * @template T
     * @param {?} list
     * @param {?} item
     * @return {?}
     */
    PicklistActionService.prototype.deselectItem = /**
     * @private
     * @template T
     * @param {?} list
     * @param {?} item
     * @return {?}
     */
    function (list, item) {
        item.selected = false;
        list.selectedOptions.delete(item.code);
    };
    /**
     * @private
     * @template T
     * @param {?} list
     * @param {?} item
     * @return {?}
     */
    PicklistActionService.prototype.selectItem = /**
     * @private
     * @template T
     * @param {?} list
     * @param {?} item
     * @return {?}
     */
    function (list, item) {
        item.selected = true;
        list.selectedOptions.set(item.code, item);
    };
    /**
     * @private
     * @template T
     * @param {?} list
     * @param {?} item
     * @return {?}
     */
    PicklistActionService.prototype.toggleItemSelection = /**
     * @private
     * @template T
     * @param {?} list
     * @param {?} item
     * @return {?}
     */
    function (list, item) {
        if (item.selected) {
            this.deselectItem(list, item);
        }
        else {
            this.selectItem(list, item);
        }
    };
    PicklistActionService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    PicklistActionService.ctorParameters = function () { return [
        { type: PicklistService }
    ]; };
    return PicklistActionService;
}());
export { PicklistActionService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    PicklistActionService.prototype.listService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGlja2xpc3QtYWN0aW9uLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AaGVhbHRoY2F0YWx5c3QvY2FzaG1lcmUvIiwic291cmNlcyI6WyJsaWIvcGlja2xpc3Qvc2VydmljZXMvcGlja2xpc3QtYWN0aW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQ3pDLE9BQU8sRUFBdUIsU0FBUyxFQUF3RCxNQUFNLDZCQUE2QixDQUFDO0FBQ25JLE9BQU8sRUFBQyxlQUFlLEVBQUMsTUFBTSxvQkFBb0IsQ0FBQztBQUVuRDtJQVFJLCtCQUEyQixXQUE0QjtRQUE1QixnQkFBVyxHQUFYLFdBQVcsQ0FBaUI7SUFBRyxDQUFDO0lBTjNELHNCQUFXLDRDQUFTOzs7O1FBQXBCO1lBQ0ksT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQztRQUN0QyxDQUFDOzs7T0FBQTtJQUNELHNCQUFXLCtDQUFZOzs7O1FBQXZCO1lBQ0ksT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLFlBQVksQ0FBQztRQUN6QyxDQUFDOzs7T0FBQTs7Ozs7Ozs7O0lBR00sNkNBQWE7Ozs7Ozs7O0lBQXBCLFVBQWlELEtBQWlCLEVBQUUsS0FBYSxFQUFFLElBQTZCLEVBQUUsSUFBTztRQUNySCxJQUFJLEtBQUssQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLGlCQUFpQixJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUMxRixJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1NBQzlEO2FBQU0sSUFBSSxLQUFLLENBQUMsT0FBTyxFQUFFO1lBQ3RCLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLElBQUks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Ozs7OztJQUFwQixVQUFpRCxJQUE2QixFQUFFLElBQU87UUFDbkYsSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7UUFDdEIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzNDLENBQUM7Ozs7Ozs7O0lBRU8sMENBQVU7Ozs7Ozs7SUFBbEIsVUFBK0MsSUFBNkIsRUFBRSxJQUFPO1FBQ2pGLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDOUMsQ0FBQzs7Ozs7Ozs7SUFFTyxtREFBbUI7Ozs7Ozs7SUFBM0IsVUFBd0QsSUFBNkIsRUFBRSxJQUFPO1FBQzFGLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNmLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1NBQ2pDO2FBQU07WUFDSCxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztTQUMvQjtJQUNMLENBQUM7O2dCQXJISixVQUFVOzs7O2dCQUZILGVBQWU7O0lBd0h2Qiw0QkFBQztDQUFBLEFBdEhELElBc0hDO1NBckhZLHFCQUFxQjs7Ozs7O0lBT1gsNENBQW9DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtJbmplY3RhYmxlfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7RmlsdGVyYWJsZVNlbGVjdExpc3QsIGlzU3ViTGlzdCwgU2VsZWN0TGlzdE9wdGlvbiwgVmFsdWVMaXN0T3B0aW9uLCBWYWx1ZVNldExpc3RPcHRpb259IGZyb20gJy4uL3BhbmUvcGlja2xpc3QtcGFuZS5tb2RlbCc7XG5pbXBvcnQge1BpY2tsaXN0U2VydmljZX0gZnJvbSAnLi9waWNrbGlzdC5zZXJ2aWNlJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFBpY2tsaXN0QWN0aW9uU2VydmljZSB7XG4gICAgcHVibGljIGdldCB2YWx1ZUxpc3QoKTogRmlsdGVyYWJsZVNlbGVjdExpc3Q8VmFsdWVMaXN0T3B0aW9uPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmxpc3RTZXJ2aWNlLnZhbHVlTGlzdDtcbiAgICB9XG4gICAgcHVibGljIGdldCB2YWx1ZVNldExpc3QoKTogRmlsdGVyYWJsZVNlbGVjdExpc3Q8VmFsdWVTZXRMaXN0T3B0aW9uPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmxpc3RTZXJ2aWNlLnZhbHVlU2V0TGlzdDtcbiAgICB9XG4gICAgcHVibGljIGNvbnN0cnVjdG9yKHByaXZhdGUgbGlzdFNlcnZpY2U6IFBpY2tsaXN0U2VydmljZSkge31cblxuICAgIHB1YmxpYyBvbkl0ZW1DbGlja2VkPFQgZXh0ZW5kcyBTZWxlY3RMaXN0T3B0aW9uPihldmVudDogTW91c2VFdmVudCwgaW5kZXg6IG51bWJlciwgbGlzdDogRmlsdGVyYWJsZVNlbGVjdExpc3Q8VD4sIGl0ZW06IFQpIHtcbiAgICAgICAgaWYgKGV2ZW50LnNoaWZ0S2V5ICYmIGxpc3QubGFzdENsaWNrZWRPcHRpb24gJiYgIShpdGVtLmNvZGUgPT09IGxpc3QubGFzdENsaWNrZWRPcHRpb24uY29kZSkpIHtcbiAgICAgICAgICAgIHRoaXMuc2hpZnRDbGljayhpbmRleCwgbGlzdCwgaXRlbSwgbGlzdC5sYXN0Q2xpY2tlZE9wdGlvbik7XG4gICAgICAgIH0gZWxzZSBpZiAoZXZlbnQuY3RybEtleSkge1xuICAgICAgICAgICAgdGhpcy5jdHJsQ2xpY2sobGlzdCwgaXRlbSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyByZWd1bGFyIGNsaWNrXG4gICAgICAgICAgICB0aGlzLnNlbGVjdE5vbmUoKTtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0SXRlbShsaXN0LCBpdGVtKTtcbiAgICAgICAgICAgIGxpc3QubGFzdENsaWNrZWRPcHRpb24gPSBpdGVtO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIG9uSXRlbURvdWJsZUNsaWNrZWQ8VCBleHRlbmRzIFNlbGVjdExpc3RPcHRpb24+KGV2ZW50OiBNb3VzZUV2ZW50LCBsaXN0OiBGaWx0ZXJhYmxlU2VsZWN0TGlzdDxUPiwgaXRlbTogVCkge1xuICAgICAgICB0aGlzLnNlbGVjdE5vbmUoKTtcbiAgICAgICAgdGhpcy5zZWxlY3RJdGVtKGxpc3QsIGl0ZW0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBvblZhbHVlc2V0Q2FyZXRDbGlja2VkKGV2ZW50OiBNb3VzZUV2ZW50LCB2YWx1ZXNldDogVmFsdWVTZXRMaXN0T3B0aW9uKSB7XG4gICAgICAgIGlmICghdmFsdWVzZXQuc2hvd1ZhbHVlcyAmJiB2YWx1ZXNldC5zdWJWYWx1ZXNTZWxlY3RMaXN0LmZpbHRlcmVkT3B0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMubGlzdFNlcnZpY2UubG9hZFZhbHVlc0ZvclZhbHVlc2V0KHZhbHVlc2V0KTtcbiAgICAgICAgfVxuICAgICAgICB2YWx1ZXNldC5zaG93VmFsdWVzID0gIXZhbHVlc2V0LnNob3dWYWx1ZXM7XG4gICAgfVxuXG4gICAgcHVibGljIHNlbGVjdEFsbCgpIHtcbiAgICAgICAgdGhpcy52YWx1ZVNldExpc3QuZmlsdGVyZWRPcHRpb25zLmZvckVhY2godiA9PiB7XG4gICAgICAgICAgICB0aGlzLmNsZWFyTGlzdFNlbGVjdGlvbih2LnN1YlZhbHVlc1NlbGVjdExpc3QpO1xuICAgICAgICB9KTsgLy8gZGVzZWxlY3Qgc3VibGlzdCBpdGVtc1xuICAgICAgICB0aGlzLnNlbGVjdEFsbEluTGlzdCh0aGlzLnZhbHVlTGlzdCk7XG4gICAgICAgIHRoaXMuc2VsZWN0QWxsSW5MaXN0KHRoaXMudmFsdWVTZXRMaXN0KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2VsZWN0Tm9uZSgpIHtcbiAgICAgICAgdGhpcy52YWx1ZVNldExpc3QuZmlsdGVyZWRPcHRpb25zLmZvckVhY2godiA9PiB7XG4gICAgICAgICAgICB0aGlzLmNsZWFyTGlzdFNlbGVjdGlvbih2LnN1YlZhbHVlc1NlbGVjdExpc3QpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5jbGVhckxpc3RTZWxlY3Rpb24odGhpcy52YWx1ZUxpc3QpO1xuICAgICAgICB0aGlzLmNsZWFyTGlzdFNlbGVjdGlvbih0aGlzLnZhbHVlU2V0TGlzdCk7XG4gICAgfVxuXG4gICAgcHVibGljIHNlbGVjdEFsbEluTGlzdDxUIGV4dGVuZHMgU2VsZWN0TGlzdE9wdGlvbj4obGlzdDogRmlsdGVyYWJsZVNlbGVjdExpc3Q8VD4pIHtcbiAgICAgICAgaWYgKCFsaXN0LmlzQWN0aXZlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBsaXN0LnNlbGVjdGVkT3B0aW9ucy5jbGVhcigpO1xuICAgICAgICBsaXN0Lmxhc3RDbGlja2VkT3B0aW9uID0gbnVsbDtcblxuICAgICAgICBsaXN0LmZpbHRlcmVkT3B0aW9ucy5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICAgICAgaXRlbS5zZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICBsaXN0LnNlbGVjdGVkT3B0aW9ucy5zZXQoaXRlbS5jb2RlLCBpdGVtKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjbGVhckxpc3RTZWxlY3Rpb248VCBleHRlbmRzIFNlbGVjdExpc3RPcHRpb24+KGxpc3Q6IEZpbHRlcmFibGVTZWxlY3RMaXN0PFQ+KSB7XG4gICAgICAgIGxpc3Quc2VsZWN0ZWRPcHRpb25zLmNsZWFyKCk7XG4gICAgICAgIGxpc3QubGFzdENsaWNrZWRPcHRpb24gPSBudWxsO1xuXG4gICAgICAgIGxpc3QuZmlsdGVyZWRPcHRpb25zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgICBpdGVtLnNlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2hpZnRDbGljazxUIGV4dGVuZHMgU2VsZWN0TGlzdE9wdGlvbj4oaW5kZXg6IG51bWJlciwgbGlzdDogRmlsdGVyYWJsZVNlbGVjdExpc3Q8VD4sIGl0ZW06IFQsIGxhc3RDbGlja2VkSXRlbTogVCkge1xuICAgICAgICBjb25zdCBsYXN0SW5kZXggPSBsaXN0LmZpbHRlcmVkT3B0aW9ucy5pbmRleE9mKGxhc3RDbGlja2VkSXRlbSk7XG4gICAgICAgIGxldCBsYXJnZUluZGV4ID0gTWF0aC5tYXgoaW5kZXgsIGxhc3RJbmRleCk7XG4gICAgICAgIGxldCBzbWFsbEluZGV4ID0gTWF0aC5taW4oaW5kZXgsIGxhc3RJbmRleCk7XG5cbiAgICAgICAgY29uc3QgZm9ybWVyTGFzdENsaWNrZWQgPSBsaXN0Lmxhc3RDbGlja2VkT3B0aW9uO1xuICAgICAgICB0aGlzLnNlbGVjdE5vbmUoKTtcbiAgICAgICAgbGlzdC5sYXN0Q2xpY2tlZE9wdGlvbiA9IGZvcm1lckxhc3RDbGlja2VkO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSBzbWFsbEluZGV4OyBpIDw9IGxhcmdlSW5kZXg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RJdGVtKGxpc3QsIGxpc3QuZmlsdGVyZWRPcHRpb25zW2ldKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgY3RybENsaWNrPFQgZXh0ZW5kcyBTZWxlY3RMaXN0T3B0aW9uPihsaXN0OiBGaWx0ZXJhYmxlU2VsZWN0TGlzdDxUPiwgaXRlbTogVCkge1xuICAgICAgICAvLyBpZiBjdHJsIGNsaWNraW5nIGEgc3ViIHZhbHVlIG9mIGEgdmFsdWVzZXQgdGhhdCBpcyBzZWxlY3RlZCAoc3VjaCB0aGF0IGFsbCBzdWJ2YWx1ZXMgYXBwZWFyIHNlbGVjdGVkKVxuICAgICAgICBpZiAoaXNTdWJMaXN0KGxpc3QpICYmIGxpc3QucGFyZW50VmFsdWVTZXQuc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0QWxsSW5MaXN0PFZhbHVlTGlzdE9wdGlvbj4obGlzdCk7XG4gICAgICAgICAgICB0aGlzLmRlc2VsZWN0SXRlbSh0aGlzLnZhbHVlU2V0TGlzdCwgbGlzdC5wYXJlbnRWYWx1ZVNldCk7XG4gICAgICAgICAgICB0aGlzLmRlc2VsZWN0SXRlbTxWYWx1ZUxpc3RPcHRpb24+KGxpc3QsIGl0ZW0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy50b2dnbGVJdGVtU2VsZWN0aW9uKGxpc3QsIGl0ZW0pO1xuICAgICAgICB9XG5cbiAgICAgICAgbGlzdC5sYXN0Q2xpY2tlZE9wdGlvbiA9IGl0ZW07XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkZXNlbGVjdEl0ZW08VCBleHRlbmRzIFNlbGVjdExpc3RPcHRpb24+KGxpc3Q6IEZpbHRlcmFibGVTZWxlY3RMaXN0PFQ+LCBpdGVtOiBUKSB7XG4gICAgICAgIGl0ZW0uc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgbGlzdC5zZWxlY3RlZE9wdGlvbnMuZGVsZXRlKGl0ZW0uY29kZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZWxlY3RJdGVtPFQgZXh0ZW5kcyBTZWxlY3RMaXN0T3B0aW9uPihsaXN0OiBGaWx0ZXJhYmxlU2VsZWN0TGlzdDxUPiwgaXRlbTogVCkge1xuICAgICAgICBpdGVtLnNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgbGlzdC5zZWxlY3RlZE9wdGlvbnMuc2V0KGl0ZW0uY29kZSwgaXRlbSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB0b2dnbGVJdGVtU2VsZWN0aW9uPFQgZXh0ZW5kcyBTZWxlY3RMaXN0T3B0aW9uPihsaXN0OiBGaWx0ZXJhYmxlU2VsZWN0TGlzdDxUPiwgaXRlbTogVCkge1xuICAgICAgICBpZiAoaXRlbS5zZWxlY3RlZCkge1xuICAgICAgICAgICAgdGhpcy5kZXNlbGVjdEl0ZW0obGlzdCwgaXRlbSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdEl0ZW0obGlzdCwgaXRlbSk7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=