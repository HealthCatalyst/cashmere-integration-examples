/**
 * @fileoverview added by tsickle
 * Generated from: lib/picklist/services/picklist-valueset-moving.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { PicklistFilterService } from './picklist-filter.service';
import { ValueListOption } from '../pane/picklist-pane.model';
import { PicklistStateService } from './picklist-state.service';
var PicklistValuesetMovingService = /** @class */ (function () {
    function PicklistValuesetMovingService(filterService, stateService) {
        this.filterService = filterService;
        this.stateService = stateService;
    }
    Object.defineProperty(PicklistValuesetMovingService.prototype, "valueList", {
        get: /**
         * @return {?}
         */
        function () {
            return this.stateService.valueList;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PicklistValuesetMovingService.prototype, "valueSetList", {
        get: /**
         * @return {?}
         */
        function () {
            return this.stateService.valueSetList;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} optionsToMove
     * @param {?} pane
     * @param {?=} shouldBreakValuesets
     * @return {?}
     */
    PicklistValuesetMovingService.prototype.moveOutValuesets = /**
     * @param {?} optionsToMove
     * @param {?} pane
     * @param {?=} shouldBreakValuesets
     * @return {?}
     */
    function (optionsToMove, pane, shouldBreakValuesets) {
        var _this = this;
        if (shouldBreakValuesets === void 0) { shouldBreakValuesets = false; }
        this.valueSetList.selectedOptions.forEach((/**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            v.showValues = false;
            optionsToMove.valueSets.set(v.code, v);
            _this.valueSetList.options.delete(v.code);
        }));
        this.valueSetList.filteredOptions.forEach((/**
         * @param {?} valueset
         * @return {?}
         */
        function (valueset) {
            if (valueset.selected || valueset.subValuesSelectList.selectedOptions.size < 1) {
                return;
            }
            if (shouldBreakValuesets) {
                _this.breakValueset(valueset, optionsToMove, pane.companion);
            }
            else {
                _this.moveSubValues(valueset.subValuesSelectList.selectedOptions, pane);
            }
        }));
    };
    /**
     * @private
     * @param {?} valueset
     * @param {?} optionsToMove
     * @param {?} companionPane
     * @return {?}
     */
    PicklistValuesetMovingService.prototype.breakValueset = /**
     * @private
     * @param {?} valueset
     * @param {?} optionsToMove
     * @param {?} companionPane
     * @return {?}
     */
    function (valueset, optionsToMove, companionPane) {
        valueset.showValues = false;
        optionsToMove.valueSets.set(valueset.code, valueset);
        this.valueSetList.options.delete(valueset.code);
        /** @type {?} */
        var unselectedSubValues = new Map();
        valueset.subValuesSelectList.filteredOptions
            .filter((/**
         * @param {?} o
         * @return {?}
         */
        function (o) { return !o.selected; }))
            .forEach((/**
         * @param {?} o
         * @return {?}
         */
        function (o) {
            unselectedSubValues.set(o.code, new ValueListOption(o.option, o.code));
        }));
        if (!companionPane) {
            return;
        }
        this.moveSubValues(unselectedSubValues, companionPane);
    };
    /**
     * @private
     * @param {?} valuesMap
     * @param {?} sourcePane
     * @return {?}
     */
    PicklistValuesetMovingService.prototype.moveSubValues = /**
     * @private
     * @param {?} valuesMap
     * @param {?} sourcePane
     * @return {?}
     */
    function (valuesMap, sourcePane) {
        this.removeValuesFromPane(valuesMap, sourcePane);
        if (!sourcePane.companion) {
            return;
        }
        valuesMap.forEach((/**
         * @param {?} o
         * @return {?}
         */
        function (o) {
            // tslint:disable-next-line:no-non-null-assertion
            (/** @type {?} */ (sourcePane.companion)).valueList.options.set(o.code, new ValueListOption(o.option, o.code));
        }));
    };
    /**
     * Handles complex logic for when one pane is paged, and we want to keep the "x of y" counts accurate without a round trip to the server
     */
    /**
     * Handles complex logic for when one pane is paged, and we want to keep the "x of y" counts accurate without a round trip to the server
     * @private
     * @param {?} valuesMap
     * @param {?} pane
     * @return {?}
     */
    PicklistValuesetMovingService.prototype.removeValuesFromPane = /**
     * Handles complex logic for when one pane is paged, and we want to keep the "x of y" counts accurate without a round trip to the server
     * @private
     * @param {?} valuesMap
     * @param {?} pane
     * @return {?}
     */
    function (valuesMap, pane) {
        if (pane.isPaged) {
            // don't bother trying to remove values or decrement count for options that are already filtered out
            this.filterService.preFilterOptionsForRemoteMode(valuesMap, pane.valueList);
        }
        valuesMap.forEach((/**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            /** @type {?} */
            var optionDeleted = pane.valueList.options.delete(v.code);
            /** @type {?} */
            var optionAlreadyInCompanionList = pane.companion ? pane.companion.valueList.options.has(v.code) : false;
            if (!optionDeleted && pane.isPaged && !optionAlreadyInCompanionList) {
                pane.valueList.additionalRemoteOptions--;
            }
        }));
    };
    PicklistValuesetMovingService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    PicklistValuesetMovingService.ctorParameters = function () { return [
        { type: PicklistFilterService },
        { type: PicklistStateService }
    ]; };
    return PicklistValuesetMovingService;
}());
export { PicklistValuesetMovingService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    PicklistValuesetMovingService.prototype.filterService;
    /**
     * @type {?}
     * @private
     */
    PicklistValuesetMovingService.prototype.stateService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGlja2xpc3QtdmFsdWVzZXQtbW92aW5nLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AaGVhbHRoY2F0YWx5c3QvY2FzaG1lcmUvIiwic291cmNlcyI6WyJsaWIvcGlja2xpc3Qvc2VydmljZXMvcGlja2xpc3QtdmFsdWVzZXQtbW92aW5nLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBRXpDLE9BQU8sRUFBQyxxQkFBcUIsRUFBQyxNQUFNLDJCQUEyQixDQUFDO0FBRWhFLE9BQU8sRUFBNkMsZUFBZSxFQUFxQixNQUFNLDZCQUE2QixDQUFDO0FBQzVILE9BQU8sRUFBQyxvQkFBb0IsRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBRTlEO0lBU0ksdUNBQTJCLGFBQW9DLEVBQVUsWUFBa0M7UUFBaEYsa0JBQWEsR0FBYixhQUFhLENBQXVCO1FBQVUsaUJBQVksR0FBWixZQUFZLENBQXNCO0lBQUcsQ0FBQztJQVAvRyxzQkFBVyxvREFBUzs7OztRQUFwQjtZQUNJLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUM7UUFDdkMsQ0FBQzs7O09BQUE7SUFDRCxzQkFBVyx1REFBWTs7OztRQUF2QjtZQUNJLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxZQUFZLENBQUM7UUFDMUMsQ0FBQzs7O09BQUE7Ozs7Ozs7SUFJTSx3REFBZ0I7Ozs7OztJQUF2QixVQUF3QixhQUFtQyxFQUFFLElBQTJCLEVBQUUsb0JBQXFDO1FBQS9ILGlCQWtCQztRQWxCeUYscUNBQUEsRUFBQSw0QkFBcUM7UUFDM0gsSUFBSSxDQUFDLFlBQVksQ0FBQyxlQUFlLENBQUMsT0FBTzs7OztRQUFDLFVBQUEsQ0FBQztZQUN2QyxDQUFDLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQztZQUNyQixhQUFhLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFF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QyxDQUFDLENBQUMsSUFBSSxDQUFDOztnQkFDckQsNEJBQTRCLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUs7WUFDMUcsSUFBSSxDQUFDLGFBQWEsSUFBSSxJQUFJLENBQUMsT0FBTyxJQUFJLENBQUMsNEJBQTRCLEVBQUU7Z0JBQ2pFLElBQUksQ0FBQyxTQUFTLENBQUMsdUJBQXVCLEVBQUUsQ0FBQzthQUM1QztRQUNMLENBQUMsRUFBQyxDQUFDO0lBQ1AsQ0FBQzs7Z0JBNUVKLFVBQVU7Ozs7Z0JBTEgscUJBQXFCO2dCQUdyQixvQkFBb0I7O0lBK0U1QixvQ0FBQztDQUFBLEFBN0VELElBNkVDO1NBNUVZLDZCQUE2Qjs7Ozs7O0lBUW5CLHNEQUE0Qzs7Ozs7SUFBRSxxREFBMEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0luamVjdGFibGV9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQge1BpY2tsaXN0RmlsdGVyU2VydmljZX0gZnJvbSAnLi9waWNrbGlzdC1maWx0ZXIuc2VydmljZSc7XG5pbXBvcnQge1BpY2tsaXN0UGFuZUNvbXBvbmVudH0gZnJvbSAnLi4vcGFuZS9waWNrbGlzdC1wYW5lLmNvbXBvbmVudCc7XG5pbXBvcnQge0ZpbHRlcmFibGVTZWxlY3RMaXN0LCBQaWNrbGlzdFZhbHVlT3B0aW9ucywgVmFsdWVMaXN0T3B0aW9uLCBWYWx1ZVNldExpc3RPcHRpb259IGZyb20gJy4uL3BhbmUvcGlja2xpc3QtcGFuZS5tb2RlbCc7XG5pbXBvcnQge1BpY2tsaXN0U3RhdGVTZXJ2aWNlfSBmcm9tICcuL3BpY2tsaXN0LXN0YXRlLnNlcnZpY2UnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgUGlja2xpc3RWYWx1ZXNldE1vdmluZ1NlcnZpY2Uge1xuICAgIHB1YmxpYyBnZXQgdmFsdWVMaXN0KCk6IEZpbHRlcmFibGVTZWxlY3RMaXN0PFZhbHVlTGlzdE9wdGlvbj4ge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZVNlcnZpY2UudmFsdWVMaXN0O1xuICAgIH1cbiAgICBwdWJsaWMgZ2V0IHZhbHVlU2V0TGlzdCgpOiBGaWx0ZXJhYmxlU2VsZWN0TGlzdDxWYWx1ZVNldExpc3RPcHRpb24+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGVTZXJ2aWNlLnZhbHVlU2V0TGlzdDtcbiAgICB9XG5cbiAgICBwdWJsaWMgY29uc3RydWN0b3IocHJpdmF0ZSBmaWx0ZXJTZXJ2aWNlOiBQaWNrbGlzdEZpbHRlclNlcnZpY2UsIHByaXZhdGUgc3RhdGVTZXJ2aWNlOiBQaWNrbGlzdFN0YXRlU2VydmljZSkge31cblxuICAgIHB1YmxpYyBtb3ZlT3V0VmFsdWVzZXRzKG9wdGlvbnNUb01vdmU6IFBpY2tsaXN0VmFsdWVPcHRpb25zLCBwYW5lOiBQaWNrbGlzdFBhbmVDb21wb25lbnQsIHNob3VsZEJyZWFrVmFsdWVzZXRzOiBib29sZWFuID0gZmFsc2UpIHtcbiAgICAgICAgdGhpcy52YWx1ZVNldExpc3Quc2VsZWN0ZWRPcHRpb25zLmZvckVhY2godiA9PiB7XG4gICAgICAgICAgICB2LnNob3dWYWx1ZXMgPSBmYWxzZTtcbiAgICAgICAgICAgIG9wdGlvbnNUb01vdmUudmFsdWVTZXRzLnNldCh2LmNvZGUsIHYpO1xuICAgICAgICAgICAgdGhpcy52YWx1ZVNldExpc3Qub3B0aW9ucy5kZWxldGUodi5jb2RlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy52YWx1ZVNldExpc3QuZmlsdGVyZWRPcHRpb25zLmZvckVhY2godmFsdWVzZXQgPT4ge1xuICAgICAgICAgICAgaWYgKHZhbHVlc2V0LnNlbGVjdGVkIHx8IHZhbHVlc2V0LnN1YlZhbHVlc1NlbGVjdExpc3Quc2VsZWN0ZWRPcHRpb25zLnNpemUgPCAxKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc2hvdWxkQnJlYWtWYWx1ZXNldHMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJyZWFrVmFsdWVzZXQodmFsdWVzZXQsIG9wdGlvbnNUb01vdmUsIHBhbmUuY29tcGFuaW9uKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tb3ZlU3ViVmFsdWVzKHZhbHVlc2V0LnN1YlZhbHVlc1NlbGVjdExpc3Quc2VsZWN0ZWRPcHRpb25zLCBwYW5lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBicmVha1ZhbHVlc2V0KHZhbHVlc2V0OiBWYWx1ZVNldExpc3RPcHRpb24sIG9wdGlvbnNUb01vdmU6IFBpY2tsaXN0VmFsdWVPcHRpb25zLCBjb21wYW5pb25QYW5lOiBQaWNrbGlzdFBhbmVDb21wb25lbnQgfCBudWxsKSB7XG4gICAgICAgIHZhbHVlc2V0LnNob3dWYWx1ZXMgPSBmYWxzZTtcbiAgICAgICAgb3B0aW9uc1RvTW92ZS52YWx1ZVNldHMuc2V0KHZhbHVlc2V0LmNvZGUsIHZhbHVlc2V0KTtcbiAgICAgICAgdGhpcy52YWx1ZVNldExpc3Qub3B0aW9ucy5kZWxldGUodmFsdWVzZXQuY29kZSk7XG5cbiAgICAgICAgY29uc3QgdW5zZWxlY3RlZFN1YlZhbHVlcyA9IG5ldyBNYXA8c3RyaW5nLCBWYWx1ZUxpc3RPcHRpb24+KCk7XG4gICAgICAgIHZhbHVlc2V0LnN1YlZhbHVlc1NlbGVjdExpc3QuZmlsdGVyZWRPcHRpb25zXG4gICAgICAgICAgICAuZmlsdGVyKG8gPT4gIW8uc2VsZWN0ZWQpXG4gICAgICAgICAgICAuZm9yRWFjaChvID0+IHtcbiAgICAgICAgICAgICAgICB1bnNlbGVjdGVkU3ViVmFsdWVzLnNldChvLmNvZGUsIG5ldyBWYWx1ZUxpc3RPcHRpb24oby5vcHRpb24sIG8uY29kZSkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFjb21wYW5pb25QYW5lKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5tb3ZlU3ViVmFsdWVzKHVuc2VsZWN0ZWRTdWJWYWx1ZXMsIGNvbXBhbmlvblBhbmUpO1xuICAgIH1cblxuICAgIHByaXZhdGUgbW92ZVN1YlZhbHVlcyh2YWx1ZXNNYXA6IE1hcDxzdHJpbmcsIFZhbHVlTGlzdE9wdGlvbj4sIHNvdXJjZVBhbmU6IFBpY2tsaXN0UGFuZUNvbXBvbmVudCkge1xuICAgICAgICB0aGlzLnJlbW92ZVZhbHVlc0Zyb21QYW5lKHZhbHVlc01hcCwgc291cmNlUGFuZSk7XG4gICAgICAgIGlmICghc291cmNlUGFuZS5jb21wYW5pb24pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YWx1ZXNNYXAuZm9yRWFjaChvID0+IHtcbiAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1ub24tbnVsbC1hc3NlcnRpb25cbiAgICAgICAgICAgIHNvdXJjZVBhbmUuY29tcGFuaW9uIS52YWx1ZUxpc3Qub3B0aW9ucy5zZXQoby5jb2RlLCBuZXcgVmFsdWVMaXN0T3B0aW9uKG8ub3B0aW9uLCBvLmNvZGUpKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlcyBjb21wbGV4IGxvZ2ljIGZvciB3aGVuIG9uZSBwYW5lIGlzIHBhZ2VkLCBhbmQgd2Ugd2FudCB0byBrZWVwIHRoZSBcInggb2YgeVwiIGNvdW50cyBhY2N1cmF0ZSB3aXRob3V0IGEgcm91bmQgdHJpcCB0byB0aGUgc2VydmVyXG4gICAgICovXG4gICAgcHJpdmF0ZSByZW1vdmVWYWx1ZXNGcm9tUGFuZSh2YWx1ZXNNYXA6IE1hcDxzdHJpbmcsIFZhbHVlTGlzdE9wdGlvbj4sIHBhbmU6IFBpY2tsaXN0UGFuZUNvbXBvbmVudCkge1xuICAgICAgICBpZiAocGFuZS5pc1BhZ2VkKSB7XG4gICAgICAgICAgICAvLyBkb24ndCBib3RoZXIgdHJ5aW5nIHRvIHJlbW92ZSB2YWx1ZXMgb3IgZGVjcmVtZW50IGNvdW50IGZvciBvcHRpb25zIHRoYXQgYXJlIGFscmVhZHkgZmlsdGVyZWQgb3V0XG4gICAgICAgICAgICB0aGlzLmZpbHRlclNlcnZpY2UucHJlRmlsdGVyT3B0aW9uc0ZvclJlbW90ZU1vZGUodmFsdWVzTWFwLCBwYW5lLnZhbHVlTGlzdCk7XG4gICAgICAgIH1cblxuICAgICAgICB2YWx1ZXNNYXAuZm9yRWFjaCh2ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbkRlbGV0ZWQgPSBwYW5lLnZhbHVlTGlzdC5vcHRpb25zLmRlbGV0ZSh2LmNvZGUpO1xuICAgICAgICAgICAgY29uc3Qgb3B0aW9uQWxyZWFkeUluQ29tcGFuaW9uTGlzdCA9IHBhbmUuY29tcGFuaW9uID8gcGFuZS5jb21wYW5pb24udmFsdWVMaXN0Lm9wdGlvbnMuaGFzKHYuY29kZSkgOiBmYWxzZTtcbiAgICAgICAgICAgIGlmICghb3B0aW9uRGVsZXRlZCAmJiBwYW5lLmlzUGFnZWQgJiYgIW9wdGlvbkFscmVhZHlJbkNvbXBhbmlvbkxpc3QpIHtcbiAgICAgICAgICAgICAgICBwYW5lLnZhbHVlTGlzdC5hZGRpdGlvbmFsUmVtb3RlT3B0aW9ucy0tO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59XG4iXX0=