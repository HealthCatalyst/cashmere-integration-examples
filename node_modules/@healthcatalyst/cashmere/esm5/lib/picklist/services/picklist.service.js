/**
 * @fileoverview added by tsickle
 * Generated from: lib/picklist/services/picklist.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { WorkTrackerService } from '../../shared/work-tracker.service';
import { PicklistFilterService } from './picklist-filter.service';
import { PicklistValuesetMovingService } from './picklist-valueset-moving.service';
import { PicklistFilterLocalService } from './picklist-filter-local.service';
import { PicklistStateService } from './picklist-state.service';
import { PicklistValueOptions, ValueListOption } from '../pane/picklist-pane.model';
/**
 * Handles loading + moving items to/from list
 */
var PicklistService = /** @class */ (function () {
    function PicklistService(workTracker, filterService, localFilterService, valuesetMovingService, stateService) {
        this.workTracker = workTracker;
        this.filterService = filterService;
        this.localFilterService = localFilterService;
        this.valuesetMovingService = valuesetMovingService;
        this.stateService = stateService;
    }
    Object.defineProperty(PicklistService.prototype, "pane", {
        get: /**
         * @return {?}
         */
        function () {
            return this.stateService.pane;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PicklistService.prototype, "picklist", {
        get: /**
         * @return {?}
         */
        function () {
            return this.stateService.picklist;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PicklistService.prototype, "optionsSource", {
        get: /**
         * @return {?}
         */
        function () {
            return this.stateService.optionsSource;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PicklistService.prototype, "valueList", {
        get: /**
         * @return {?}
         */
        function () {
            return this.stateService.valueList;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PicklistService.prototype, "valueSetList", {
        get: /**
         * @return {?}
         */
        function () {
            return this.stateService.valueSetList;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PicklistService.prototype, "totalValuesCount", {
        get: /**
         * @return {?}
         */
        function () {
            return this.valueList.options.size + this.valueList.additionalRemoteOptions;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PicklistService.prototype, "totalValueSetsCount", {
        get: /**
         * @return {?}
         */
        function () {
            return this.valueSetList.options.size + this.valueSetList.additionalRemoteOptions;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} settings
     * @param {?} optionsSource
     * @param {?} pane
     * @return {?}
     */
    PicklistService.prototype.reset = /**
     * @param {?} settings
     * @param {?} optionsSource
     * @param {?} pane
     * @return {?}
     */
    function (settings, optionsSource, pane) {
        var _this = this;
        this.stateService.reset(settings, optionsSource, pane);
        this.filterService.reset();
        if (this.optionsSource.optionsAreLocal()) {
            this.stateService.updateValueList(this.optionsSource.values);
            this.stateService.updateValueSetList(this.optionsSource.valueSets);
            this.localFilterService.filter(this.valueList, this.filterService.searchTokens);
            this.localFilterService.filter(this.valueSetList, this.filterService.searchTokens);
        }
        else {
            /** @type {?} */
            var loading$ = this.workTracker.startObservable((/**
             * @return {?}
             */
            function () { return _this.filterService.filterOptionsRemote(); }));
            this.valueList.loadingOptions = loading$;
            this.valueSetList.loadingOptions = loading$;
        }
    };
    /**
     * @param {?} listOptions
     * @return {?}
     */
    PicklistService.prototype.addOptions = /**
     * @param {?} listOptions
     * @return {?}
     */
    function (listOptions) {
        var _this = this;
        if (!this.optionsSource.optionsAreLocal()) {
            this.filterService.preFilterOptionsForRemoteMode(listOptions.values, this.valueList);
            this.filterService.preFilterOptionsForRemoteMode(listOptions.valueSets, this.valueSetList);
        }
        listOptions.values.forEach((/**
         * @param {?} o
         * @return {?}
         */
        function (o) {
            _this.valueList.options.set(o.code, o);
        }));
        listOptions.valueSets.forEach((/**
         * @param {?} o
         * @return {?}
         */
        function (o) {
            _this.valueSetList.options.set(o.code, o);
        }));
        this.localFilterService.filter(this.valueList, this.filterService.searchTokens);
        this.localFilterService.filter(this.valueSetList, this.filterService.searchTokens);
        this.pane.selectNone();
    };
    /**
     * @param {?=} shouldBreakValuesets
     * @return {?}
     */
    PicklistService.prototype.moveOutSelectedOptions = /**
     * @param {?=} shouldBreakValuesets
     * @return {?}
     */
    function (shouldBreakValuesets) {
        var _this = this;
        if (shouldBreakValuesets === void 0) { shouldBreakValuesets = false; }
        /** @type {?} */
        var optionsToMove = new PicklistValueOptions();
        this.valueList.selectedOptions.forEach((/**
         * @param {?} o
         * @return {?}
         */
        function (o) {
            optionsToMove.values.set(o.code, o);
            _this.valueList.options.delete(o.code);
        }));
        this.valuesetMovingService.moveOutValuesets(optionsToMove, this.pane, shouldBreakValuesets);
        this.localFilterService.filter(this.valueList, this.filterService.searchTokens);
        this.localFilterService.filter(this.valueSetList, this.filterService.searchTokens);
        this.pane.selectNone();
        return optionsToMove;
    };
    /**
     * @param {?} valueset
     * @return {?}
     */
    PicklistService.prototype.loadValuesForValueset = /**
     * @param {?} valueset
     * @return {?}
     */
    function (valueset) {
        valueset.loadingValues = true;
        if (!this.optionsSource.getValuesForValueset) {
            return;
        }
        this.optionsSource.getValuesForValueset(valueset.option.code).subscribe((/**
         * @param {?} values
         * @return {?}
         */
        function (values) {
            valueset.subValuesSelectList.filteredOptions.length = 0;
            values.forEach((/**
             * @param {?} v
             * @return {?}
             */
            function (v) {
                valueset.subValuesSelectList.filteredOptions.push(new ValueListOption(v, v.code));
            }));
        }), (/**
         * @return {?}
         */
        function () {
            console.warn('Unable to load values for valueset');
            valueset.showValues = false;
        }), (/**
         * @return {?}
         */
        function () {
            valueset.loadingValues = false;
        }));
    };
    PicklistService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    PicklistService.ctorParameters = function () { return [
        { type: WorkTrackerService },
        { type: PicklistFilterService },
        { type: PicklistFilterLocalService },
        { type: PicklistValuesetMovingService },
        { type: PicklistStateService }
    ]; };
    return PicklistService;
}());
export { PicklistService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    PicklistService.prototype.workTracker;
    /**
     * @type {?}
     * @private
     */
    PicklistService.prototype.filterService;
    /**
     * @type {?}
     * @private
     */
    PicklistService.prototype.localFilterService;
    /**
     * @type {?}
     * @private
     */
    PicklistService.prototype.valuesetMovingService;
    /**
     * @type {?}
     * @private
     */
    PicklistService.prototype.stateService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGlja2xpc3Quc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BoZWFsdGhjYXRhbHlzdC9jYXNobWVyZS8iLCJzb3VyY2VzIjpbImxpYi9waWNrbGlzdC9zZXJ2aWNlcy9waWNrbGlzdC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUV6QyxPQUFPLEVBQUMsa0JBQWtCLEVBQUMsTUFBTSxtQ0FBbUMsQ0FBQztBQUNyRSxPQUFPLEVBQUMscUJBQXFCLEVBQUMsTUFBTSwyQkFBMkIsQ0FBQztBQUNoRSxPQUFPLEVBQUMsNkJBQTZCLEVBQUMsTUFBTSxvQ0FBb0MsQ0FBQztBQUNqRixPQUFPLEVBQUMsMEJBQTBCLEVBQUMsTUFBTSxpQ0FBaUMsQ0FBQztBQUMzRSxPQUFPLEVBQUMsb0JBQW9CLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQUc5RCxPQUFPLEVBQXVCLG9CQUFvQixFQUFFLGVBQWUsRUFBcUIsTUFBTSw2QkFBNkIsQ0FBQzs7OztBQUs1SDtJQXdCSSx5QkFDWSxXQUErQixFQUMvQixhQUFvQyxFQUNwQyxrQkFBOEMsRUFDOUMscUJBQW9ELEVBQ3BELFlBQWtDO1FBSmxDLGdCQUFXLEdBQVgsV0FBVyxDQUFvQjtRQUMvQixrQkFBYSxHQUFiLGFBQWEsQ0FBdUI7UUFDcEMsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUE0QjtRQUM5QywwQkFBcUIsR0FBckIscUJBQXFCLENBQStCO1FBQ3BELGlCQUFZLEdBQVosWUFBWSxDQUFzQjtJQUMzQyxDQUFDO0lBNUJKLHNCQUFXLGlDQUFJOzs7O1FBQWY7WUFDSSxPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDO1FBQ2xDLENBQUM7OztPQUFBO0lBQ0Qsc0JBQVcscUNBQVE7Ozs7UUFBbkI7WUFDSSxPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDO1FBQ3RDLENBQUM7OztPQUFBO0lBQ0Qsc0JBQVcsMENBQWE7Ozs7UUFBeEI7WUFDSSxPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsYUFBYSxDQUFDO1FBQzNDLENBQUM7OztPQUFBO0lBQ0Qsc0JBQVcsc0NBQVM7Ozs7UUFBcEI7WUFDSSxPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDO1FBQ3ZDLENBQUM7OztPQUFBO0lBQ0Qsc0JBQVcseUNBQVk7Ozs7UUFBdkI7WUFDSSxPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDO1FBQzFDLENBQUM7OztPQUFBO0lBQ0Qsc0JBQVcsNkNBQWdCOzs7O1FBQTNCO1lBQ0ksT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyx1QkFBdUIsQ0FBQztRQUNoRixDQUFDOzs7T0FBQTtJQUNELHNCQUFXLGdEQUFtQjs7OztRQUE5QjtZQUNJLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsdUJBQXVCLENBQUM7UUFDdEYsQ0FBQzs7O09BQUE7Ozs7Ozs7SUFVTSwrQkFBSzs7Ozs7O0lBQVosVUFBYSxRQUEwQixFQUFFLGFBQW9DLEVBQUUsSUFBMkI7UUFBMUcsaUJBY0M7UUFiRyxJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsYUFBYSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3ZELElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLENBQUM7UUFFM0IsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLGVBQWUsRUFBRSxFQUFFO1lBQ3RDLElBQUksQ0FBQyxZQUFZLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDN0QsSUFBSSxDQUFDLFlBQVksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ25FLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ2hGLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDO1NBQ3RGO2FBQU07O2dCQUNHLFFBQVEsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLGVBQWU7OztZQUFDLGNBQU0sT0FBQSxLQUFJLENBQUMsYUFBYSxDQUFDLG1CQUFtQixFQUFFLEVBQXhDLENBQXdDLEVBQUM7WUFDakcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxjQUFjLEdBQUcsUUFBUSxDQUFDO1lBQ3pDLElBQUksQ0FBQyxZQUFZLENBQUMsY0FBYyxHQUFHLFFBQVEsQ0FBQztTQUMvQztJQUNMLENBQUM7Ozs7O0lBRU0sb0NBQVU7Ozs7SUFBakIsVUFBa0IsV0FBaUM7UUFBbkQsaUJBZUM7UUFkRyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxlQUFlLEVBQUUsRUFBRTtZQUN2QyxJQUFJLENBQUMsYUFBYSxDQUFDLDZCQUE2QixDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3JGLElBQUksQ0FBQyxhQUFhLENBQUMsNkJBQTZCLENBQUMsV0FBVyxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7U0FDOUY7UUFFRCxXQUFXLENBQUMsTUFBTSxDQUFDLE9BQU87Ozs7UUFBQyxVQUFBLENBQUM7WUFDeEIsS0FBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDMUMsQ0FBQyxFQUFDLENBQUM7UUFDSCxXQUFXLENBQUMsU0FBUyxDQUFDLE9BQU87Ozs7UUFBQyxVQUFBLENBQUM7WUFDM0IsS0FBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDN0MsQ0FBQyxFQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsa0JBQWtCLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUNoRixJQUFJLENBQUMsa0JBQWtCLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUNuRixJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBQzNCLENBQUM7Ozs7O0lBRU0sZ0RBQXNCOzs7O0lBQTdCLFVBQThCLG9CQUFxQztRQUFuRSxpQkFhQztRQWI2QixxQ0FBQSxFQUFBLDRCQUFxQzs7WUFDM0QsYUFBYSxHQUFHLElBQUksb0JBQW9CLEVBQUU7UUFDOUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUMsT0FBTzs7OztRQUFDLFVBQUEsQ0FBQztZQUNwQyxhQUFhLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ3BDLEtBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDMUMsQ0FBQyxFQUFDLENBQUM7UUFFSCxJQUFJLENBQUMscUJBQXFCLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsb0JBQW9CLENBQUMsQ0FBQztRQUU1RixJQUFJLENBQUMsa0JBQWtCLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUNoRixJQUFJLENBQUMsa0JBQWtCLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUNuRixJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ3ZCLE9BQU8sYUFBYSxDQUFDO0lBQ3pCLENBQUM7Ozs7O0lBRU0sK0NBQXFCOzs7O0lBQTVCLFVBQTZCLFFBQTRCO1FBQ3JELFFBQVEsQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDO1FBQzlCLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLG9CQUFvQixFQUFFO1lBQzFDLE9BQU87U0FDVjtRQUNELElBQUksQ0FBQyxhQUFhLENBQUMsb0JBQW9CLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxTQUFTOzs7O1FBQ25FLFVBQUEsTUFBTTtZQUNGLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxlQUFlLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztZQUN4RCxNQUFNLENBQUMsT0FBTzs7OztZQUFDLFVBQUEsQ0FBQztnQkFDWixRQUFRLENBQUMsbUJBQW1CLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxJQUFJLGVBQWUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDdEYsQ0FBQyxFQUFDLENBQUM7UUFDUCxDQUFDOzs7UUFDRDtZQUNJLE9BQU8sQ0FBQyxJQUFJLENBQUMsb0NBQW9DLENBQUMsQ0FBQztZQUNuRCxRQUFRLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQztRQUNoQyxDQUFDOzs7UUFDRDtZQUNJLFFBQVEsQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDO1FBQ25DLENBQUMsRUFDSixDQUFDO0lBQ04sQ0FBQzs7Z0JBcEdKLFVBQVU7Ozs7Z0JBWkgsa0JBQWtCO2dCQUNsQixxQkFBcUI7Z0JBRXJCLDBCQUEwQjtnQkFEMUIsNkJBQTZCO2dCQUU3QixvQkFBb0I7O0lBNkc1QixzQkFBQztDQUFBLEFBckdELElBcUdDO1NBcEdZLGVBQWU7Ozs7OztJQXdCcEIsc0NBQXVDOzs7OztJQUN2Qyx3Q0FBNEM7Ozs7O0lBQzVDLDZDQUFzRDs7Ozs7SUFDdEQsZ0RBQTREOzs7OztJQUM1RCx1Q0FBMEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0luamVjdGFibGV9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQge1dvcmtUcmFja2VyU2VydmljZX0gZnJvbSAnLi4vLi4vc2hhcmVkL3dvcmstdHJhY2tlci5zZXJ2aWNlJztcbmltcG9ydCB7UGlja2xpc3RGaWx0ZXJTZXJ2aWNlfSBmcm9tICcuL3BpY2tsaXN0LWZpbHRlci5zZXJ2aWNlJztcbmltcG9ydCB7UGlja2xpc3RWYWx1ZXNldE1vdmluZ1NlcnZpY2V9IGZyb20gJy4vcGlja2xpc3QtdmFsdWVzZXQtbW92aW5nLnNlcnZpY2UnO1xuaW1wb3J0IHtQaWNrbGlzdEZpbHRlckxvY2FsU2VydmljZX0gZnJvbSAnLi9waWNrbGlzdC1maWx0ZXItbG9jYWwuc2VydmljZSc7XG5pbXBvcnQge1BpY2tsaXN0U3RhdGVTZXJ2aWNlfSBmcm9tICcuL3BpY2tsaXN0LXN0YXRlLnNlcnZpY2UnO1xuaW1wb3J0IHtQaWNrbGlzdFBhbmVDb21wb25lbnR9IGZyb20gJy4uL3BhbmUvcGlja2xpc3QtcGFuZS5jb21wb25lbnQnO1xuaW1wb3J0IHtQaWNrbGlzdE9wdGlvbnNTb3VyY2UsIFBpY2tsaXN0U2V0dGluZ3N9IGZyb20gJy4uL3BpY2tsaXN0Lm1vZGVsJztcbmltcG9ydCB7RmlsdGVyYWJsZVNlbGVjdExpc3QsIFBpY2tsaXN0VmFsdWVPcHRpb25zLCBWYWx1ZUxpc3RPcHRpb24sIFZhbHVlU2V0TGlzdE9wdGlvbn0gZnJvbSAnLi4vcGFuZS9waWNrbGlzdC1wYW5lLm1vZGVsJztcblxuLyoqXG4gKiBIYW5kbGVzIGxvYWRpbmcgKyBtb3ZpbmcgaXRlbXMgdG8vZnJvbSBsaXN0XG4gKi9cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBQaWNrbGlzdFNlcnZpY2Uge1xuICAgIHB1YmxpYyBnZXQgcGFuZSgpOiBQaWNrbGlzdFBhbmVDb21wb25lbnQge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZVNlcnZpY2UucGFuZTtcbiAgICB9XG4gICAgcHVibGljIGdldCBwaWNrbGlzdCgpOiBQaWNrbGlzdFNldHRpbmdzIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGVTZXJ2aWNlLnBpY2tsaXN0O1xuICAgIH1cbiAgICBwdWJsaWMgZ2V0IG9wdGlvbnNTb3VyY2UoKTogUGlja2xpc3RPcHRpb25zU291cmNlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGVTZXJ2aWNlLm9wdGlvbnNTb3VyY2U7XG4gICAgfVxuICAgIHB1YmxpYyBnZXQgdmFsdWVMaXN0KCk6IEZpbHRlcmFibGVTZWxlY3RMaXN0PFZhbHVlTGlzdE9wdGlvbj4ge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZVNlcnZpY2UudmFsdWVMaXN0O1xuICAgIH1cbiAgICBwdWJsaWMgZ2V0IHZhbHVlU2V0TGlzdCgpOiBGaWx0ZXJhYmxlU2VsZWN0TGlzdDxWYWx1ZVNldExpc3RPcHRpb24+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGVTZXJ2aWNlLnZhbHVlU2V0TGlzdDtcbiAgICB9XG4gICAgcHVibGljIGdldCB0b3RhbFZhbHVlc0NvdW50KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLnZhbHVlTGlzdC5vcHRpb25zLnNpemUgKyB0aGlzLnZhbHVlTGlzdC5hZGRpdGlvbmFsUmVtb3RlT3B0aW9ucztcbiAgICB9XG4gICAgcHVibGljIGdldCB0b3RhbFZhbHVlU2V0c0NvdW50KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLnZhbHVlU2V0TGlzdC5vcHRpb25zLnNpemUgKyB0aGlzLnZhbHVlU2V0TGlzdC5hZGRpdGlvbmFsUmVtb3RlT3B0aW9ucztcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSB3b3JrVHJhY2tlcjogV29ya1RyYWNrZXJTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGZpbHRlclNlcnZpY2U6IFBpY2tsaXN0RmlsdGVyU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBsb2NhbEZpbHRlclNlcnZpY2U6IFBpY2tsaXN0RmlsdGVyTG9jYWxTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIHZhbHVlc2V0TW92aW5nU2VydmljZTogUGlja2xpc3RWYWx1ZXNldE1vdmluZ1NlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgc3RhdGVTZXJ2aWNlOiBQaWNrbGlzdFN0YXRlU2VydmljZVxuICAgICkge31cblxuICAgIHB1YmxpYyByZXNldChzZXR0aW5nczogUGlja2xpc3RTZXR0aW5ncywgb3B0aW9uc1NvdXJjZTogUGlja2xpc3RPcHRpb25zU291cmNlLCBwYW5lOiBQaWNrbGlzdFBhbmVDb21wb25lbnQpIHtcbiAgICAgICAgdGhpcy5zdGF0ZVNlcnZpY2UucmVzZXQoc2V0dGluZ3MsIG9wdGlvbnNTb3VyY2UsIHBhbmUpO1xuICAgICAgICB0aGlzLmZpbHRlclNlcnZpY2UucmVzZXQoKTtcblxuICAgICAgICBpZiAodGhpcy5vcHRpb25zU291cmNlLm9wdGlvbnNBcmVMb2NhbCgpKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlU2VydmljZS51cGRhdGVWYWx1ZUxpc3QodGhpcy5vcHRpb25zU291cmNlLnZhbHVlcyk7XG4gICAgICAgICAgICB0aGlzLnN0YXRlU2VydmljZS51cGRhdGVWYWx1ZVNldExpc3QodGhpcy5vcHRpb25zU291cmNlLnZhbHVlU2V0cyk7XG4gICAgICAgICAgICB0aGlzLmxvY2FsRmlsdGVyU2VydmljZS5maWx0ZXIodGhpcy52YWx1ZUxpc3QsIHRoaXMuZmlsdGVyU2VydmljZS5zZWFyY2hUb2tlbnMpO1xuICAgICAgICAgICAgdGhpcy5sb2NhbEZpbHRlclNlcnZpY2UuZmlsdGVyKHRoaXMudmFsdWVTZXRMaXN0LCB0aGlzLmZpbHRlclNlcnZpY2Uuc2VhcmNoVG9rZW5zKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGxvYWRpbmckID0gdGhpcy53b3JrVHJhY2tlci5zdGFydE9ic2VydmFibGUoKCkgPT4gdGhpcy5maWx0ZXJTZXJ2aWNlLmZpbHRlck9wdGlvbnNSZW1vdGUoKSk7XG4gICAgICAgICAgICB0aGlzLnZhbHVlTGlzdC5sb2FkaW5nT3B0aW9ucyA9IGxvYWRpbmckO1xuICAgICAgICAgICAgdGhpcy52YWx1ZVNldExpc3QubG9hZGluZ09wdGlvbnMgPSBsb2FkaW5nJDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBhZGRPcHRpb25zKGxpc3RPcHRpb25zOiBQaWNrbGlzdFZhbHVlT3B0aW9ucykge1xuICAgICAgICBpZiAoIXRoaXMub3B0aW9uc1NvdXJjZS5vcHRpb25zQXJlTG9jYWwoKSkge1xuICAgICAgICAgICAgdGhpcy5maWx0ZXJTZXJ2aWNlLnByZUZpbHRlck9wdGlvbnNGb3JSZW1vdGVNb2RlKGxpc3RPcHRpb25zLnZhbHVlcywgdGhpcy52YWx1ZUxpc3QpO1xuICAgICAgICAgICAgdGhpcy5maWx0ZXJTZXJ2aWNlLnByZUZpbHRlck9wdGlvbnNGb3JSZW1vdGVNb2RlKGxpc3RPcHRpb25zLnZhbHVlU2V0cywgdGhpcy52YWx1ZVNldExpc3QpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGlzdE9wdGlvbnMudmFsdWVzLmZvckVhY2gobyA9PiB7XG4gICAgICAgICAgICB0aGlzLnZhbHVlTGlzdC5vcHRpb25zLnNldChvLmNvZGUsIG8pO1xuICAgICAgICB9KTtcbiAgICAgICAgbGlzdE9wdGlvbnMudmFsdWVTZXRzLmZvckVhY2gobyA9PiB7XG4gICAgICAgICAgICB0aGlzLnZhbHVlU2V0TGlzdC5vcHRpb25zLnNldChvLmNvZGUsIG8pO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5sb2NhbEZpbHRlclNlcnZpY2UuZmlsdGVyKHRoaXMudmFsdWVMaXN0LCB0aGlzLmZpbHRlclNlcnZpY2Uuc2VhcmNoVG9rZW5zKTtcbiAgICAgICAgdGhpcy5sb2NhbEZpbHRlclNlcnZpY2UuZmlsdGVyKHRoaXMudmFsdWVTZXRMaXN0LCB0aGlzLmZpbHRlclNlcnZpY2Uuc2VhcmNoVG9rZW5zKTtcbiAgICAgICAgdGhpcy5wYW5lLnNlbGVjdE5vbmUoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgbW92ZU91dFNlbGVjdGVkT3B0aW9ucyhzaG91bGRCcmVha1ZhbHVlc2V0czogYm9vbGVhbiA9IGZhbHNlKTogUGlja2xpc3RWYWx1ZU9wdGlvbnMge1xuICAgICAgICBsZXQgb3B0aW9uc1RvTW92ZSA9IG5ldyBQaWNrbGlzdFZhbHVlT3B0aW9ucygpO1xuICAgICAgICB0aGlzLnZhbHVlTGlzdC5zZWxlY3RlZE9wdGlvbnMuZm9yRWFjaChvID0+IHtcbiAgICAgICAgICAgIG9wdGlvbnNUb01vdmUudmFsdWVzLnNldChvLmNvZGUsIG8pO1xuICAgICAgICAgICAgdGhpcy52YWx1ZUxpc3Qub3B0aW9ucy5kZWxldGUoby5jb2RlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy52YWx1ZXNldE1vdmluZ1NlcnZpY2UubW92ZU91dFZhbHVlc2V0cyhvcHRpb25zVG9Nb3ZlLCB0aGlzLnBhbmUsIHNob3VsZEJyZWFrVmFsdWVzZXRzKTtcblxuICAgICAgICB0aGlzLmxvY2FsRmlsdGVyU2VydmljZS5maWx0ZXIodGhpcy52YWx1ZUxpc3QsIHRoaXMuZmlsdGVyU2VydmljZS5zZWFyY2hUb2tlbnMpO1xuICAgICAgICB0aGlzLmxvY2FsRmlsdGVyU2VydmljZS5maWx0ZXIodGhpcy52YWx1ZVNldExpc3QsIHRoaXMuZmlsdGVyU2VydmljZS5zZWFyY2hUb2tlbnMpO1xuICAgICAgICB0aGlzLnBhbmUuc2VsZWN0Tm9uZSgpO1xuICAgICAgICByZXR1cm4gb3B0aW9uc1RvTW92ZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgbG9hZFZhbHVlc0ZvclZhbHVlc2V0KHZhbHVlc2V0OiBWYWx1ZVNldExpc3RPcHRpb24pIHtcbiAgICAgICAgdmFsdWVzZXQubG9hZGluZ1ZhbHVlcyA9IHRydWU7XG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zU291cmNlLmdldFZhbHVlc0ZvclZhbHVlc2V0KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5vcHRpb25zU291cmNlLmdldFZhbHVlc0ZvclZhbHVlc2V0KHZhbHVlc2V0Lm9wdGlvbi5jb2RlKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICB2YWx1ZXMgPT4ge1xuICAgICAgICAgICAgICAgIHZhbHVlc2V0LnN1YlZhbHVlc1NlbGVjdExpc3QuZmlsdGVyZWRPcHRpb25zLmxlbmd0aCA9IDA7XG4gICAgICAgICAgICAgICAgdmFsdWVzLmZvckVhY2godiA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlc2V0LnN1YlZhbHVlc1NlbGVjdExpc3QuZmlsdGVyZWRPcHRpb25zLnB1c2gobmV3IFZhbHVlTGlzdE9wdGlvbih2LCB2LmNvZGUpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdVbmFibGUgdG8gbG9hZCB2YWx1ZXMgZm9yIHZhbHVlc2V0Jyk7XG4gICAgICAgICAgICAgICAgdmFsdWVzZXQuc2hvd1ZhbHVlcyA9IGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgICAgICB2YWx1ZXNldC5sb2FkaW5nVmFsdWVzID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxufVxuIl19