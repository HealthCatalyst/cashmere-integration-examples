/**
 * @fileoverview added by tsickle
 * Generated from: lib/input/input.directive.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, ElementRef, HostBinding, HostListener, Input, Optional, Self, forwardRef } from '@angular/core';
import { parseBooleanAttribute } from '../util';
import { HcFormControlComponent } from '../form-field/hc-form-control.component';
import { FormGroupDirective, NgControl, NgForm } from '@angular/forms';
/**
 * @param {?} type
 * @return {?}
 */
export function getUnsupportedHCInputType(type) {
    return new Error(`hc-input doesn't support the following type: ${type}`);
}
/** @type {?} */
let uniqueId = 1;
/** @type {?} */
const unsupportedTypes = ['button', 'checkbox', 'file', 'hidden', 'image', 'radio', 'reset'];
/**
 * Directive that allows a native input to work inside a HcFormFieldComponent
 */
export class InputDirective extends HcFormControlComponent {
    /**
     * @param {?} _elementRef
     * @param {?} _parentForm
     * @param {?} _parentFormGroup
     * @param {?} _ngControl
     */
    constructor(_elementRef, _parentForm, _parentFormGroup, _ngControl) {
        super();
        this._elementRef = _elementRef;
        this._ngControl = _ngControl;
        this._focused = false;
        this._uniqueInputId = `hc-input-${uniqueId++}`;
        this._componentId = this._uniqueInputId;
        this._type = 'input';
        this._readonly = false;
        this._hostHcInputClass = true;
        this._form = _parentForm || _parentFormGroup;
    }
    /**
     * Input type of the element.
     * @return {?}
     */
    get type() {
        return this._type;
    }
    /**
     * @param {?} type
     * @return {?}
     */
    set type(type) {
        if (unsupportedTypes.indexOf(type) > -1) {
            throw getUnsupportedHCInputType(type);
        }
        this._type = type;
        // textArea doesn't have type property
        if (!this._isTextArea()) {
            this._elementRef.nativeElement.type = this.type;
        }
    }
    /**
     * Element id.
     * @return {?}
     */
    get id() {
        return this._componentId || this._uniqueInputId;
    }
    /**
     * @param {?} idVal
     * @return {?}
     */
    set id(idVal) {
        this._componentId = idVal ? idVal : this._uniqueInputId;
    }
    /**
     * Sets input element as readonly.
     * @return {?}
     */
    get readonly() {
        return this._readonly;
    }
    /**
     * @param {?} isReadOnly
     * @return {?}
     */
    set readonly(isReadOnly) {
        this._readonly = parseBooleanAttribute(isReadOnly);
    }
    /**
     * Disables the input element.
     * @return {?}
     */
    get disabled() {
        if (this._ngControl && this._ngControl.disabled) {
            return this._ngControl.disabled;
        }
        return this._isDisabled;
    }
    /**
     * @param {?} disabledInput
     * @return {?}
     */
    set disabled(disabledInput) {
        this._isDisabled = parseBooleanAttribute(disabledInput);
        if (this._focused) {
            this._focused = false;
            // TODO: trigger state change
        }
    }
    /**
     * Sets required attribute.
     * @return {?}
     */
    get required() {
        return this._isRequired;
    }
    /**
     * @param {?} requiredInput
     * @return {?}
     */
    set required(requiredInput) {
        this._isRequired = parseBooleanAttribute(requiredInput);
    }
    /**
     * @return {?}
     */
    get _hostId() {
        return this._componentId || this._uniqueInputId;
    }
    /**
     * @return {?}
     */
    get _hostReadOnly() {
        return this.readonly;
    }
    /**
     * @return {?}
     */
    get _hostDisabled() {
        return this.disabled;
    }
    /**
     * @return {?}
     */
    get _hostRequired() {
        return this._isRequired;
    }
    /**
     * @return {?}
     */
    _onBlur() {
        this._changeFocus(false);
    }
    /**
     * @return {?}
     */
    _onFocus() {
        this._changeFocus(true);
    }
    /**
     * Sets value of the input element
     * @return {?}
     */
    get value() {
        return this._elementRef.nativeElement.value;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set value(value) {
        if (value !== this.value) {
            this._elementRef.nativeElement.value = value;
        }
    }
    /**
     * @return {?}
     */
    _inputEvent() {
        // causes angular to run change detection on input event
    }
    /**
     * @return {?}
     */
    ngDoCheck() {
        // This needs to be checked every cycle because we can't subscribe to form submissions
        if (this._ngControl) {
            this._updateErrorState();
        }
    }
    /**
     * Sets the focus on the input element
     * @return {?}
     */
    focus() {
        this._elementRef.nativeElement.focus();
    }
    /**
     * @private
     * @param {?} focused
     * @return {?}
     */
    _changeFocus(focused) {
        if (this._focused !== focused && !this.readonly) {
            this._focused = focused;
            // TODO: trigger state change
        }
    }
    /**
     * @private
     * @return {?}
     */
    _isTextArea() {
        return this._elementRef.nativeElement.nodeName.toLowerCase() !== 'textarea';
    }
    /**
     * @private
     * @return {?}
     */
    _updateErrorState() {
        /** @type {?} */
        const oldState = this._errorState;
        // TODO: this could be abstracted out as an @Input() if we need this to be configurable
        /** @type {?} */
        const newState = !!(this._ngControl &&
            this._ngControl.invalid &&
            (this._ngControl.touched || (this._form && this._form.submitted)));
        if (oldState !== newState) {
            this._errorState = newState;
        }
    }
}
InputDirective.decorators = [
    { type: Directive, args: [{
                selector: '[hcInput]',
                providers: [{ provide: HcFormControlComponent, useExisting: forwardRef((/**
                         * @return {?}
                         */
                        () => InputDirective)) }]
            },] }
];
/** @nocollapse */
InputDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: NgForm, decorators: [{ type: Optional }] },
    { type: FormGroupDirective, decorators: [{ type: Optional }] },
    { type: NgControl, decorators: [{ type: Optional }, { type: Self }] }
];
InputDirective.propDecorators = {
    type: [{ type: Input }],
    id: [{ type: Input }],
    readonly: [{ type: Input }],
    disabled: [{ type: Input }],
    required: [{ type: Input }],
    _hostHcInputClass: [{ type: HostBinding, args: ['class.hc-input',] }],
    _hostId: [{ type: HostBinding, args: ['attr.id',] }],
    _hostReadOnly: [{ type: HostBinding, args: ['readonly',] }],
    _hostDisabled: [{ type: HostBinding, args: ['disabled',] }],
    _hostRequired: [{ type: HostBinding, args: ['required',] }],
    _onBlur: [{ type: HostListener, args: ['blur',] }],
    _onFocus: [{ type: HostListener, args: ['focus',] }],
    value: [{ type: Input }],
    _inputEvent: [{ type: HostListener, args: ['input',] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    InputDirective.prototype._focused;
    /**
     * @type {?}
     * @private
     */
    InputDirective.prototype._uniqueInputId;
    /**
     * @type {?}
     * @private
     */
    InputDirective.prototype._form;
    /** @type {?} */
    InputDirective.prototype._componentId;
    /**
     * @type {?}
     * @private
     */
    InputDirective.prototype._type;
    /**
     * @type {?}
     * @private
     */
    InputDirective.prototype._readonly;
    /** @type {?} */
    InputDirective.prototype._hostHcInputClass;
    /**
     * @type {?}
     * @private
     */
    InputDirective.prototype._elementRef;
    /** @type {?} */
    InputDirective.prototype._ngControl;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXQuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGhlYWx0aGNhdGFseXN0L2Nhc2htZXJlLyIsInNvdXJjZXMiOlsibGliL2lucHV0L2lucHV0LmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBQyxTQUFTLEVBQVcsVUFBVSxFQUFFLFdBQVcsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQzNILE9BQU8sRUFBQyxxQkFBcUIsRUFBQyxNQUFNLFNBQVMsQ0FBQztBQUM5QyxPQUFPLEVBQUMsc0JBQXNCLEVBQUMsTUFBTSx5Q0FBeUMsQ0FBQztBQUMvRSxPQUFPLEVBQUMsa0JBQWtCLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBQyxNQUFNLGdCQUFnQixDQUFDOzs7OztBQUVyRSxNQUFNLFVBQVUseUJBQXlCLENBQUMsSUFBWTtJQUNsRCxPQUFPLElBQUksS0FBSyxDQUFDLGdEQUFnRCxJQUFJLEVBQUUsQ0FBQyxDQUFDO0FBQzdFLENBQUM7O0lBRUcsUUFBUSxHQUFHLENBQUM7O01BRVYsZ0JBQWdCLEdBQUcsQ0FBQyxRQUFRLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxPQUFPLENBQUM7Ozs7QUFPNUYsTUFBTSxPQUFPLGNBQWUsU0FBUSxzQkFBc0I7Ozs7Ozs7SUErSHRELFlBQ1ksV0FBdUIsRUFDbkIsV0FBbUIsRUFDbkIsZ0JBQW9DLEVBR3pDLFVBQXFCO1FBRTVCLEtBQUssRUFBRSxDQUFDO1FBUEEsZ0JBQVcsR0FBWCxXQUFXLENBQVk7UUFLeEIsZUFBVSxHQUFWLFVBQVUsQ0FBVztRQXBJeEIsYUFBUSxHQUFHLEtBQUssQ0FBQztRQUNqQixtQkFBYyxHQUFHLFlBQVksUUFBUSxFQUFFLEVBQUUsQ0FBQztRQUdsRCxpQkFBWSxHQUFHLElBQUksQ0FB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UUFBUSxLQUFLLFFBQVEsRUFBRTtZQUN2QixJQUFJLENBQUMsV0FBVyxHQUFHLFFBQVEsQ0FBQztTQUMvQjtJQUNMLENBQUM7OztZQXBMSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLFdBQVc7Z0JBQ3JCLFNBQVMsRUFBRSxDQUFDLEVBQUMsT0FBTyxFQUFFLHNCQUFzQixFQUFFLFdBQVcsRUFBRSxVQUFVOzs7d0JBQUMsR0FBRyxFQUFFLENBQUMsY0FBYyxFQUFDLEVBQUMsQ0FBQzthQUNoRzs7OztZQWpCMkIsVUFBVTtZQUdDLE1BQU0sdUJBZ0pwQyxRQUFRO1lBaEpULGtCQUFrQix1QkFpSmpCLFFBQVE7WUFqSlcsU0FBUyx1QkFrSjVCLFFBQVEsWUFDUixJQUFJOzs7bUJBNUhSLEtBQUs7aUJBb0JMLEtBQUs7dUJBVUwsS0FBSzt1QkFZTCxLQUFLO3VCQWtCTCxLQUFLO2dDQVNMLFdBQVcsU0FBQyxnQkFBZ0I7c0JBRzVCLFdBQVcsU0FBQyxTQUFTOzRCQUtyQixXQUFXLFNBQUMsVUFBVTs0QkFLdEIsV0FBVyxTQUFDLFVBQVU7NEJBS3RCLFdBQVcsU0FBQyxVQUFVO3NCQUt0QixZQUFZLFNBQUMsTUFBTTt1QkFLbkIsWUFBWSxTQUFDLE9BQU87b0JBTXBCLEtBQUs7MEJBV0wsWUFBWSxTQUFDLE9BQU87Ozs7Ozs7SUF6SHJCLGtDQUF5Qjs7Ozs7SUFDekIsd0NBQWtEOzs7OztJQUNsRCwrQkFBa0Q7O0lBRWxELHNDQUFtQzs7Ozs7SUFvQm5DLCtCQUF3Qjs7Ozs7SUFzQnhCLG1DQUEwQjs7SUE4QjFCLDJDQUN5Qjs7Ozs7SUFrRHJCLHFDQUErQjs7SUFHL0Isb0NBRTRCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtEaXJlY3RpdmUsIERvQ2hlY2ssIEVsZW1lbnRSZWYsIEhvc3RCaW5kaW5nLCBIb3N0TGlzdGVuZXIsIElucHV0LCBPcHRpb25hbCwgU2VsZiwgZm9yd2FyZFJlZn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge3BhcnNlQm9vbGVhbkF0dHJpYnV0ZX0gZnJvbSAnLi4vdXRpbCc7XG5pbXBvcnQge0hjRm9ybUNvbnRyb2xDb21wb25lbnR9IGZyb20gJy4uL2Zvcm0tZmllbGQvaGMtZm9ybS1jb250cm9sLmNvbXBvbmVudCc7XG5pbXBvcnQge0Zvcm1Hcm91cERpcmVjdGl2ZSwgTmdDb250cm9sLCBOZ0Zvcm19IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcblxuZXhwb3J0IGZ1bmN0aW9uIGdldFVuc3VwcG9ydGVkSENJbnB1dFR5cGUodHlwZTogc3RyaW5nKTogRXJyb3Ige1xuICAgIHJldHVybiBuZXcgRXJyb3IoYGhjLWlucHV0IGRvZXNuJ3Qgc3VwcG9ydCB0aGUgZm9sbG93aW5nIHR5cGU6ICR7dHlwZX1gKTtcbn1cblxubGV0IHVuaXF1ZUlkID0gMTtcblxuY29uc3QgdW5zdXBwb3J0ZWRUeXBlcyA9IFsnYnV0dG9uJywgJ2NoZWNrYm94JywgJ2ZpbGUnLCAnaGlkZGVuJywgJ2ltYWdlJywgJ3JhZGlvJywgJ3Jlc2V0J107XG5cbi8qKiBEaXJlY3RpdmUgdGhhdCBhbGxvd3MgYSBuYXRpdmUgaW5wdXQgdG8gd29yayBpbnNpZGUgYSBIY0Zvcm1GaWVsZENvbXBvbmVudCAqL1xuQERpcmVjdGl2ZSh7XG4gICAgc2VsZWN0b3I6ICdbaGNJbnB1dF0nLFxuICAgIHByb3ZpZGVyczogW3twcm92aWRlOiBIY0Zvcm1Db250cm9sQ29tcG9uZW50LCB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBJbnB1dERpcmVjdGl2ZSl9XVxufSlcbmV4cG9ydCBjbGFzcyBJbnB1dERpcmVjdGl2ZSBleHRlbmRzIEhjRm9ybUNvbnRyb2xDb21wb25lbnQgaW1wbGVtZW50cyBEb0NoZWNrIHtcbiAgICBwcml2YXRlIF9mb2N1c2VkID0gZmFsc2U7XG4gICAgcHJpdmF0ZSBfdW5pcXVlSW5wdXRJZCA9IGBoYy1pbnB1dC0ke3VuaXF1ZUlkKyt9YDtcbiAgICBwcml2YXRlIF9mb3JtOiBOZ0Zvcm0gfCBGb3JtR3JvdXBEaXJlY3RpdmUgfCBudWxsO1xuXG4gICAgX2NvbXBvbmVudElkID0gdGhpcy5fdW5pcXVlSW5wdXRJZDtcblxuICAgIC8qKiBJbnB1dCB0eXBlIG9mIHRoZSBlbGVtZW50LiAqL1xuICAgIEBJbnB1dCgpXG4gICAgZ2V0IHR5cGUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3R5cGU7XG4gICAgfVxuXG4gICAgc2V0IHR5cGUodHlwZTogc3RyaW5nKSB7XG4gICAgICAgIGlmICh1bnN1cHBvcnRlZFR5cGVzLmluZGV4T2YodHlwZSkgPiAtMSkge1xuICAgICAgICAgICAgdGhyb3cgZ2V0VW5zdXBwb3J0ZWRIQ0lucHV0VHlwZSh0eXBlKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl90eXBlID0gdHlwZTtcblxuICAgICAgICAvLyB0ZXh0QXJlYSBkb2Vzbid0IGhhdmUgdHlwZSBwcm9wZXJ0eVxuICAgICAgICBpZiAoIXRoaXMuX2lzVGV4dEFyZWEoKSkge1xuICAgICAgICAgICAgdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnR5cGUgPSB0aGlzLnR5cGU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIF90eXBlID0gJ2lucHV0JztcblxuICAgIC8qKiBFbGVtZW50IGlkLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgZ2V0IGlkKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jb21wb25lbnRJZCB8fCB0aGlzLl91bmlxdWVJbnB1dElkO1xuICAgIH1cblxuICAgIHNldCBpZChpZFZhbDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuX2NvbXBvbmVudElkID0gaWRWYWwgPyBpZFZhbCA6IHRoaXMuX3VuaXF1ZUlucHV0SWQ7XG4gICAgfVxuXG4gICAgLyoqIFNldHMgaW5wdXQgZWxlbWVudCBhcyByZWFkb25seS4gKi9cbiAgICBASW5wdXQoKVxuICAgIGdldCByZWFkb25seSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3JlYWRvbmx5O1xuICAgIH1cblxuICAgIHNldCByZWFkb25seShpc1JlYWRPbmx5KSB7XG4gICAgICAgIHRoaXMuX3JlYWRvbmx5ID0gcGFyc2VCb29sZWFuQXR0cmlidXRlKGlzUmVhZE9ubHkpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX3JlYWRvbmx5ID0gZmFsc2U7XG5cbiAgICAvKiogRGlzYWJsZXMgdGhlIGlucHV0IGVsZW1lbnQuICovXG4gICAgQElucHV0KClcbiAgICBnZXQgZGlzYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICh0aGlzLl9uZ0NvbnRyb2wgJiYgdGhpcy5fbmdDb250cm9sLmRpc2FibGVkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbmdDb250cm9sLmRpc2FibGVkO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9pc0Rpc2FibGVkO1xuICAgIH1cblxuICAgIHNldCBkaXNhYmxlZChkaXNhYmxlZElucHV0KSB7XG4gICAgICAgIHRoaXMuX2lzRGlzYWJsZWQgPSBwYXJzZUJvb2xlYW5BdHRyaWJ1dGUoZGlzYWJsZWRJbnB1dCk7XG5cbiAgICAgICAgaWYgKHRoaXMuX2ZvY3VzZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX2ZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIC8vIFRPRE86IHRyaWdnZXIgc3RhdGUgY2hhbmdlXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogU2V0cyByZXF1aXJlZCBhdHRyaWJ1dGUuICovXG4gICAgQElucHV0KClcbiAgICBnZXQgcmVxdWlyZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pc1JlcXVpcmVkO1xuICAgIH1cblxuICAgIHNldCByZXF1aXJlZChyZXF1aXJlZElucHV0KSB7XG4gICAgICAgIHRoaXMuX2lzUmVxdWlyZWQgPSBwYXJzZUJvb2xlYW5BdHRyaWJ1dGUocmVxdWlyZWRJbnB1dCk7XG4gICAgfVxuXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy5oYy1pbnB1dCcpXG4gICAgX2hvc3RIY0lucHV0Q2xhc3MgPSB0cnVlO1xuXG4gICAgQEhvc3RCaW5kaW5nKCdhdHRyLmlkJylcbiAgICBnZXQgX2hvc3RJZCgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5fY29tcG9uZW50SWQgfHwgdGhpcy5fdW5pcXVlSW5wdXRJZDtcbiAgICB9XG5cbiAgICBASG9zdEJpbmRpbmcoJ3JlYWRvbmx5JylcbiAgICBnZXQgX2hvc3RSZWFkT25seSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVhZG9ubHk7XG4gICAgfVxuXG4gICAgQEhvc3RCaW5kaW5nKCdkaXNhYmxlZCcpXG4gICAgZ2V0IF9ob3N0RGlzYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmRpc2FibGVkO1xuICAgIH1cblxuICAgIEBIb3N0QmluZGluZygncmVxdWlyZWQnKVxuICAgIGdldCBfaG9zdFJlcXVpcmVkKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5faXNSZXF1aXJlZDtcbiAgICB9XG5cbiAgICBASG9zdExpc3RlbmVyKCdibHVyJylcbiAgICBfb25CbHVyKCkge1xuICAgICAgICB0aGlzLl9jaGFuZ2VGb2N1cyhmYWxzZSk7XG4gICAgfVxuXG4gICAgQEhvc3RMaXN0ZW5lcignZm9jdXMnKVxuICAgIF9vbkZvY3VzKCkge1xuICAgICAgICB0aGlzLl9jaGFuZ2VGb2N1cyh0cnVlKTtcbiAgICB9XG5cbiAgICAvKiogU2V0cyB2YWx1ZSBvZiB0aGUgaW5wdXQgZWxlbWVudCAqL1xuICAgIEBJbnB1dCgpXG4gICAgZ2V0IHZhbHVlKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQudmFsdWU7XG4gICAgfVxuXG4gICAgc2V0IHZhbHVlKHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKHZhbHVlICE9PSB0aGlzLnZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIEBIb3N0TGlzdGVuZXIoJ2lucHV0JylcbiAgICBfaW5wdXRFdmVudCgpIHtcbiAgICAgICAgLy8gY2F1c2VzIGFuZ3VsYXIgdG8gcnVuIGNoYW5nZSBkZXRlY3Rpb24gb24gaW5wdXQgZXZlbnRcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSBfZWxlbWVudFJlZjogRWxlbWVudFJlZixcbiAgICAgICAgQE9wdGlvbmFsKCkgX3BhcmVudEZvcm06IE5nRm9ybSxcbiAgICAgICAgQE9wdGlvbmFsKCkgX3BhcmVudEZvcm1Hcm91cDogRm9ybUdyb3VwRGlyZWN0aXZlLFxuICAgICAgICBAT3B0aW9uYWwoKVxuICAgICAgICBAU2VsZigpXG4gICAgICAgIHB1YmxpYyBfbmdDb250cm9sOiBOZ0NvbnRyb2xcbiAgICApIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICB0aGlzLl9mb3JtID0gX3BhcmVudEZvcm0gfHwgX3BhcmVudEZvcm1Hcm91cDtcbiAgICB9XG5cbiAgICBuZ0RvQ2hlY2soKTogdm9pZCB7XG4gICAgICAgIC8vIFRoaXMgbmVlZHMgdG8gYmUgY2hlY2tlZCBldmVyeSBjeWNsZSBiZWNhdXNlIHdlIGNhbid0IHN1YnNjcmliZSB0byBmb3JtIHN1Ym1pc3Npb25zXG4gICAgICAgIGlmICh0aGlzLl9uZ0NvbnRyb2wpIHtcbiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUVycm9yU3RhdGUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKiBTZXRzIHRoZSBmb2N1cyBvbiB0aGUgaW5wdXQgZWxlbWVudCAqL1xuICAgIGZvY3VzKCk6IHZvaWQge1xuICAgICAgICB0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9jaGFuZ2VGb2N1cyhmb2N1c2VkOiBib29sZWFuKSB7XG4gICAgICAgIGlmICh0aGlzLl9mb2N1c2VkICE9PSBmb2N1c2VkICYmICF0aGlzLnJlYWRvbmx5KSB7XG4gICAgICAgICAgICB0aGlzLl9mb2N1c2VkID0gZm9jdXNlZDtcbiAgICAgICAgICAgIC8vIFRPRE86IHRyaWdnZXIgc3RhdGUgY2hhbmdlXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIF9pc1RleHRBcmVhKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT09ICd0ZXh0YXJlYSc7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfdXBkYXRlRXJyb3JTdGF0ZSgpIHtcbiAgICAgICAgY29uc3Qgb2xkU3RhdGUgPSB0aGlzLl9lcnJvclN0YXRlO1xuXG4gICAgICAgIC8vIFRPRE86IHRoaXMgY291bGQgYmUgYWJzdHJhY3RlZCBvdXQgYXMgYW4gQElucHV0KCkgaWYgd2UgbmVlZCB0aGlzIHRvIGJlIGNvbmZpZ3VyYWJsZVxuICAgICAgICBjb25zdCBuZXdTdGF0ZSA9ICEhKFxuICAgICAgICAgICAgdGhpcy5fbmdDb250cm9sICYmXG4gICAgICAgICAgICB0aGlzLl9uZ0NvbnRyb2wuaW52YWxpZCAmJlxuICAgICAgICAgICAgKHRoaXMuX25nQ29udHJvbC50b3VjaGVkIHx8ICh0aGlzLl9mb3JtICYmIHRoaXMuX2Zvcm0uc3VibWl0dGVkKSlcbiAgICAgICAgKTtcblxuICAgICAgICBpZiAob2xkU3RhdGUgIT09IG5ld1N0YXRlKSB7XG4gICAgICAgICAgICB0aGlzLl9lcnJvclN0YXRlID0gbmV3U3RhdGU7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=