/**
 * @fileoverview added by tsickle
 * Generated from: lib/date-range/picker-overlay/picker-overlay.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewEncapsulation, ViewChildren, QueryList, ChangeDetectionStrategy, ChangeDetectorRef } from '@angular/core';
import { OverlayRef } from '@angular/cdk/overlay';
import { ConfigStoreService } from '../services/config-store.service';
import { CalendarWrapperComponent } from '../calendar-wrapper/calendar-wrapper.component';
// ** Date range wrapper component */
export class PickerOverlayComponent {
    /**
     * @param {?} configStoreService
     * @param {?} overlayRef
     * @param {?} cd
     */
    constructor(configStoreService, overlayRef, cd) {
        this.configStoreService = configStoreService;
        this.overlayRef = overlayRef;
        this.cd = cd;
        this._skipRangeCheck = false;
        this.__rangeIsInvalid = false; // if true, the fromDate is after the toDate and save will not be allowed
        this.options$ = configStoreService.dateRangeOptions$;
    }
    /**
     * @param {?} fd
     * @return {?}
     */
    set _fromDate(fd) { this.__fromDate = fd; this.cd.markForCheck(); }
    /**
     * @param {?} td
     * @return {?}
     */
    set _toDate(td) { this.__toDate = td; this.cd.markForCheck(); }
    /**
     * @param {?} s
     * @return {?}
     */
    set _selectedPreset(s) { this.__selectedPreset = s; this.cd.markForCheck(); }
    /**
     * @param {?} isInvalid
     * @return {?}
     */
    set _rangeIsInvalid(isInvalid) { this.__rangeIsInvalid = isInvalid; this.cd.markForCheck(); }
    /**
     * @return {?}
     */
    get _fromDate() { return this.__fromDate; }
    /**
     * @return {?}
     */
    get _toDate() { return this.__toDate; }
    /**
     * @return {?}
     */
    get _selectedPreset() { return this.__selectedPreset; }
    /**
     * @return {?}
     */
    get _rangeIsInvalid() { return this.__rangeIsInvalid; }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.options$.subscribe((/**
         * @param {?} options
         * @return {?}
         */
        (options) => {
            this._presetValues = options.presets;
            this.cd.markForCheck();
        }));
        this.configStoreService.rangeUpdate$.subscribe((/**
         * @param {?} dateRange
         * @return {?}
         */
        (dateRange) => {
            if (dateRange) {
                this._fromDate = dateRange.fromDate;
                this._toDate = dateRange.toDate;
            }
            else {
                this._fromDate = undefined;
                this._toDate = undefined;
            }
            this._validateRange();
        }));
        this.configStoreService.presetUpdate$.subscribe((/**
         * @param {?} presetIndex
         * @return {?}
         */
        (presetIndex) => {
            if (typeof presetIndex === 'number') {
                this._selectedPreset = presetIndex;
                this._updateRangeByPreset(presetIndex);
            }
        }));
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        if (this.calendarWrappers.first) {
            this.calendarWrappers.first.focusInput();
        }
    }
    /**
     * @param {?=} date
     * @return {?}
     */
    _updateFromDate(date) {
        if (!this._skipRangeCheck) {
            this._fromDate = date;
            this._isRangePreset();
        }
        if (this._rangeIsInvalid) {
            this._validateRange();
        }
    }
    /**
     * @param {?=} date
     * @return {?}
     */
    _updateToDate(date) {
        if (!this._skipRangeCheck) {
            this._toDate = date;
            this._isRangePreset();
        }
        if (this._rangeIsInvalid) {
            this._validateRange();
        }
    }
    /**
     * @param {?} index
     * @return {?}
     */
    _updateRangeByPreset(index) {
        if (this._presetValues && index < this._presetValues.length && index >= 0) {
            // Prevent the system from assigning a preset if one has specifically been selected
            this._skipRangeCheck = true;
            this._fromDate = this._presetValues[index].range.fromDate;
            this._toDate = this._presetValues[index].range.toDate;
            setTimeout((/**
             * @return {?}
             */
            () => {
                if (this._fromDate) {
                    this.calendarWrappers.first.hcCalendar.activeDate = this._fromDate;
                }
                if (this._toDate) {
                    this.calendarWrappers.last.hcCalendar.activeDate = this._toDate;
                }
                this._skipRangeCheck = false;
            }));
        }
    }
    /**
     * @return {?}
     */
    _isRangePreset() {
        this._selectedPreset = null;
        if (this._presetValues) {
            for (let i = 0; i < this._presetValues.length; i++) {
                /** @type {?} */
                let radioRange = this._presetValues[i].range;
                if (this._fromDate && radioRange.fromDate && this._toDate && radioRange.toDate) {
                    if (this._fromDate.toDateString() === radioRange.fromDate.toDateString() &&
                        this._toDate.toDateString() === radioRange.toDate.toDateString()) {
                        this._selectedPreset = i;
                    }
                }
            }
        }
    }
    /**
     * @return {?}
     */
    _applyNewDates() {
        if (!!this._toDate && !!this._fromDate) {
            this._validateRange();
            if (this._rangeIsInvalid) {
                return;
            }
            this.configStoreService.updateRange({ fromDate: this._fromDate, toDate: this._toDate });
            if (this._selectedPreset !== null) {
                this.configStoreService.updatePreset(this._selectedPreset);
            }
            else {
                this.configStoreService.updatePreset({ fromDate: this._fromDate, toDate: this._toDate });
            }
        }
        this.overlayRef.dispose();
    }
    /**
     * @return {?}
     */
    _validateRange() {
        this._rangeIsInvalid = (!!this._fromDate && !!this._toDate) && this._fromDate > this._toDate;
    }
    /**
     * @return {?}
     */
    _discardNewDates() {
        this.overlayRef.dispose();
    }
}
PickerOverlayComponent.decorators = [
    { type: Component, args: [{
                selector: 'hc-date-range-picker-overlay',
                template: "<div class=\"hc-date-range-calendar-container\" *ngIf=\"options$ | async as options\">\n    <div class=\"hc-date-range-calendar-item hc-date-range-calendar-wrapper\">\n        <hc-calendar-wrapper\n            [prefixLabel]=\"options.startDatePrefix\"\n            [selectedDate]=\"_fromDate\"\n            [minDate]=\"options.fromMinMax?.fromDate\"\n            (selectedDateChange)=\"_updateFromDate($event)\"\n            [maxDate]=\"options.fromMinMax?.toDate\"\n            [excludeWeekends]=\"options.excludeWeekends\"\n            [dateFormat]=\"options.format\"\n            [invalidDateLabel]=\"options.invalidDateLabel\"\n            [mode]=\"options.mode\"\n            [hourCycle]=\"options.hourCycle\"\n        ></hc-calendar-wrapper>\n    </div>\n    <div class=\"hc-date-range-calendar-item hc-date-range-calendar-wrapper\">\n        <hc-calendar-wrapper\n            [prefixLabel]=\"options.endDatePrefix\"\n            [selectedDate]=\"_toDate\"\n            [minDate]=\"options.toMinMax?.fromDate\"\n            [maxDate]=\"options.toMinMax?.toDate\"\n            (selectedDateChange)=\"_updateToDate($event)\"\n            [excludeWeekends]=\"options.excludeWeekends\"\n            [dateFormat]=\"options.format\"\n            [invalidDateLabel]=\"options.invalidDateLabel\"\n            [mode]=\"options.mode\"\n            [hourCycle]=\"options.hourCycle\"\n        ></hc-calendar-wrapper>\n    </div>\n    <div class=\"hc-date-range-calendar-item hc-date-range\">\n        <div class=\"hc-date-range-menu\">\n            <hc-radio-group class=\"presets\" [(ngModel)]=\"_selectedPreset\">\n                <hc-radio-button *ngFor=\"let p of options.presets; let i = index\" [value]=\"i\" (change)=\"_updateRangeByPreset(i)\">\n                    {{ p.presetLabel }}\n                </hc-radio-button>\n            </hc-radio-group>\n            <div class=\"hc-date-range-controls\">\n                <button class=\"hc-date-range-control\" hc-button buttonStyle=\"link\" type=\"button\" (click)=\"_discardNewDates()\">\n                    {{ options.cancelLabel }}\n                </button>\n                <button\n                    class=\"hc-date-range-control\"\n                    hc-button\n                    buttonStyle=\"primary\"\n                    type=\"button\"\n                    [disabled]=\"!(this._toDate && this._fromDate)\"\n                    (click)=\"_applyNewDates()\"\n                >\n                    {{ options.applyLabel }}\n                </button>\n            </div>\n            <hc-chip *ngIf=\"_rangeIsInvalid\" color=\"red\">\n                <span class=\"hc-date-range-warning-icon\"></span>The start date cannot be after the end date.\n            </hc-chip>\n        </div>\n    </div>\n</div>\n\n\n",
                encapsulation: ViewEncapsulation.None,
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [".hc-date-range-calendar-container{display:-webkit-box;display:flex;justify-content:space-around;min-width:650px}.hc-date-range-calendar-item{font-size:14px;font-weight:400;min-width:210px;padding:1em}.hc-date-range-calendar-wrapper{width:338px}.hc-date-range-menu{height:100%;width:250px}.hc-date-range-controls{display:-webkit-box;display:flex;justify-content:space-around;margin:10% auto}.hc-date-range-control{min-width:120px!important}.hc-date-range-overlay{background:#fff;border-radius:2px;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)}.hc-date-range-overlay-backdrop{background-color:rgba(0,0,0,.2);opacity:.2}.presets{padding-left:21px}.hc-date-range-warning-icon{-webkit-box-flex:1;flex:1 0 auto;width:16px;height:16px;margin-right:10px;background-repeat:no-repeat;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMy4xLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHZpZXdCb3g9IjAgMCA3OS41IDcwLjEiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDc5LjUgNzAuMTsiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4NCgkuc3Qwe2ZpbGw6Izk1MUMxRTt9DQo8L3N0eWxlPg0KPHRpdGxlPndhcm48L3RpdGxlPg0KPHBhdGggY2xhc3M9InN0MCIgZD0iTTc4LjgsNjIuOEw0NCwyLjRjLTEuMy0yLjMtNC4zLTMuMS02LjctMS44Yy0wLjcsMC40LTEuNCwxLTEuOCwxLjhMMC43LDYyLjhjLTEuMywyLjMtMC41LDUuMywxLjgsNi43DQoJYzAuNywwLjQsMS42LDAuNywyLjQsMC43aDY5LjdjMi43LDAsNC45LTIuMiw0LjktNC45Qzc5LjUsNjQuNCw3OS4yLDYzLjUsNzguOCw2Mi44eiBNMzUuMiwyMC43aDkuMnYyNS43aC05LjJWMjAuN3ogTTM5LjcsNjAuOA0KCWMtMy4xLDAtNS42LTIuNS01LjYtNS42czIuNS01LjYsNS42LTUuNnM1LjYsMi41LDUuNiw1LjZDNDUuNCw1OC4yLDQyLjgsNjAuOCwzOS43LDYwLjh6Ii8+DQo8L3N2Zz4NCg==)}"]
            }] }
];
/** @nocollapse */
PickerOverlayComponent.ctorParameters = () => [
    { type: ConfigStoreService },
    { type: OverlayRef },
    { type: ChangeDetectorRef }
];
PickerOverlayComponent.propDecorators = {
    calendarWrappers: [{ type: ViewChildren, args: [CalendarWrapperComponent,] }]
};
if (false) {
    /** @type {?} */
    PickerOverlayComponent.prototype.options$;
    /** @type {?} */
    PickerOverlayComponent.prototype._presetValues;
    /** @type {?} */
    PickerOverlayComponent.prototype._skipRangeCheck;
    /** @type {?} */
    PickerOverlayComponent.prototype.__fromDate;
    /** @type {?} */
    PickerOverlayComponent.prototype.__toDate;
    /** @type {?} */
    PickerOverlayComponent.prototype.__selectedPreset;
    /** @type {?} */
    PickerOverlayComponent.prototype.__rangeIsInvalid;
    /** @type {?} */
    PickerOverlayComponent.prototype.calendarWrappers;
    /** @type {?} */
    PickerOverlayComponent.prototype.configStoreService;
    /**
     * @type {?}
     * @private
     */
    PickerOverlayComponent.prototype.overlayRef;
    /**
     * @type {?}
     * @private
     */
    PickerOverlayComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGlja2VyLW92ZXJsYXkuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGhlYWx0aGNhdGFseXN0L2Nhc2htZXJlLyIsInNvdXJjZXMiOlsibGliL2RhdGUtcmFuZ2UvcGlja2VyLW92ZXJsYXkvcGlja2VyLW92ZXJsYXkuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBVSxpQkFBaUIsRUFBaUIsWUFBWSxFQUFFLFNBQVMsRUFBRSx1QkFBdUIsRUFBRSxpQkFBaUIsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUV2SixPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sc0JBQXNCLENBQUM7QUFDaEQsT0FBTyxFQUFDLGtCQUFrQixFQUFDLE1BQU0sa0NBQWtDLENBQUM7QUFHcEUsT0FBTyxFQUFDLHdCQUF3QixFQUFDLE1BQU0sZ0RBQWdELENBQUM7O0FBV3hGLE1BQU0sT0FBTyxzQkFBc0I7Ozs7OztJQXFCL0IsWUFBbUIsa0JBQXNDLEVBQVUsVUFBc0IsRUFBVSxFQUFxQjtRQUFyRyx1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW9CO1FBQVUsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUFVLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBVnhILG9CQUFlLEdBQVksS0FBSyxDQUFDO1FBS2pDLHFCQUFnQixHQUFZLEtBQUssQ0FBQyxDQUFDLHlFQUF5RTtRQU14RyxJQUFJLENBQUMsUUFBUSxHQUFHLGtCQUFrQixDQUFDLGlCQUFpQixDQUFDO0lBQ3pELENBQUM7Ozs7O0lBckJELElBQUksU0FBUyxDQUFDLEVBQWlCLElBQUksSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxDQUFDLENBQUMsQ0FBQzs7Ozs7SUFDbEYsSUFBSSxPQUFPLENBQUMsRUFBaUIsSUFBSSxJQUFJLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQyxDQUFDLElBQUks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LEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQztJQUNqRyxDQUFDOzs7O0lBRUQsZ0JBQWdCO1FBQ1osSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUM5QixDQUFDOzs7WUF6SUosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSw4QkFBOEI7Z0JBQ3hDLHd1RkFBOEM7Z0JBRTlDLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO2dCQUNyQyxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTs7YUFDbEQ7Ozs7WUFiTyxrQkFBa0I7WUFEbEIsVUFBVTtZQUY2RixpQkFBaUI7OzsrQkFtQzNILFlBQVksU0FBQyx3QkFBd0I7Ozs7SUFqQnRDLDBDQUF1Qzs7SUFTdkMsK0NBQXdDOztJQUN4QyxpREFBaUM7O0lBRWpDLDRDQUEwQjs7SUFDMUIsMENBQXdCOztJQUN4QixrREFBZ0M7O0lBQ2hDLGtEQUFrQzs7SUFFbEMsa0RBQ3NEOztJQUUxQyxvREFBNkM7Ozs7O0lBQUUsNENBQThCOzs7OztJQUFFLG9DQUE2QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29tcG9uZW50LCBPbkluaXQsIFZpZXdFbmNhcHN1bGF0aW9uLCBBZnRlclZpZXdJbml0LCBWaWV3Q2hpbGRyZW4sIFF1ZXJ5TGlzdCwgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENoYW5nZURldGVjdG9yUmVmfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7RGF0ZVJhbmdlT3B0aW9ucywgUHJlc2V0SXRlbX0gZnJvbSAnLi4vbW9kZWwvbW9kZWwnO1xuaW1wb3J0IHtPdmVybGF5UmVmfSBmcm9tICdAYW5ndWxhci9jZGsvb3ZlcmxheSc7XG5pbXBvcnQge0NvbmZpZ1N0b3JlU2VydmljZX0gZnJvbSAnLi4vc2VydmljZXMvY29uZmlnLXN0b3JlLnNlcnZpY2UnO1xuaW1wb3J0IHtEYXRlUmFuZ2V9IGZyb20gJy4uL21vZGVsL21vZGVsJztcbmltcG9ydCB7RH0gZnJvbSAnLi4vLi4vZGF0ZXBpY2tlci9kYXRldGltZS9kYXRlLWZvcm1hdHMnO1xuaW1wb3J0IHtDYWxlbmRhcldyYXBwZXJDb21wb25lbnR9IGZyb20gJy4uL2NhbGVuZGFyLXdyYXBwZXIvY2FsZW5kYXItd3JhcHBlci5jb21wb25lbnQnO1xuaW1wb3J0IHtPYnNlcnZhYmxlfSBmcm9tICdyeGpzJztcblxuLy8gKiogRGF0ZSByYW5nZSB3cmFwcGVyIGNvbXBvbmVudCAqL1xuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdoYy1kYXRlLXJhbmdlLXBpY2tlci1vdmVybGF5JyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vcGlja2VyLW92ZXJsYXkuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL3BpY2tlci1vdmVybGF5LmNvbXBvbmVudC5zY3NzJ10sXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcbiAgICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcbmV4cG9ydCBjbGFzcyBQaWNrZXJPdmVybGF5Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcbiAgICBvcHRpb25zJDogT2JzZXJ2YWJsZTxEYXRlUmFuZ2VPcHRpb25zPjtcbiAgICBzZXQgX2Zyb21EYXRlKGZkOiBEIHwgdW5kZWZpbmVkKSB7IHRoaXMuX19mcm9tRGF0ZSA9IGZkOyB0aGlzLmNkLm1hcmtGb3JDaGVjaygpOyB9XG4gICAgc2V0IF90b0RhdGUodGQ6IEQgfCB1bmRlZmluZWQpIHsgdGhpcy5fX3RvRGF0ZSA9IHRkOyB0aGlzLmNkLm1hcmtGb3JDaGVjaygpOyB9XG4gICAgc2V0IF9zZWxlY3RlZFByZXNldChzOiBudW1iZXIgfCBudWxsICkgeyB0aGlzLl9fc2VsZWN0ZWRQcmVzZXQgPSBzOyB0aGlzLmNkLm1hcmtGb3JDaGVjaygpOyB9XG4gICAgc2V0IF9yYW5nZUlzSW52YWxpZChpc0ludmFsaWQ6IGJvb2xlYW4pIHsgdGhpcy5fX3JhbmdlSXNJbnZhbGlkID0gaXNJbnZhbGlkOyB0aGlzLmNkLm1hcmtGb3JDaGVjaygpOyB9XG4gICAgZ2V0IF9mcm9tRGF0ZSgpOiBEIHwgdW5kZWZpbmVkIHsgcmV0dXJuIHRoaXMuX19mcm9tRGF0ZTsgfVxuICAgIGdldCBfdG9EYXRlKCk6IEQgfCB1bmRlZmluZWQgeyByZXR1cm4gdGhpcy5fX3RvRGF0ZTsgfVxuICAgIGdldCBfc2VsZWN0ZWRQcmVzZXQoKTogbnVtYmVyIHwgbnVsbCB7IHJldHVybiB0aGlzLl9fc2VsZWN0ZWRQcmVzZXQ7IH1cbiAgICBnZXQgX3JhbmdlSXNJbnZhbGlkKCk6IGJvb2xlYW4geyByZXR1cm4gdGhpcy5fX3JhbmdlSXNJbnZhbGlkOyB9XG4gICAgX3ByZXNldFZhbHVlczogUHJlc2V0SXRlbVtdIHwgdW5kZWZpbmVkO1xuICAgIF9za2lwUmFuZ2VDaGVjazogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgX19mcm9tRGF0ZTogRCB8IHVuZGVmaW5lZDtcbiAgICBfX3RvRGF0ZTogRCB8IHVuZGVmaW5lZDtcbiAgICBfX3NlbGVjdGVkUHJlc2V0OiBudW1iZXIgfCBudWxsO1xuICAgIF9fcmFuZ2VJc0ludmFsaWQ6IGJvb2xlYW4gPSBmYWxzZTsgLy8gaWYgdHJ1ZSwgdGhlIGZyb21EYXRlIGlzIGFmdGVyIHRoZSB0b0RhdGUgYW5kIHNhdmUgd2lsbCBub3QgYmUgYWxsb3dlZFxuXG4gICAgQFZpZXdDaGlsZHJlbihDYWxlbmRhcldyYXBwZXJDb21wb25lbnQpXG4gICAgY2FsZW5kYXJXcmFwcGVyczogUXVlcnlMaXN0PENhbGVuZGFyV3JhcHBlckNvbXBvbmVudD47XG5cbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgY29uZmlnU3RvcmVTZXJ2aWNlOiBDb25maWdTdG9yZVNlcnZpY2UsIHByaXZhdGUgb3ZlcmxheVJlZjogT3ZlcmxheVJlZiwgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zJCA9IGNvbmZpZ1N0b3JlU2VydmljZS5kYXRlUmFuZ2VPcHRpb25zJDtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zJC5zdWJzY3JpYmUoKG9wdGlvbnM6IERhdGVSYW5nZU9wdGlvbnMpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX3ByZXNldFZhbHVlcyA9IG9wdGlvbnMucHJlc2V0cztcbiAgICAgICAgICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmNvbmZpZ1N0b3JlU2VydmljZS5yYW5nZVVwZGF0ZSQuc3Vic2NyaWJlKChkYXRlUmFuZ2U6IERhdGVSYW5nZSkgPT4ge1xuICAgICAgICAgICAgaWYgKGRhdGVSYW5nZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21EYXRlID0gZGF0ZVJhbmdlLmZyb21EYXRlO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RvRGF0ZSA9IGRhdGVSYW5nZS50b0RhdGU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX2Zyb21EYXRlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RvRGF0ZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX3ZhbGlkYXRlUmFuZ2UoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY29uZmlnU3RvcmVTZXJ2aWNlLnByZXNldFVwZGF0ZSQuc3Vic2NyaWJlKChwcmVzZXRJbmRleDogbnVtYmVyIHwgRGF0ZVJhbmdlKSA9PiB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHByZXNldEluZGV4ID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICAgIHRoaXMuX3NlbGVjdGVkUHJlc2V0ID0gcHJlc2V0SW5kZXg7XG4gICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlUmFuZ2VCeVByZXNldCggcHJlc2V0SW5kZXggKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5jYWxlbmRhcldyYXBwZXJzLmZpcnN0KSB7XG4gICAgICAgICAgICB0aGlzLmNhbGVuZGFyV3JhcHBlcnMuZmlyc3QuZm9jdXNJbnB1dCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX3VwZGF0ZUZyb21EYXRlKGRhdGU/OiBEKSB7XG4gICAgICAgIGlmICggIXRoaXMuX3NraXBSYW5nZUNoZWNrICkge1xuICAgICAgICAgICAgdGhpcy5fZnJvbURhdGUgPSBkYXRlO1xuICAgICAgICAgICAgdGhpcy5faXNSYW5nZVByZXNldCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuX3JhbmdlSXNJbnZhbGlkKSB7XG4gICAgICAgICAgICB0aGlzLl92YWxpZGF0ZVJhbmdlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfdXBkYXRlVG9EYXRlKGRhdGU/OiBEKSB7XG4gICAgICAgIGlmICggIXRoaXMuX3NraXBSYW5nZUNoZWNrICkge1xuICAgICAgICAgICAgdGhpcy5fdG9EYXRlID0gZGF0ZTtcbiAgICAgICAgICAgIHRoaXMuX2lzUmFuZ2VQcmVzZXQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLl9yYW5nZUlzSW52YWxpZCkge1xuICAgICAgICAgICAgdGhpcy5fdmFsaWRhdGVSYW5nZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX3VwZGF0ZVJhbmdlQnlQcmVzZXQoaW5kZXg6IG51bWJlcikge1xuICAgICAgICBpZiAodGhpcy5fcHJlc2V0VmFsdWVzICYmIGluZGV4IDwgdGhpcy5fcHJlc2V0VmFsdWVzLmxlbmd0aCAmJiBpbmRleCA+PSAwICkge1xuICAgICAgICAgICAgLy8gUHJldmVudCB0aGUgc3lzdGVtIGZyb20gYXNzaWduaW5nIGEgcHJlc2V0IGlmIG9uZSBoYXMgc3BlY2lmaWNhbGx5IGJlZW4gc2VsZWN0ZWRcbiAgICAgICAgICAgIHRoaXMuX3NraXBSYW5nZUNoZWNrID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuX2Zyb21EYXRlID0gdGhpcy5fcHJlc2V0VmFsdWVzW2luZGV4XS5yYW5nZS5mcm9tRGF0ZTtcbiAgICAgICAgICAgIHRoaXMuX3RvRGF0ZSA9IHRoaXMuX3ByZXNldFZhbHVlc1tpbmRleF0ucmFuZ2UudG9EYXRlO1xuXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIHRoaXMuX2Zyb21EYXRlICkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbGVuZGFyV3JhcHBlcnMuZmlyc3QuaGNDYWxlbmRhci5hY3RpdmVEYXRlID0gdGhpcy5fZnJvbURhdGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICggdGhpcy5fdG9EYXRlICkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbGVuZGFyV3JhcHBlcnMubGFzdC5oY0NhbGVuZGFyLmFjdGl2ZURhdGUgPSB0aGlzLl90b0RhdGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX3NraXBSYW5nZUNoZWNrID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIF9pc1JhbmdlUHJlc2V0KCkge1xuICAgICAgICB0aGlzLl9zZWxlY3RlZFByZXNldCA9IG51bGw7XG4gICAgICAgIGlmICh0aGlzLl9wcmVzZXRWYWx1ZXMpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5fcHJlc2V0VmFsdWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbGV0IHJhZGlvUmFuZ2U6IERhdGVSYW5nZSA9IHRoaXMuX3ByZXNldFZhbHVlc1tpXS5yYW5nZTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZnJvbURhdGUgJiYgcmFkaW9SYW5nZS5mcm9tRGF0ZSAmJiB0aGlzLl90b0RhdGUgJiYgcmFkaW9SYW5nZS50b0RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCB0aGlzLl9mcm9tRGF0ZS50b0RhdGVTdHJpbmcoKSA9PT0gcmFkaW9SYW5nZS5mcm9tRGF0ZS50b0RhdGVTdHJpbmcoKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdG9EYXRlLnRvRGF0ZVN0cmluZygpID09PSByYWRpb1JhbmdlLnRvRGF0ZS50b0RhdGVTdHJpbmcoKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZWxlY3RlZFByZXNldCA9IGk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfYXBwbHlOZXdEYXRlcygpIHtcbiAgICAgICAgaWYgKCEhdGhpcy5fdG9EYXRlICYmICEhdGhpcy5fZnJvbURhdGUpIHtcbiAgICAgICAgICAgIHRoaXMuX3ZhbGlkYXRlUmFuZ2UoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9yYW5nZUlzSW52YWxpZCkgeyByZXR1cm47IH1cbiAgICAgICAgICAgIHRoaXMuY29uZmlnU3RvcmVTZXJ2aWNlLnVwZGF0ZVJhbmdlKHtmcm9tRGF0ZTogdGhpcy5fZnJvbURhdGUsIHRvRGF0ZTogdGhpcy5fdG9EYXRlfSk7XG4gICAgICAgICAgICBpZiAodGhpcy5fc2VsZWN0ZWRQcmVzZXQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZ1N0b3JlU2VydmljZS51cGRhdGVQcmVzZXQodGhpcy5fc2VsZWN0ZWRQcmVzZXQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZ1N0b3JlU2VydmljZS51cGRhdGVQcmVzZXQoe2Zyb21EYXRlOiB0aGlzLl9mcm9tRGF0ZSwgdG9EYXRlOiB0aGlzLl90b0RhdGV9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLm92ZXJsYXlSZWYuZGlzcG9zZSgpO1xuICAgIH1cblxuICAgIF92YWxpZGF0ZVJhbmdlKCkge1xuICAgICAgICB0aGlzLl9yYW5nZUlzSW52YWxpZCA9ICghIXRoaXMuX2Zyb21EYXRlICYmICEhdGhpcy5fdG9EYXRlKSAmJiB0aGlzLl9mcm9tRGF0ZSA+IHRoaXMuX3RvRGF0ZTtcbiAgICB9XG5cbiAgICBfZGlzY2FyZE5ld0RhdGVzKCkge1xuICAgICAgICB0aGlzLm92ZXJsYXlSZWYuZGlzcG9zZSgpO1xuICAgIH1cbn1cbiJdfQ==