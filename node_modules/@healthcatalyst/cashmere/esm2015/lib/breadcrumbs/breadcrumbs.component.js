/**
 * @fileoverview added by tsickle
 * Generated from: lib/breadcrumbs/breadcrumbs.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ViewEncapsulation } from '@angular/core';
import { ActivatedRoute, NavigationEnd, PRIMARY_OUTLET, Router } from '@angular/router';
/**
 * IBreadcrumb interface is used to store all required data for each breadcrumb element
 * \@docs-private
 * @record
 */
export function IBreadcrumb() { }
if (false) {
    /** @type {?} */
    IBreadcrumb.prototype.label;
    /** @type {?|undefined} */
    IBreadcrumb.prototype.params;
    /** @type {?} */
    IBreadcrumb.prototype.url;
}
/**
 * A navigational aid that allows users to keep track of their location within the current application
 */
export class BreadcrumbsComponent {
    /**
     * @param {?} activatedRoute
     * @param {?} router
     */
    constructor(activatedRoute, router) {
        this.activatedRoute = activatedRoute;
        this.router = router;
        this._breadcrumbs = [];
        this._backURL = '';
        this._backShow = 'none';
        this._locationLabel = '';
        this._queryParamsHandling = '';
    }
    /**
     * Sets the handling of the query parameters for the breadcrumb. Choose from: `'preserve' | 'merge' | '' (default)`
     * @return {?}
     */
    get queryParamsHandling() {
        return this._queryParamsHandling;
    }
    /**
     * @param {?} queryParamsHandling
     * @return {?}
     */
    set queryParamsHandling(queryParamsHandling) {
        this._queryParamsHandling = queryParamsHandling;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        /** @type {?} */
        const ROUTE_DATA_BREADCRUMB = 'breadcrumb';
        // Add the first breadcrumb for the base page
        /** @type {?} */
        let root = this.activatedRoute.root;
        this._breadcrumbs = this.getBreadcrumbs(root);
        // subscribe to the NavigationEnd event
        this._routerSubscription = this.router.events.subscribe((/**
         * @param {?} event
         * @return {?}
         */
        (event) => {
            if (event instanceof NavigationEnd) {
                this.setBreadcrumbs();
            }
        }));
        // set initial breadcrumb state
        this.setBreadcrumbs();
    }
    /**
     * @private
     * @return {?}
     */
    setBreadcrumbs() {
        /** @type {?} */
        const root = this.activatedRoute.root;
        this._breadcrumbs = this.getBreadcrumbs(root);
        if (this._breadcrumbs.length > 1) {
            this._backURL = this._breadcrumbs[this._breadcrumbs.length - 2].url;
            this._backShow = 'inline';
            this._locationLabel = '';
        }
        else if (this._breadcrumbs.length === 1) {
            this._backShow = 'none';
            this._locationLabel = this._breadcrumbs[this._breadcrumbs.length - 1].label;
        }
        else {
            this._backShow = 'none';
            this._locationLabel = '';
        }
    }
    /**
     * @private
     * @param {?} route
     * @param {?=} url
     * @param {?=} breadcrumbs
     * @return {?}
     */
    getBreadcrumbs(route, url = '', breadcrumbs = []) {
        /** @type {?} */
        const ROUTE_DATA_BREADCRUMB = 'breadcrumb';
        // get the child routes
        /** @type {?} */
        let children = route.children;
        // return if there are no more children
        if (children.length === 0) {
            return breadcrumbs;
        }
        // iterate over each children
        for (let child of children) {
            // verify primary route
            if (child.outlet !== PRIMARY_OUTLET) {
                continue;
            }
            // verify the custom data property "breadcrumb" is specified on the route
            if (!child.snapshot.data.hasOwnProperty(ROUTE_DATA_BREADCRUMB)) {
                return this.getBreadcrumbs(child, url, breadcrumbs);
            }
            // get the route's URL segment
            /** @type {?} */
            let routeURL = child.snapshot.url.map((/**
             * @param {?} segment
             * @return {?}
             */
            segment => segment.path)).join('/');
            // append route URL to URL
            url += `/${routeURL}`;
            // add breadcrumb
            /** @type {?} */
            let parent = this.activatedRoute.parent;
            /** @type {?} */
            let fullURL = '';
            if (parent !== null) {
                fullURL += '/' + parent.snapshot.url.map((/**
                 * @param {?} segment
                 * @return {?}
                 */
                segment => segment.path)).join('/');
            }
            fullURL += `${url}`;
            /** @type {?} */
            let breadcrumb = {
                label: child.snapshot.data[ROUTE_DATA_BREADCRUMB],
                params: child.snapshot.params,
                url: fullURL
            };
            breadcrumbs.push(breadcrumb);
            // recursive
            return this.getBreadcrumbs(child, url, breadcrumbs);
        }
        // we should never get here, but just in case
        return breadcrumbs;
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this._routerSubscription.unsubscribe();
    }
}
BreadcrumbsComponent.decorators = [
    { type: Component, args: [{
                selector: 'hc-breadcrumbs',
                template: "<ol class=\"breadcrumb\">\n    <li *ngFor=\"let breadcrumb of _breadcrumbs; let last = last\" class=\"breadcrumb-item\">\n        <a *ngIf=\"!last\" [routerLink]=\"[breadcrumb.url]\" queryParamsHandling=\"{{queryParamsHandling}}\" [innerText]=\"breadcrumb.label\"></a>\n        <span *ngIf=\"last\" [innerText]=\"breadcrumb.label\"></span>\n        <i class=\"fa fa-chevron-right breadcrumb-arrow\"></i>\n    </li>\n</ol>\n<div class=\"breadcrumb-responsive-container\">\n    <a [style.display]=\"_backShow\" class=\"breadcrumb-back-button\" [routerLink]=\"_backURL\" queryParamsHandling=\"{{queryParamsHandling}}\">\n        <i class=\"fa fa-chevron-left\"></i>\n        <span>&nbsp;Back</span>\n    </a>\n    <span [innerText]=\"_locationLabel\"></span>\n</div>\n",
                encapsulation: ViewEncapsulation.None
            }] }
];
/** @nocollapse */
BreadcrumbsComponent.ctorParameters = () => [
    { type: ActivatedRoute },
    { type: Router }
];
BreadcrumbsComponent.propDecorators = {
    queryParamsHandling: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    BreadcrumbsComponent.prototype._breadcrumbs;
    /** @type {?} */
    BreadcrumbsComponent.prototype._routerSubscription;
    /** @type {?} */
    BreadcrumbsComponent.prototype._backURL;
    /** @type {?} */
    BreadcrumbsComponent.prototype._backShow;
    /** @type {?} */
    BreadcrumbsComponent.prototype._locationLabel;
    /** @type {?} */
    BreadcrumbsComponent.prototype._queryParamsHandling;
    /**
     * @type {?}
     * @private
     */
    BreadcrumbsComponent.prototype.activatedRoute;
    /**
     * @type {?}
     * @private
     */
    BreadcrumbsComponent.prototype.router;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnJlYWRjcnVtYnMuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGhlYWx0aGNhdGFseXN0L2Nhc2htZXJlLyIsInNvdXJjZXMiOlsibGliL2JyZWFkY3J1bWJzL2JyZWFkY3J1bWJzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBQyxTQUFTLEVBQXFCLEtBQUssRUFBRSxpQkFBaUIsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUNyRixPQUFPLEVBQUMsY0FBYyxFQUFTLGFBQWEsRUFBVSxjQUFjLEVBQUUsTUFBTSxFQUFDLE1BQU0saUJBQWlCLENBQUM7Ozs7OztBQU1yRyxpQ0FJQzs7O0lBSEcsNEJBQWM7O0lBQ2QsNkJBQWdCOztJQUNoQiwwQkFBWTs7Ozs7QUFlaEIsTUFBTSxPQUFPLG9CQUFvQjs7Ozs7SUFrQjdCLFlBQW9CLGNBQThCLEVBQVUsTUFBYztRQUF0RCxtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFBVSxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBakJuRSxpQkFBWSxHQUFrQixFQUFFLENBQUM7UUFFeEMsYUFBUSxHQUFXLEVBQUUsQ0FBQztRQUN0QixjQUFTLEdBQVcsTUFBTSxDQUFDO1FBQzNCLG1CQUFjLEdBQVcsRUFBRSxDQUFDO1FBQzVCLHlCQUFvQixHQUF3QixFQUFFLENBQUM7SUFZOEIsQ0FBQzs7Ozs7SUFUOUUsSUFDSSxtQkFBbUI7UUFDbkIsT0FBTyxJQUFJLENBQUMsb0JBQW9CLENBQUM7SUFDckMsQ0FBQzs7Ozs7SUFFRCxJQUFJLG1CQUFtQixDQUFDLG1CQUF3QztRQUM1RCxJQUFJLENBQUMsb0JBQW9CLEdBQUcsbUJBQW1CLENBQUM7SUFDcEQsQ0FBQzs7OztJQUlELFFBQVE7O2NBQ0UscUJBQXFCLEdBQVcsWUFBWTs7O1lBRTlDLElBQUksR0FBbUIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJO1FBQ25ELElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLGNBQWMs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QUFPLElBQUksR0FBRyxHQUFHLEVBQUUsQ0FBQzs7Z0JBQ2hCLFVBQVUsR0FBZ0I7Z0JBQzFCLEtBQUssRUFBRSxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQztnQkFDakQsTUFBTSxFQUFFLEtBQUssQ0FBQyxRQUFRLENBQUMsTUFBTTtnQkFDN0IsR0FBRyxFQUFFLE9BQU87YUFDZjtZQUVELFdBQVcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7WUFFN0IsWUFBWTtZQUNaLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1NBQ3ZEO1FBRUQsNkNBQTZDO1FBQzdDLE9BQU8sV0FBVyxDQUFDO0lBQ3ZCLENBQUM7Ozs7SUFFRCxXQUFXO1FBQ1AsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQzNDLENBQUM7OztZQWhISixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLGdCQUFnQjtnQkFDMUIseXdCQUEyQztnQkFDM0MsYUFBYSxFQUFFLGlCQUFpQixDQUFDLElBQUk7YUFDeEM7Ozs7WUF2Qk8sY0FBYztZQUFnRCxNQUFNOzs7a0NBaUN2RSxLQUFLOzs7O0lBUk4sNENBQXdDOztJQUN4QyxtREFBZ0M7O0lBQ2hDLHdDQUFzQjs7SUFDdEIseUNBQTJCOztJQUMzQiw4Q0FBNEI7O0lBQzVCLG9EQUErQzs7Ozs7SUFZbkMsOENBQXNDOzs7OztJQUFFLHNDQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29tcG9uZW50LCBPbkRlc3Ryb3ksIE9uSW5pdCwgSW5wdXQsIFZpZXdFbmNhcHN1bGF0aW9ufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7QWN0aXZhdGVkUm91dGUsIEV2ZW50LCBOYXZpZ2F0aW9uRW5kLCBQYXJhbXMsIFBSSU1BUllfT1VUTEVULCBSb3V0ZXJ9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5cbi8qKlxuICogSUJyZWFkY3J1bWIgaW50ZXJmYWNlIGlzIHVzZWQgdG8gc3RvcmUgYWxsIHJlcXVpcmVkIGRhdGEgZm9yIGVhY2ggYnJlYWRjcnVtYiBlbGVtZW50XG4gKiBAZG9jcy1wcml2YXRlXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSUJyZWFkY3J1bWIge1xuICAgIGxhYmVsOiBzdHJpbmc7XG4gICAgcGFyYW1zPzogUGFyYW1zO1xuICAgIHVybDogc3RyaW5nO1xufVxuXG4vKlxuICBUaGlzIHR5cGUgaXMgZnJvbSBAYW5ndWxhci9yb3V0ZXIsIGJ1dCB0aGUgaW1wb3J0IGxvY2F0aW9uIHZhcmllcyBieSBBbmd1bGFyIHZlcnNpb25cbiAgSW5jbHVkaW5nIGhlcmUgdG8gYWxsb3cgQ2FzaG1lcmUgdG8gd29yayByZWdhcmRsZXNzIG9mIEFuZ3VsYXIgdmVyc2lvblxuKi9cbmV4cG9ydCB0eXBlIFF1ZXJ5UGFyYW1zSGFuZGxpbmcgPSAnbWVyZ2UnIHwgJ3ByZXNlcnZlJyB8ICcnO1xuXG4vKiogQSBuYXZpZ2F0aW9uYWwgYWlkIHRoYXQgYWxsb3dzIHVzZXJzIHRvIGtlZXAgdHJhY2sgb2YgdGhlaXIgbG9jYXRpb24gd2l0aGluIHRoZSBjdXJyZW50IGFwcGxpY2F0aW9uICAqL1xuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdoYy1icmVhZGNydW1icycsXG4gICAgdGVtcGxhdGVVcmw6ICcuL2JyZWFkY3J1bWJzLmNvbXBvbmVudC5odG1sJyxcbiAgICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXG59KVxuZXhwb3J0IGNsYXNzIEJyZWFkY3J1bWJzQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xuICAgIHB1YmxpYyBfYnJlYWRjcnVtYnM6IElCcmVhZGNydW1iW10gPSBbXTtcbiAgICBwdWJsaWMgX3JvdXRlclN1YnNjcmlwdGlvbjogYW55O1xuICAgIF9iYWNrVVJMOiBzdHJpbmcgPSAnJztcbiAgICBfYmFja1Nob3c6IHN0cmluZyA9ICdub25lJztcbiAgICBfbG9jYXRpb25MYWJlbDogc3RyaW5nID0gJyc7XG4gICAgX3F1ZXJ5UGFyYW1zSGFuZGxpbmc6IFF1ZXJ5UGFyYW1zSGFuZGxpbmcgPSAnJztcblxuICAgIC8qKiBTZXRzIHRoZSBoYW5kbGluZyBvZiB0aGUgcXVlcnkgcGFyYW1ldGVycyBmb3IgdGhlIGJyZWFkY3J1bWIuIENob29zZSBmcm9tOiBgJ3ByZXNlcnZlJyB8ICdtZXJnZScgfCAnJyAoZGVmYXVsdClgICovXG4gICAgQElucHV0KClcbiAgICBnZXQgcXVlcnlQYXJhbXNIYW5kbGluZygpOiBRdWVyeVBhcmFtc0hhbmRsaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3F1ZXJ5UGFyYW1zSGFuZGxpbmc7XG4gICAgfVxuXG4gICAgc2V0IHF1ZXJ5UGFyYW1zSGFuZGxpbmcocXVlcnlQYXJhbXNIYW5kbGluZzogUXVlcnlQYXJhbXNIYW5kbGluZykge1xuICAgICAgICB0aGlzLl9xdWVyeVBhcmFtc0hhbmRsaW5nID0gcXVlcnlQYXJhbXNIYW5kbGluZztcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGFjdGl2YXRlZFJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSwgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcikge31cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICBjb25zdCBST1VURV9EQVRBX0JSRUFEQ1JVTUI6IHN0cmluZyA9ICdicmVhZGNydW1iJztcbiAgICAgICAgLy8gQWRkIHRoZSBmaXJzdCBicmVhZGNydW1iIGZvciB0aGUgYmFzZSBwYWdlXG4gICAgICAgIGxldCByb290OiBBY3RpdmF0ZWRSb3V0ZSA9IHRoaXMuYWN0aXZhdGVkUm91dGUucm9vdDtcbiAgICAgICAgdGhpcy5fYnJlYWRjcnVtYnMgPSB0aGlzLmdldEJyZWFkY3J1bWJzKHJvb3QpO1xuXG4gICAgICAgIC8vIHN1YnNjcmliZSB0byB0aGUgTmF2aWdhdGlvbkVuZCBldmVudFxuICAgICAgICB0aGlzLl9yb3V0ZXJTdWJzY3JpcHRpb24gPSB0aGlzLnJvdXRlci5ldmVudHMuc3Vic2NyaWJlKChldmVudDogRXZlbnQpID0+IHtcbiAgICAgICAgICAgIGlmIChldmVudCBpbnN0YW5jZW9mIE5hdmlnYXRpb25FbmQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEJyZWFkY3J1bWJzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHNldCBpbml0aWFsIGJyZWFkY3J1bWIgc3RhdGVcbiAgICAgICAgdGhpcy5zZXRCcmVhZGNydW1icygpO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2V0QnJlYWRjcnVtYnMoKSB7XG4gICAgICAgIGNvbnN0IHJvb3QgPSB0aGlzLmFjdGl2YXRlZFJvdXRlLnJvb3Q7XG4gICAgICAgIHRoaXMuX2JyZWFkY3J1bWJzID0gdGhpcy5nZXRCcmVhZGNydW1icyhyb290KTtcbiAgICAgICAgaWYgKHRoaXMuX2JyZWFkY3J1bWJzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIHRoaXMuX2JhY2tVUkwgPSB0aGlzLl9icmVhZGNydW1ic1t0aGlzLl9icmVhZGNydW1icy5sZW5ndGggLSAyXS51cmw7XG4gICAgICAgICAgICB0aGlzLl9iYWNrU2hvdyA9ICdpbmxpbmUnO1xuICAgICAgICAgICAgdGhpcy5fbG9jYXRpb25MYWJlbCA9ICcnO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2JyZWFkY3J1bWJzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgdGhpcy5fYmFja1Nob3cgPSAnbm9uZSc7XG4gICAgICAgICAgICB0aGlzLl9sb2NhdGlvbkxhYmVsID0gdGhpcy5fYnJlYWRjcnVtYnNbdGhpcy5fYnJlYWRjcnVtYnMubGVuZ3RoIC0gMV0ubGFiZWw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9iYWNrU2hvdyA9ICdub25lJztcbiAgICAgICAgICAgIHRoaXMuX2xvY2F0aW9uTGFiZWwgPSAnJztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0QnJlYWRjcnVtYnMocm91dGU6IEFjdGl2YXRlZFJvdXRlLCB1cmw6IHN0cmluZyA9ICcnLCBicmVhZGNydW1iczogSUJyZWFkY3J1bWJbXSA9IFtdKTogSUJyZWFkY3J1bWJbXSB7XG4gICAgICAgIGNvbnN0IFJPVVRFX0RBVEFfQlJFQURDUlVNQjogc3RyaW5nID0gJ2JyZWFkY3J1bWInO1xuXG4gICAgICAgIC8vIGdldCB0aGUgY2hpbGQgcm91dGVzXG4gICAgICAgIGxldCBjaGlsZHJlbjogQWN0aXZhdGVkUm91dGVbXSA9IHJvdXRlLmNoaWxkcmVuO1xuXG4gICAgICAgIC8vIHJldHVybiBpZiB0aGVyZSBhcmUgbm8gbW9yZSBjaGlsZHJlblxuICAgICAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gYnJlYWRjcnVtYnM7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBpdGVyYXRlIG92ZXIgZWFjaCBjaGlsZHJlblxuICAgICAgICBmb3IgKGxldCBjaGlsZCBvZiBjaGlsZHJlbikge1xuICAgICAgICAgICAgLy8gdmVyaWZ5IHByaW1hcnkgcm91dGVcbiAgICAgICAgICAgIGlmIChjaGlsZC5vdXRsZXQgIT09IFBSSU1BUllfT1VUTEVUKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHZlcmlmeSB0aGUgY3VzdG9tIGRhdGEgcHJvcGVydHkgXCJicmVhZGNydW1iXCIgaXMgc3BlY2lmaWVkIG9uIHRoZSByb3V0ZVxuICAgICAgICAgICAgaWYgKCFjaGlsZC5zbmFwc2hvdC5kYXRhLmhhc093blByb3BlcnR5KFJPVVRFX0RBVEFfQlJFQURDUlVNQikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRCcmVhZGNydW1icyhjaGlsZCwgdXJsLCBicmVhZGNydW1icyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGdldCB0aGUgcm91dGUncyBVUkwgc2VnbWVudFxuICAgICAgICAgICAgbGV0IHJvdXRlVVJMOiBzdHJpbmcgPSBjaGlsZC5zbmFwc2hvdC51cmwubWFwKHNlZ21lbnQgPT4gc2VnbWVudC5wYXRoKS5qb2luKCcvJyk7XG5cbiAgICAgICAgICAgIC8vIGFwcGVuZCByb3V0ZSBVUkwgdG8gVVJMXG4gICAgICAgICAgICB1cmwgKz0gYC8ke3JvdXRlVVJMfWA7XG5cbiAgICAgICAgICAgIC8vIGFkZCBicmVhZGNydW1iXG4gICAgICAgICAgICBsZXQgcGFyZW50OiBBY3RpdmF0ZWRSb3V0ZSB8IG51bGwgPSB0aGlzLmFjdGl2YXRlZFJvdXRlLnBhcmVudDtcbiAgICAgICAgICAgIGxldCBmdWxsVVJMOiBzdHJpbmcgPSAnJztcbiAgICAgICAgICAgIGlmIChwYXJlbnQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBmdWxsVVJMICs9ICcvJyArIHBhcmVudC5zbmFwc2hvdC51cmwubWFwKHNlZ21lbnQgPT4gc2VnbWVudC5wYXRoKS5qb2luKCcvJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmdWxsVVJMICs9IGAke3VybH1gO1xuICAgICAgICAgICAgbGV0IGJyZWFkY3J1bWI6IElCcmVhZGNydW1iID0ge1xuICAgICAgICAgICAgICAgIGxhYmVsOiBjaGlsZC5zbmFwc2hvdC5kYXRhW1JPVVRFX0RBVEFfQlJFQURDUlVNQl0sXG4gICAgICAgICAgICAgICAgcGFyYW1zOiBjaGlsZC5zbmFwc2hvdC5wYXJhbXMsXG4gICAgICAgICAgICAgICAgdXJsOiBmdWxsVVJMXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBicmVhZGNydW1icy5wdXNoKGJyZWFkY3J1bWIpO1xuXG4gICAgICAgICAgICAvLyByZWN1cnNpdmVcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEJyZWFkY3J1bWJzKGNoaWxkLCB1cmwsIGJyZWFkY3J1bWJzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHdlIHNob3VsZCBuZXZlciBnZXQgaGVyZSwgYnV0IGp1c3QgaW4gY2FzZVxuICAgICAgICByZXR1cm4gYnJlYWRjcnVtYnM7XG4gICAgfVxuXG4gICAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgICAgIHRoaXMuX3JvdXRlclN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cbn1cbiJdfQ==